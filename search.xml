<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JS数据结构与算法</title>
      <link href="/posts/ca81d416.html"/>
      <url>/posts/ca81d416.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端单元测试</title>
      <link href="/posts/5313352d.html"/>
      <url>/posts/5313352d.html</url>
      
        <content type="html"><![CDATA[<h2 id="为什么要做单元测试"><a href="#为什么要做单元测试" class="headerlink" title="为什么要做单元测试"></a>为什么要做单元测试</h2><h2 id="Jest-单元测试实战"><a href="#Jest-单元测试实战" class="headerlink" title="Jest 单元测试实战"></a>Jest 单元测试实战</h2><h2 id="组件化-UI-测试实战"><a href="#组件化-UI-测试实战" class="headerlink" title="组件化 UI 测试实战"></a>组件化 UI 测试实战</h2><h2 id="状态管理数据流测试"><a href="#状态管理数据流测试" class="headerlink" title="状态管理数据流测试"></a>状态管理数据流测试</h2><h2 id="前端单元测试该如何落地"><a href="#前端单元测试该如何落地" class="headerlink" title="前端单元测试该如何落地"></a>前端单元测试该如何落地</h2>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Jest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>打印时元素背景颜色丢失</title>
      <link href="/posts/f9c0c86.html"/>
      <url>/posts/f9c0c86.html</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在页面上元素有背景颜色，但<code>部分浏览器</code>在打印时，有背景颜色丢失的情况</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>给要打印背景的元素添加样式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// Chrome</span><br><span class="line">-webkit-print-<span class="attribute">color</span>-adjust: exact;</span><br><span class="line"></span><br><span class="line">// Firefox</span><br><span class="line">print-<span class="attribute">color</span>-adjust: exact;</span><br><span class="line"><span class="attribute">color</span>-adjust: exact;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 问题汇总 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue离开或刷新页面弹窗提示</title>
      <link href="/posts/a0414938.html"/>
      <url>/posts/a0414938.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大文件上传和断点续传</title>
      <link href="/posts/e2d9dacd.html"/>
      <url>/posts/e2d9dacd.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Error: [ElementForm] unpected width</title>
      <link href="/posts/f3b9426e.html"/>
      <url>/posts/f3b9426e.html</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p><code>Error: [ElementForm] unpected width</code><br>在使用 element 中页面切换的过程中，会出现这个报错。</p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>造成这个错误的原因是当组件中存在<code>v-show</code>时，并且<code>el-form</code>中<code>labelWidth</code>设为<code>auto</code>时，就会获取不到<code>label</code>的宽度。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>可以将<code>v-show</code>的地方改为<code>v-if</code>，每次重新渲染组件，或是<code>labelWidth</code>设为固定。</p>]]></content>
      
      
      <categories>
          
          <category> 问题汇总 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Element </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端性能优化之虚拟列表的实现</title>
      <link href="/posts/cf56b558.html"/>
      <url>/posts/cf56b558.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>虚拟列表：简而言之，对于大量列表数据，仅渲染滚动区域内可视区域 所对应 数据源 的部分数据</p></blockquote><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>举个例子：<br>比如我要渲染 1000 条数据，每条数据高度 60px，如果我想把全部元素渲染，那么滚动区域至少需要 6000px 高但是呢，如果我渲染 1000 条数据，那么整个 dom 树就会出现巨量 dom 元素，如下图，B,C,D 区域将全部都是 dom 元素，一旦回流重绘就会非常卡顿。</p><p><img src="https://wade1999-images-1307558348.cos.ap-shanghai.myqcloud.com/202302220934510.webp" alt="img"></p><p>这种场景的优化方案就是采取虚拟列表去渲染，即我们要做的就是在滚动的时候只渲染可视区域对应的 dom 元素，即下图的 B，非可视区域内元素不去渲染（即 C,D 区域不渲染元素），这样的话可以减少大量非必要 DOM 渲染（C，D 区域用户也不需要看见，所以它的 dom 渲染是非必要的），去提高性能！</p><h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><blockquote><p>根据视口高度（上图中的 B 区域高度），父元素的滚动距离（scrollTop）及每一个列表元素 item 的平均高度，计算出当前 scrollTop 到 scrollTop+视口高度这段可视区域 对应数据源列表所需要展示的 部分数据，再将这部分数据展示在 B 区域内，对于隐藏滚动区域 C,D 使用 paddingTop&amp;&amp;paddingBottom 填充，保持整个滚动区域高度不变，同时监听滚动，滚动触发时动态改变可是区域内数据及 paddingTop&amp;&amp;paddingBottom 等数据</p></blockquote><ul><li>1，监听容器元素滚动</li><li>2，获取容器元素滚动距离 scrollTop</li><li>3，获取当前滚动距离（scrollTop）下可视区域首个需要渲染元素索引（in 数据源）startIndex，计算方式：startIndex = 滚动距离（scrollTop）/ 列表元素高度（itemHeight）</li><li>4，获取当前滚动距离（scrollTop）下可视区域最后一个需要渲染元素索引（in 数据源）endIndex，计算方式：endIndex = startIndex + 可视区域高度（viewHeight）/ 列表元素高度（itemHeight）</li><li>5，根据 startIndex 和 endIndex 获取数据源对应的 可视区域需要展示的数据 viewData，计算方式：viewData =dataSource（数据源）.slice(startIndex,endIndex+1)</li><li>6，计算 C 区域的高度，既 paddingTop，计算方式：paddingTop = startIndex*itemHeight（列表元素高度）</li><li>7，计算 D 区域的高度，既 paddingBottom，计算方式：paddingBottom = contentHeight（整个滚动区域高度，既 A 区域）-paddingTop-可视区域高度（viewHeight）</li><li>8，清除可是区域内上一次展示的数据，使用新数据 viewData 重新填充，且设置新的 paddingTop&amp;paddingBottom</li></ul><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">html</span>,</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#container</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#content</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: pink;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">createVlist</span>(<span class="params">container, content, data_Source, item_Height</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> dataSource = data_Source; <span class="comment">// 数据源</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> itemHeight = item_Height; <span class="comment">// 每一行元素高度</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> viewHeight = container.<span class="property">clientHeight</span>; <span class="comment">// 视口高度（虚拟列表所展示部分高度）</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> contentHeight = itemHeight * dataSource.<span class="property">length</span>; <span class="comment">// 滚动区域高度</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> itemCount = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(viewHeight / itemHeight); <span class="comment">// 视口元素数量</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置容器元素overflow: auto （生成滚动区域，不被截取）</span></span></span><br><span class="line"><span class="language-javascript">        container.<span class="title function_">setAttribute</span>(<span class="string">&quot;style&quot;</span>, <span class="string">`overflow:auto`</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置滚动区域高度</span></span></span><br><span class="line"><span class="language-javascript">        content.<span class="title function_">setAttribute</span>(<span class="string">&quot;style&quot;</span>, <span class="string">`height:<span class="subst">$&#123;contentHeight&#125;</span>px`</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="title function_">scrollCallback</span> = (<span class="params">e</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> scrollTop = e.<span class="property">target</span>.<span class="property">scrollTop</span>; <span class="comment">// 容器元素的滚动距离</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> startIndex = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(scrollTop / itemHeight); <span class="comment">// 视口第一个元素所在数据源中的索引</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> endIndex = startIndex + itemCount; <span class="comment">// 视口最后一个元素所在数据源中的索引</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 根据startIndex endIndex找出数据源中需要展示在虚拟列表中的部分数据</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> itemList = dataSource.<span class="title function_">slice</span>(startIndex, endIndex + <span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 滚动区域高度contentHeight =  滚动区域paddingTop + 视口高度 + 滚动区域paddingBottom</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> paddingTop = startIndex * itemHeight;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> paddingBottom =</span></span><br><span class="line"><span class="language-javascript">            contentHeight - paddingTop - itemCount * itemHeight;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 动态调整滚动区域的paddingTop  paddingBottom 保证列表部分始终展示在视口</span></span></span><br><span class="line"><span class="language-javascript">          content.<span class="title function_">setAttribute</span>(</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;style&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">`padding-top:<span class="subst">$&#123;paddingTop&#125;</span>px;padding-bottom:<span class="subst">$&#123;paddingBottom&#125;</span>px`</span></span></span><br><span class="line"><span class="language-javascript">          );</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 展示下一批次列表前删除上一批次列表数据</span></span></span><br><span class="line"><span class="language-javascript">          content.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 动态调整每次滚动后对应的展示数据</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">for</span> (<span class="keyword">const</span> val <span class="keyword">of</span> itemList) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> item = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            item.<span class="property">innerHTML</span> = val;</span></span><br><span class="line"><span class="language-javascript">            item.<span class="title function_">setAttribute</span>(</span></span><br><span class="line"><span class="language-javascript">              <span class="string">&quot;style&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="string">`background-color:<span class="subst">$&#123;</span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="language-javascript">                val % <span class="number">2</span> === <span class="number">0</span> ? <span class="string">&quot;red&quot;</span> : <span class="string">&quot;blue&quot;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="language-javascript">              &#125;</span>;width:100%;height:<span class="subst">$&#123;item_Height&#125;</span>px`</span></span></span><br><span class="line"><span class="language-javascript">            );</span></span><br><span class="line"><span class="language-javascript">            content.<span class="title function_">appendChild</span>(item);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加容器元素的滚动监听</span></span></span><br><span class="line"><span class="language-javascript">        container.<span class="title function_">addEventListener</span>(<span class="string">&quot;scroll&quot;</span>, scrollCallback);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 初始首屏数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">scrollCallback</span>(&#123; <span class="attr">target</span>: container &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 创建虚拟列表</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">createVlist</span>(</span></span><br><span class="line"><span class="language-javascript">        container,</span></span><br><span class="line"><span class="language-javascript">        content,</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="number">100</span> &#125;, <span class="function">(<span class="params">v, i</span>) =&gt;</span> i),</span></span><br><span class="line"><span class="language-javascript">        <span class="number">60</span></span></span><br><span class="line"><span class="language-javascript">      );</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Vue-使用虚拟列表"><a href="#Vue-使用虚拟列表" class="headerlink" title="Vue 使用虚拟列表"></a>Vue 使用虚拟列表</h2><h3 id="安装-vue-virtual-scroller"><a href="#安装-vue-virtual-scroller" class="headerlink" title="安装 vue-virtual-scroller"></a>安装 <code>vue-virtual-scroller</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-virtual-scroller</span><br></pre></td></tr></table></figure><h3 id="在main-js中引入"><a href="#在main-js中引入" class="headerlink" title="在main.js中引入"></a>在<code>main.js</code>中引入</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;vue-virtual-scroller/dist/vue-virtual-scroller.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vuevirtualscroller <span class="keyword">from</span> <span class="string">&quot;vue-virtual-scroller&quot;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(vuevirtualscroller);</span><br></pre></td></tr></table></figure><h3 id="基础用法-固定大小"><a href="#基础用法-固定大小" class="headerlink" title="基础用法(固定大小)"></a>基础用法(固定大小)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;RecycleScroller</span><br><span class="line">    class=&quot;scroller&quot;</span><br><span class="line">    :items=&quot;list&quot;</span><br><span class="line">    :item-size=&quot;32&quot;</span><br><span class="line">    key-field=&quot;id&quot;</span><br><span class="line">    v-slot=&quot;&#123; item &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div class=&quot;user&quot;&gt;</span><br><span class="line">      &#123;&#123; item.name &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/RecycleScroller&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Home&quot;,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      items: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getData();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    getData() &#123;</span><br><span class="line">      for (let i = 0; i &lt; 200000; i++) &#123;</span><br><span class="line">        this.items.push(&#123; title: &quot;ssadqwesadwqe&quot;, id: i &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.scroller &#123;</span><br><span class="line">  height: 300px;</span><br><span class="line">  background-color: rgba(0, 0, 0, 0.1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user &#123;</span><br><span class="line">  height: 32%;</span><br><span class="line">  padding: 0 12px;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>使用<code>&lt;RecycleScroller&gt;</code>，<code>items</code>绑定数据源，<code>item-size</code>设置的子元素的高度,<strong>父子元素高度都必须固定</strong></p><hr><h3 id="上拉加载-固定大小"><a href="#上拉加载-固定大小" class="headerlink" title="上拉加载(固定大小)"></a>上拉加载(固定大小)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;RecycleScroller</span><br><span class="line">      class=&quot;scroller&quot;</span><br><span class="line">      :items=&quot;items&quot;</span><br><span class="line">      :item-size=&quot;150&quot;</span><br><span class="line">      :emitUpdate=&quot;true&quot;</span><br><span class="line">      @update=&quot;update&quot;</span><br><span class="line">      v-if=&quot;items.length&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template slot-scope=&quot;props&quot;&gt;</span><br><span class="line">        &lt;li :key=&quot;props.itemKey&quot;&gt;</span><br><span class="line">          &lt;div&gt;&#123;&#123; props.item.title &#125;&#125;&lt;/div&gt;</span><br><span class="line">          &lt;img :src=&quot;props.item.img&quot; alt=&quot;&quot; /&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/RecycleScroller&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;test&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      items: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getData();</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    getData() &#123;</span><br><span class="line">      let arr = [];</span><br><span class="line">      for (let i = 1; i &lt; 20; i++) &#123;</span><br><span class="line">        arr.push(&#123;</span><br><span class="line">          id: i + 1,</span><br><span class="line">          img: &quot;http://dummyimage.com/200x100/FF6600&quot;,</span><br><span class="line">          time: &quot;2003-02-02&quot;,</span><br><span class="line">          title: &quot;hahahha&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      this.items = arr;</span><br><span class="line">    &#125;,</span><br><span class="line">    update(start, end) &#123;</span><br><span class="line">      if (end === this.items.length) &#123;</span><br><span class="line">        let temp = [];</span><br><span class="line">        let id = this.items[this.items.length - 1].id;</span><br><span class="line">        let arr = [];</span><br><span class="line">        for (let i = 1; i &lt; 20; i++) &#123;</span><br><span class="line">          arr.push(&#123;</span><br><span class="line">            id: id + i,</span><br><span class="line">            img: &quot;http://dummyimage.com/200x100/FF6600&quot;,</span><br><span class="line">            time: &quot;2003-02-02&quot;,</span><br><span class="line">            title: &quot;hahahha&quot;,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        let res = &#123;</span><br><span class="line">          code: 200,</span><br><span class="line">          data: arr,</span><br><span class="line">        &#125;;</span><br><span class="line">        temp = [...this.items, ...res.data];</span><br><span class="line">        this.items = temp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;css&quot; scoped&gt;</span><br><span class="line">.scroller &#123;</span><br><span class="line">  height: 300px;</span><br><span class="line">  background-color: #ccc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user &#123;</span><br><span class="line">  height: 150px;</span><br><span class="line">  padding: 0 12px;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>加入<code>:emitUpdate=“true”</code>和<code>@update=“update”</code>,<strong>emitUpdate 必须设置为 true</strong>,<code>update</code>中定义数据更新的方法</p><hr><h3 id="上拉加载-可变大小"><a href="#上拉加载-可变大小" class="headerlink" title="上拉加载(可变大小)"></a>上拉加载(可变大小)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;DynamicScroller</span><br><span class="line">      :items=&quot;items&quot;</span><br><span class="line">      :min-item-size=&quot;54&quot;</span><br><span class="line">      class=&quot;scroller&quot;</span><br><span class="line">      :emitUpdate=&quot;true&quot;</span><br><span class="line">      @update=&quot;update&quot;</span><br><span class="line">      v-if=&quot;items.length&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template v-slot=&quot;&#123; item, index, active &#125;&quot;&gt;</span><br><span class="line">        &lt;DynamicScrollerItem</span><br><span class="line">          :item=&quot;item&quot;</span><br><span class="line">          :active=&quot;active&quot;</span><br><span class="line">          :size-dependencies=&quot;[item.message]&quot;</span><br><span class="line">          :data-index=&quot;index&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;li class=&quot;single-item&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;right-info&quot;&gt;</span><br><span class="line">              &lt;span&gt;标题：&#123;&#123; item.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">              &lt;span&gt;项目数量：&#123;&#123; item.id &#125;&#125;&lt;/span&gt;</span><br><span class="line">              &lt;span&gt;项目时间:&#123;&#123; item.time &#125;&#125;&lt;/span&gt;</span><br><span class="line">              &lt;span&gt;项目描述:&#123;&#123; item.des &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/DynamicScrollerItem&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/DynamicScroller&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;test&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      items: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getData();</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    getData() &#123;</span><br><span class="line">      let arr = [];</span><br><span class="line">      for (let i = 1; i &lt; 20; i++) &#123;</span><br><span class="line">        arr.push(&#123;</span><br><span class="line">          id: i + 1,</span><br><span class="line">          img: &quot;http://dummyimage.com/200x100/FF6600&quot;,</span><br><span class="line">          time: &quot;2003-02-02&quot;,</span><br><span class="line">          title: &quot;hahahha&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      this.items = arr;</span><br><span class="line">    &#125;,</span><br><span class="line">    update(start, end) &#123;</span><br><span class="line">      if (end === this.items.length) &#123;</span><br><span class="line">        let temp = [];</span><br><span class="line">        let id = this.items[this.items.length - 1].id;</span><br><span class="line">        let arr = [];</span><br><span class="line">        for (let i = 1; i &lt; 20; i++) &#123;</span><br><span class="line">          arr.push(&#123;</span><br><span class="line">            id: id + i,</span><br><span class="line">            img: &quot;http://dummyimage.com/200x100/FF6600&quot;,</span><br><span class="line">            time: &quot;2003-02-02&quot;,</span><br><span class="line">            title: &quot;hahahha&quot;,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        let res = &#123;</span><br><span class="line">          code: 200,</span><br><span class="line">          data: arr,</span><br><span class="line">        &#125;;</span><br><span class="line">        temp = [...this.items, ...res.data];</span><br><span class="line">        this.items = temp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.scroller &#123;</span><br><span class="line">  height: calc(100vh - 3rem);</span><br><span class="line">  background-color: #ccc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user &#123;</span><br><span class="line">  height: 32%;</span><br><span class="line">  padding: 0 12px;</span><br><span class="line">  display: flex;</span><br><span class="line">&#125;</span><br><span class="line">.single-item &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-start;</span><br><span class="line">  align-items: center;</span><br><span class="line">  border-bottom: 1px solid rgb(187, 167, 167);</span><br><span class="line">  .left-pic &#123;</span><br><span class="line">    width: 200px;</span><br><span class="line">    img &#123;</span><br><span class="line">      width: 200px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  .right-info &#123;</span><br><span class="line">    padding-left: 20px;</span><br><span class="line">    text-align: left;</span><br><span class="line">    span &#123;</span><br><span class="line">      display: block;</span><br><span class="line">      &amp;:last-child &#123;</span><br><span class="line">        word-break: break-all;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><hr><h2 id="vue-virtual-scroller"><a href="#vue-virtual-scroller" class="headerlink" title="vue-virtual-scroller"></a>vue-virtual-scroller</h2><a class="tag-Link" target="_blank" href="https://github.com/Akryum/vue-virtual-scroller/blob/master/packages/vue-virtual-scroller/README.md"><div class="tag-link-tips">引用站外地址</div><div class="tag-link-bottom"><div class="tag-link-left" style="background-image: url(https://api.iowen.cn/favicon/github.com/Akryum/vue-virtual-scroller/blob/master/packages/vue-virtual-scroller/README.md.png);"></div><div class="tag-link-right"><div class="tag-link-title">vue-virtual-scroller 官方文档</div><div class="tag-link-sitename">超快滚动任意数量的数据</div></div><i class="fa-solid fa-angle-right"></i></div></a><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><table><thead><tr><th align="left">参数</th><th align="left">说明</th><th align="left">默认值</th></tr></thead><tbody><tr><td align="left">items</td><td align="left">要在滚动条中显示的项目列表。</td><td align="left">-</td></tr><tr><td align="left">direction</td><td align="left">滚动方向(<code>vertical</code>或<code>horizontal</code>)</td><td align="left">vertical</td></tr><tr><td align="left">itemSize</td><td align="left">以像素为单位显示项目的高度（或水平模式下的宽度），用于计算滚动大小和位置。<br>如果设置为（默认值），它将使用可变大小模式。</td><td align="left">null</td></tr><tr><td align="left">gridItems</td><td align="left">在同一行上显示多个项目以创建网格。您必须输入一个值才能使用此道具（不支持动态大小）。</td><td align="left">-</td></tr><tr><td align="left">itemSecondarySize</td><td align="left">设置时网格中项目的大小（垂直模式下的宽度，水平模式下的高度）。<br>如果未设置，它将使用 <code>gridItems</code> <code>itemSecondarySize</code> <code>itemSize</code> 的值。</td><td align="left">-</td></tr><tr><td align="left">minItemSize</td><td align="left">如果项目的高度（或水平模式下的宽度）未知，则使用的最小大小。</td><td align="left">-</td></tr><tr><td align="left">sizeField</td><td align="left">用于在可变大小模式下获取项目大小的字段。</td><td align="left">size</td></tr><tr><td align="left">typeField</td><td align="left">用于区分列表中不同类型的组件的字段。对于每种不同的类型，将创建一个回收物品池。</td><td align="left">type</td></tr><tr><td align="left">keyField</td><td align="left">用于标识项目和优化管理渲染视图的字段。</td><td align="left">id</td></tr><tr><td align="left">pageMode</td><td align="left">启用页面模式。</td><td align="left">false</td></tr><tr><td align="left">prerender</td><td align="left">为服务器端呈现 （SSR） 渲染固定数量的项目。</td><td align="left">0</td></tr><tr><td align="left">buffer</td><td align="left">要添加到滚动可见区域边缘以开始渲染更远的项目的像素量。</td><td align="left">200</td></tr><tr><td align="left">emitUpdate</td><td align="left">每次更新虚拟滚动条内容时发出一个事件（可能会影响性能）。</td><td align="left">false</td></tr><tr><td align="left">listClass</td><td align="left">添加到项目列表包装器的自定义类。</td><td align="left">-</td></tr><tr><td align="left">itemClass</td><td align="left">添加到每个项目的自定义类。</td><td align="left">-</td></tr><tr><td align="left">listTag</td><td align="left">要呈现为列表包装器的元素。</td><td align="left">div</td></tr><tr><td align="left">itemTag</td><td align="left">要呈现为列表项（默认槽内容的直接父级）的元素。</td><td align="left">div</td></tr></tbody></table><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><table><thead><tr><th align="left">事件名</th><th align="left">说明</th><th align="left">参数</th></tr></thead><tbody><tr><td align="left">resize</td><td align="left">当滚动条的大小更改时发出。</td><td align="left"></td></tr><tr><td align="left">visible</td><td align="left">当滚动条认为自己在页面中可见时发出。</td><td align="left"></td></tr><tr><td align="left">hidden</td><td align="left">当滚动条隐藏在页面中时发出。</td><td align="left"></td></tr><tr><td align="left">update</td><td align="left">每次更新视图时发出。<code>emitUpdate</code> 需设置为 <code>true</code></td><td align="left">startIndex, endIndex, visibleStartIndex, visibleEndIndex</td></tr><tr><td align="left">scroll-start</td><td align="left">渲染第一项时发出。</td><td align="left"></td></tr><tr><td align="left">scroll-end</td><td align="left">呈现最后一项时发出。</td><td align="left"></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git 退回历史版本</title>
      <link href="/posts/4201199c.html"/>
      <url>/posts/4201199c.html</url>
      
        <content type="html"><![CDATA[<p>这是一个悲伤的故事 😢</p><h2 id="方法一：直接回退版本"><a href="#方法一：直接回退版本" class="headerlink" title="方法一：直接回退版本"></a>方法一：直接回退版本</h2><blockquote><p>如果想恢复到之前某个提交的版本，且那个版本之后提交的版本我们都不要了，就可以用这种方法。</p></blockquote><h3 id="查看历史版本号"><a href="#查看历史版本号" class="headerlink" title="查看历史版本号"></a>查看历史版本号</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> -10 <span class="comment">#查看最近10次commit的记录</span></span><br></pre></td></tr></table></figure><h3 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard 目标版本号</span><br></pre></td></tr></table></figure><h3 id="代码提交"><a href="#代码提交" class="headerlink" title="代码提交"></a>代码提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git push -f</span><br><span class="line"><span class="comment"># 此时如果用“git push”会报错，因为我们本地库 HEAD 指向的版本比远程库的要旧。</span></span><br><span class="line"><span class="comment"># 所以我们要用“git push -f”强制推上去，就可以了。</span></span><br></pre></td></tr></table></figure><hr><h2 id="方法二：反做历史版本"><a href="#方法二：反做历史版本" class="headerlink" title="方法二：反做历史版本"></a>方法二：反做历史版本</h2><blockquote><p>如果我们想撤销之前的某一版本，但是又想保留该目标版本后面的版本，记录下这整个版本变动流程，就可以用这种方法。</p></blockquote><h3 id="查看历史版本号-1"><a href="#查看历史版本号-1" class="headerlink" title="查看历史版本号"></a>查看历史版本号</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> -10 <span class="comment">#查看最近10次commit的记录</span></span><br></pre></td></tr></table></figure><h3 id="反做目标版本"><a href="#反做目标版本" class="headerlink" title="反做目标版本"></a>反做目标版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git revert -n 目标版本号</span><br><span class="line"><span class="comment"># 注意：这里可能会出现冲突，那么需要手动修改冲突的文件。而且要git add 文件名。</span></span><br></pre></td></tr></table></figure><h3 id="代码提交-1"><a href="#代码提交-1" class="headerlink" title="代码提交"></a>代码提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;XXXX&quot;</span></span><br><span class="line"><span class="comment"># 此时可以用“git log”查看本地的版本信息，可见多生成了一个新的版本</span></span><br></pre></td></tr></table></figure><h3 id="代码提交-2"><a href="#代码提交-2" class="headerlink" title="代码提交"></a>代码提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 问题汇总 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>&lt;el-table&gt;底部滚动条无法拖动问题解决</title>
      <link href="/posts/5f510e8f.html"/>
      <url>/posts/5f510e8f.html</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p><code>el-table</code>中的<code>el-table-column</code>提供了一个<code>fixed</code>属性设置固定列，但是设置了之后发现表格的滚动条无法拖动了，</p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>滚动条被固定列生成的元素<strong>覆盖</strong>了。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.el-table</span> &#123;</span><br><span class="line">  <span class="selector-class">.el-table__fixed</span> &#123;</span><br><span class="line">    // 左固定列</span><br><span class="line">    <span class="attribute">height</span>: auto <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">18px</span>; // 改为自动高度后，设置与父容器的底部距离，高度会动态改变，值可以设置比滚动条的高度稍微大一些</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.el-table__fixed-right</span> &#123;</span><br><span class="line">    // 右固定列</span><br><span class="line">    <span class="attribute">height</span>: auto <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">18px</span>; // 改为自动高度后，设置与父容器的底部距离，高度会动态改变，值可以设置比滚动条的高度稍微大一些</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.el-table--scrollable-x</span> <span class="selector-class">.el-table__body-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 问题汇总 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Element </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在Vue中实现拖拽功能</title>
      <link href="/posts/63b8f629.html"/>
      <url>/posts/63b8f629.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用watermark.js给网页添加水印</title>
      <link href="/posts/14824453.html"/>
      <url>/posts/14824453.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器调用摄像头获取媒体流，并实现拍照功能</title>
      <link href="/posts/67c97ff3.html"/>
      <url>/posts/67c97ff3.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端实现Excel表格上传解析与导出</title>
      <link href="/posts/a913bf31.html"/>
      <url>/posts/a913bf31.html</url>
      
        <content type="html"><![CDATA[<h1 id="读取-excel-表格"><a href="#读取-excel-表格" class="headerlink" title="读取 excel 表格"></a>读取 excel 表格</h1><h2 id="安装-xlsx"><a href="#安装-xlsx" class="headerlink" title="安装 xlsx"></a>安装 xlsx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install xlsx --save-dev</span><br></pre></td></tr></table></figure><h2 id="引入插件"><a href="#引入插件" class="headerlink" title="引入插件"></a>引入插件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import * as xlsx from <span class="string">&quot;xlsx/xlsx.mjs&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="读取-excel-表格-1"><a href="#读取-excel-表格-1" class="headerlink" title="读取 excel 表格"></a>读取 excel 表格</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form ref=&quot;fileRef&quot;&gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      type=&quot;file&quot;</span><br><span class="line">      ref=&quot;upload&quot;</span><br><span class="line">      accept=&quot;.xls,.xlsx&quot;</span><br><span class="line">      @change=&quot;readExcel&quot;</span><br><span class="line">      class=&quot;upload-button&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;span class=&quot;tips&quot;&gt;支持扩展名：.xls .xlsx，且不超过100M&lt;/span&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import * as XLSX from &quot;xlsx/xlsx.mjs&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    readExcel(e) &#123;</span><br><span class="line">      const files = e.target.files;</span><br><span class="line">      const fileReader = new FileReader();</span><br><span class="line">      fileReader.onload = (ev) =&gt; &#123;</span><br><span class="line">        console.log(123);</span><br><span class="line">        try &#123;</span><br><span class="line">          const data = ev.target.result;</span><br><span class="line">          const workbook = XLSX.read(data, &#123;</span><br><span class="line">            type: &quot;binary&quot;,</span><br><span class="line">          &#125;); // 读取数据</span><br><span class="line">          const wsname = workbook.SheetNames[0]; // 取第一张表</span><br><span class="line">          const ws = XLSX.utils.sheet_to_json(workbook.Sheets[wsname]); // 生成json表格内容</span><br><span class="line">          // const ws1 = XLSX.utils.sheet_to_slk(workbook.Sheets[wsname]) // 输出表格对应位置是什么值</span><br><span class="line">          // const ws2 = XLSX.utils.sheet_to_html(workbook.Sheets[wsname]) // 生成HTML输出</span><br><span class="line">          // const ws3 = XLSX.utils.sheet_to_csv(workbook.Sheets[wsname]) // 生成分隔符分隔值输出</span><br><span class="line">          // const ws4 = XLSX.utils.sheet_to_formulae(workbook.Sheets[wsname]) // 生成公式列表（具有值回退）</span><br><span class="line">          // const ws5 = XLSX.utils.sheet_to_txt(workbook.Sheets[wsname]) // 生成UTF16格式的文本</span><br><span class="line">          // const ws = xlsx.utils.sheet_to_json(workbook.Sheets[wsname], &#123;header: 1,defval: &quot;&quot;&#125;); // 生成json表格内容</span><br><span class="line">          console.log(ws);</span><br><span class="line">          this.$refs.fileRef.reset(); // 清空form</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">          return false;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      fileReader.readAsBinaryString(files[0]);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h1 id="导出-excel-表格"><a href="#导出-excel-表格" class="headerlink" title="导出 excel 表格"></a>导出 excel 表格</h1><p>1.引入依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install xlsx@0.17.0 file-saver@2.0.5 --save</span><br></pre></td></tr></table></figure><p>注：xlsx 要指定版本不然会报错</p><p>2.封装导出的 js 文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&quot;file-saver&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">XLSX</span> <span class="keyword">from</span> <span class="string">&quot;xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">xlsx</span>(<span class="params">json, fields, filename = <span class="string">&quot;.xlsx&quot;</span></span>) &#123;</span><br><span class="line">  <span class="comment">//导出xlsx</span></span><br><span class="line">  json.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> item) &#123;</span><br><span class="line">      <span class="keyword">if</span> (fields.<span class="title function_">hasOwnProperty</span>(i)) &#123;</span><br><span class="line">        item[fields[i]] = item[i];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">delete</span> item[i]; <span class="comment">//删除原先的对象属性</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> sheetName = filename; <span class="comment">//excel的文件名称</span></span><br><span class="line">  <span class="keyword">let</span> wb = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_new</span>(); <span class="comment">//工作簿对象包含一SheetNames数组，以及一个表对象映射表名称到表对象。XLSX.utils.book_new实用函数创建一个新的工作簿对象。</span></span><br><span class="line">  <span class="keyword">let</span> ws = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">json_to_sheet</span>(json, &#123; <span class="attr">header</span>: <span class="title class_">Object</span>.<span class="title function_">values</span>(fields) &#125;); <span class="comment">//将JS对象数组转换为工作表。</span></span><br><span class="line">  wb.<span class="property">SheetNames</span>.<span class="title function_">push</span>(sheetName);</span><br><span class="line">  wb.<span class="property">Sheets</span>[sheetName] = ws;</span><br><span class="line">  <span class="keyword">const</span> defaultCellStyle = &#123;</span><br><span class="line">    <span class="attr">font</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Verdana&quot;</span>, <span class="attr">sz</span>: <span class="number">13</span>, <span class="attr">color</span>: <span class="string">&quot;FF00FF88&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">fill</span>: &#123; <span class="attr">fgColor</span>: &#123; <span class="attr">rgb</span>: <span class="string">&quot;FFFFAA00&quot;</span> &#125; &#125;,</span><br><span class="line">  &#125;; <span class="comment">//设置表格的样式</span></span><br><span class="line">  <span class="keyword">let</span> wopts = &#123;</span><br><span class="line">    <span class="attr">bookType</span>: <span class="string">&quot;xlsx&quot;</span>,</span><br><span class="line">    <span class="attr">bookSST</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;binary&quot;</span>,</span><br><span class="line">    <span class="attr">cellStyles</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">defaultCellStyle</span>: defaultCellStyle,</span><br><span class="line">    <span class="attr">showGridLines</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;; <span class="comment">//写入的样式</span></span><br><span class="line">  <span class="keyword">let</span> wbout = <span class="variable constant_">XLSX</span>.<span class="title function_">write</span>(wb, wopts);</span><br><span class="line">  <span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="title function_">s2ab</span>(wbout)], &#123; <span class="attr">type</span>: <span class="string">&quot;application/octet-stream&quot;</span> &#125;);</span><br><span class="line">  fs.<span class="title function_">saveAs</span>(blob, filename + <span class="string">&quot;.xlsx&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">s2ab</span> = (<span class="params">s</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> buf;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">ArrayBuffer</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(s.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buf);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i != s.<span class="property">length</span>; ++i) view[i] = s.<span class="title function_">charCodeAt</span>(i) &amp; <span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">return</span> buf;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    buf = <span class="keyword">new</span> <span class="title class_">Array</span>(s.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i != s.<span class="property">length</span>; ++i) buf[i] = s.<span class="title function_">charCodeAt</span>(i) &amp; <span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">return</span> buf;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>3.在用导出的文件里引入 xlsx.js 文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;div&gt;&lt;el-button type=&quot;success&quot; @click=&quot;outExcel&quot;&gt;导出excel&lt;/el-button&gt;&lt;/div&gt;</span><br><span class="line">    &lt;el-table :data=&quot;jsonData&quot; stripe style=&quot;width: 100%&quot;&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;学号&quot; width=&quot;180&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;姓名&quot; width=&quot;180&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;age&quot; label=&quot;年龄&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;classes&quot; label=&quot;学院&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; xlsx &#125; from &quot;./utils/xlsx&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      jsonData: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;1&quot;,</span><br><span class="line">          name: &quot;小智&quot;,</span><br><span class="line">          age: 18,</span><br><span class="line">          classes: &quot;商学院&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;2&quot;,</span><br><span class="line">          name: &quot;小白&quot;,</span><br><span class="line">          age: 19,</span><br><span class="line">          classes: &quot;商学院&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;3&quot;,</span><br><span class="line">          name: &quot;小蓝&quot;,</span><br><span class="line">          age: 12,</span><br><span class="line">          classes: &quot;商学院&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;4&quot;,</span><br><span class="line">          name: &quot;小花&quot;,</span><br><span class="line">          age: 14,</span><br><span class="line">          classes: &quot;商学院&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;5&quot;,</span><br><span class="line">          name: &quot;小粉&quot;,</span><br><span class="line">          age: 15,</span><br><span class="line">          classes: &quot;商学院&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;6&quot;,</span><br><span class="line">          name: &quot;小黄&quot;,</span><br><span class="line">          age: 16,</span><br><span class="line">          classes: &quot;商学院&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;7&quot;,</span><br><span class="line">          name: &quot;小红&quot;,</span><br><span class="line">          age: 17,</span><br><span class="line">          classes: &quot;商学院&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;8&quot;,</span><br><span class="line">          name: &quot;小黑&quot;,</span><br><span class="line">          age: 19,</span><br><span class="line">          classes: &quot;商学院&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      listHander: &#123;</span><br><span class="line">        id: &quot;学号&quot;,</span><br><span class="line">        name: &quot;姓名&quot;,</span><br><span class="line">        age: &quot;年龄&quot;,</span><br><span class="line">        classes: &quot;学院&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    outExcel() &#123;</span><br><span class="line">      // this.jsonData是要导出的数据内容（表格里的内容），</span><br><span class="line">      // this.listHander对应要导出内容的表头</span><br><span class="line">      // 学生：指向的是excel文件名</span><br><span class="line">      xlsx(this.jsonData, this.listHander, &quot;学生&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> Excel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebSocket学习笔记</title>
      <link href="/posts/ce1ea377.html"/>
      <url>/posts/ce1ea377.html</url>
      
        <content type="html"><![CDATA[<h2 id="为什么需要-WebSocket-？"><a href="#为什么需要-WebSocket-？" class="headerlink" title="为什么需要 WebSocket ？"></a>为什么需要 WebSocket ？</h2><p>WebSocket 与 http 一样，也是一种网络传输协议。那么有 http 协议了为什么还需要 webSocket 呢？</p><blockquote><p>HTTP 中，通信只能由客户端向服务端发起请求。<br>WebSocket，通信既可以从服务端发起请求，也能从客户端发起请求。</p></blockquote><p>HTTP 协议做不到服务器主动向客户端推送信息。这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦。传统的方式是用 Ajax 轮询，就是在特定的时间间隔，浏览器向服务器发送请求，这样明显浪费资源。</p><h2 id="WebSocket-简介"><a href="#WebSocket-简介" class="headerlink" title="WebSocket 简介"></a>WebSocket 简介</h2><blockquote><p>WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。<br>允许服务端主动向客户端推送数据，浏览器和服务器只需要一次握手，两者之间就直接可以创建持久性的连接，进行双向数据传输</p></blockquote><p><img src="https://wade1999-images-1307558348.cos.ap-shanghai.myqcloud.com/20210618091522653.png" alt="WebSocket"></p><p>浏览器发起 WebSocket 连接请求，连接建立起来之后，服务端和客户端就可以通过 TCP 连接直接交换数据。<br>连接之后 通过 send（）方法发送数据，通过 onmessage 事件来接受服务器返回的数据。</p><h2 id="WebSocket-特点"><a href="#WebSocket-特点" class="headerlink" title="WebSocket 特点"></a>WebSocket 特点</h2><ol><li>通信可以由客户端和服务端双向发送</li><li>建立在 TCP 链接之上，服务端比较容易实现</li><li>与 HTTP 协议有着良好的兼容性。默认端口也是 80 和 443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器</li><li>数据格式比较轻量，性能开销小，通信高效。</li><li>可以发送文本，也可以发送二进制数据</li><li>没有同源限制，客户端可以与任意服务器通信</li><li>协议标识符是 ws（如果加密，则为 wss），服务器网址就是 URL</li></ol><h2 id="WebSocket-属性方法"><a href="#WebSocket-属性方法" class="headerlink" title="WebSocket 属性方法"></a>WebSocket 属性方法</h2><table><thead><tr><th>属性 &amp; 方法</th><th>说明</th></tr></thead><tbody><tr><td>onopen</td><td>连接成功后的回调</td></tr><tr><td>onclose</td><td>连接关闭后的回调</td></tr><tr><td>onerror</td><td>连接失败后的回调</td></tr><tr><td>bufferedAmount</td><td>检查传输数据的大小，当客户端传输大量数据时使用避免网络饱和</td></tr><tr><td>binaryType</td><td>使用二进制的数据类型连接</td></tr><tr><td>protocol</td><td>让服务端知道客户端使用的 WebSocket 协议，可以为空</td></tr><tr><td>url</td><td>WebSocket 的绝对路径</td></tr><tr><td>readyState</td><td>WebSocket 的连接状态<br>0:CONNECTING; 1:OPEN; 2:CLOSING; 3:CLOSED</td></tr><tr><td>close()</td><td>关闭当前连接</td></tr><tr><td>send(data)</td><td>向服务器发送数据</td></tr></tbody></table><h2 id="WebSocket-前端使用"><a href="#WebSocket-前端使用" class="headerlink" title="WebSocket 前端使用"></a>WebSocket 前端使用</h2><blockquote><p><strong>WebSocket(url[, protocols])</strong><br>url: WebSocket API URL,URL 之前需要添加 ws://或者 wss://（类似 http://、https://）<br>protocol: 与服务端定义的协议名称相同，协议的参数例如 XMPP（Extensible Messaging and Presence Protocol）、SOAP（Simple Object Access Protocol）或者自定义协议。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先握手，并查看客户端的浏览器是否支持WebSocket协议</span></span><br><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;wss://echo.websocket.org&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接发生错误的回调方法</span></span><br><span class="line">ws.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;WebSocket连接发生错误&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接成功建立的回调方法</span></span><br><span class="line">ws.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;WebSocket连接成功&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接收到消息的回调方法，websocket的controller里的onMessage方法session_to传过来的值</span></span><br><span class="line">ws.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(event.<span class="property">data</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接关闭的回调方法</span></span><br><span class="line">ws.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;WebSocket连接关闭&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onbeforeunload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  ws.<span class="title function_">close</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Vue-封装-WebSocket"><a href="#Vue-封装-WebSocket" class="headerlink" title="Vue 封装 WebSocket"></a>Vue 封装 WebSocket</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Socket</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> setIntervalWesocketPush = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> url = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> reconnectionNum = <span class="number">0</span>; <span class="comment">// 重连次数</span></span><br><span class="line"><span class="keyword">const</span> limitReconnectionNum = <span class="number">5</span>; <span class="comment">// 最大重连次数</span></span><br><span class="line"><span class="comment">// 建立连接</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createSocket</span>(<span class="params">urls</span>) &#123;</span><br><span class="line">  url = urls;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Socket</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;建立websocket连接&quot;</span>);</span><br><span class="line">    <span class="built_in">clearInterval</span>(setIntervalWesocketPush);</span><br><span class="line">    <span class="title class_">Socket</span> = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(urls);</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="property">onopen</span> = onopenWS;</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="property">onmessage</span> = im_msg;</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="property">onerror</span> = onerrorWS;</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="property">onclose</span> = oncloseWS;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(setIntervalWesocketPush);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;websocket已连接&quot;</span>);</span><br><span class="line">    <span class="title function_">onopenWS</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打开WS之后发送心跳</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">onopenWS</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">clearInterval</span>(setIntervalWesocketPush);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;已连接&quot;</span>);</span><br><span class="line">  <span class="title function_">sendPing</span>(); <span class="comment">// 发送心跳</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 连接失败重连</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">onerrorWS</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;连接失败&quot;</span>);</span><br><span class="line">  <span class="built_in">clearInterval</span>(setIntervalWesocketPush);</span><br><span class="line">  <span class="title class_">Socket</span>.<span class="title function_">close</span>();</span><br><span class="line">  <span class="title class_">Socket</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// createSocket(url) // 重连</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// WS数据接收统一处理</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">im_msg</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">dispatchEvent</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CustomEvent</span>(<span class="string">&quot;im_msg&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">detail</span>: &#123;</span><br><span class="line">        <span class="attr">data</span>: e,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** 发送数据 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sendWSPush</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Socket</span> !== <span class="literal">null</span> &amp;&amp; <span class="title class_">Socket</span>.<span class="property">readyState</span> === <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="title function_">close</span>();</span><br><span class="line">    <span class="title function_">createSocket</span>(url); <span class="comment">// 重连</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Socket</span>.<span class="property">readyState</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Socket</span>.<span class="property">readyState</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Socket</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** 关闭WS */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">oncloseWS</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">clearInterval</span>(setIntervalWesocketPush);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;websocket已断开&quot;</span>);</span><br><span class="line">  setIntervalWesocketPush = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    reconnectionNum++;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;重连中&quot;</span>, reconnectionNum);</span><br><span class="line">    <span class="title class_">Socket</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (reconnectionNum &gt; limitReconnectionNum) &#123;</span><br><span class="line">      <span class="title class_">Socket</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="built_in">clearInterval</span>(setIntervalWesocketPush);</span><br><span class="line">      reconnectionNum = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">createSocket</span>(url); <span class="comment">// 重连</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** 发送心跳 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sendPing</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Socket</span>.<span class="title function_">send</span>(<span class="string">&quot;ping&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;心跳包发送成功&quot;</span>);</span><br><span class="line">  setIntervalWesocketPush = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;连接状态检测中&quot;</span>);</span><br><span class="line">    <span class="title class_">Socket</span>.<span class="title function_">send</span>(<span class="string">&quot;ping&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">5000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Node-js-实现-WebSocket"><a href="#Node-js-实现-WebSocket" class="headerlink" title="Node.js 实现 WebSocket"></a>Node.js 实现 WebSocket</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ws = <span class="built_in">require</span>(<span class="string">&quot;ws&quot;</span>); <span class="comment">//引入websocket模块</span></span><br><span class="line"><span class="keyword">let</span> uuid = <span class="built_in">require</span>(<span class="string">&quot;uuid&quot;</span>); <span class="comment">//引入创建唯一id模块</span></span><br><span class="line"><span class="keyword">let</span> socketServer = ws.<span class="property">Server</span>;</span><br><span class="line"><span class="keyword">let</span> clientIndex = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> wss = <span class="keyword">new</span> <span class="title function_">socketServer</span>(&#123; <span class="attr">port</span>: <span class="number">8090</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务启动, http://127.0.0.1:8090&quot;</span>);</span><br><span class="line">&#125;); <span class="comment">//创建websocketServer实例监听8090端口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> clients = []; <span class="comment">//创建客户端列表，用于保存客户端及相关连接信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 广播所有客户端消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">String</span>&#125; type     广播方式(admin为系统消息，user为用户消息)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">String</span>&#125; message  消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">String</span>&#125; nickname 用户昵称，广播方式为admin时可以不存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">broadcastSend</span>(<span class="params">type, message, nickname</span>) &#123;</span><br><span class="line">  clients.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">v, i</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (v.<span class="property">ws</span>.<span class="property">readyState</span> === ws.<span class="property">OPEN</span>) &#123;</span><br><span class="line">      v.<span class="property">ws</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="title class_">Id</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="title class_">Equipment</span>: <span class="string">&quot;X1&quot;</span>,</span><br><span class="line">  <span class="title class_">EquipmentName</span>: <span class="string">&quot;里氏硬度计08&quot;</span>,</span><br><span class="line">  <span class="title class_">Ip</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="title class_">Code</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="title class_">Isok</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title class_">Msg</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="title class_">BarCode</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="title class_">EndTime</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="title class_">StartTime</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="title class_">IsData</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="title class_">Obj</span>: &#123;</span><br><span class="line">    硬度值: <span class="number">50</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//监听连接</span></span><br><span class="line">wss.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="keyword">function</span> (<span class="params">ws</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> client_uuid = uuid.<span class="title function_">v4</span>();</span><br><span class="line">  <span class="keyword">let</span> nickname = <span class="string">`AnonymousUser<span class="subst">$&#123;clientIndex++&#125;</span>`</span>;</span><br><span class="line">  clients.<span class="title function_">push</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: client_uuid,</span><br><span class="line">    <span class="attr">ws</span>: ws,</span><br><span class="line">    <span class="attr">nickname</span>: nickname,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 关闭服务，从客户端监听列表删除</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">closeSocket</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; clients.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (clients[i].<span class="property">id</span> == client_uuid) &#123;</span><br><span class="line">        <span class="keyword">let</span> disconnect_message = <span class="string">`<span class="subst">$&#123;nickname&#125;</span> has disconnected`</span>;</span><br><span class="line">        <span class="title function_">broadcastSend</span>(<span class="string">&quot;notification&quot;</span>, disconnect_message, nickname);</span><br><span class="line">        clients.<span class="title function_">splice</span>(i, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//无客户端时</span></span><br><span class="line">    <span class="keyword">if</span> (clients.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;无客户端连接&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*监听消息*/</span></span><br><span class="line">  ws.<span class="title function_">on</span>(<span class="string">&quot;message&quot;</span>, <span class="keyword">function</span> (<span class="params">message</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> msg = message.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">JSON</span>.<span class="title function_">parse</span>(msg).<span class="property">Type</span> !== <span class="string">&quot;ping&quot;</span>) &#123;</span><br><span class="line">      <span class="title function_">broadcastSend</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;接收成功&quot;</span>, nickname);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">/*监听断开连接*/</span></span><br><span class="line">  ws.<span class="title function_">on</span>(<span class="string">&quot;close&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">closeSocket</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Vue </tag>
            
            <tag> WebSocket </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在网页中预览zip压缩包中的文件</title>
      <link href="/posts/ba0bb0.html"/>
      <url>/posts/ba0bb0.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过Canvas实现图片压缩功能</title>
      <link href="/posts/90124800.html"/>
      <url>/posts/90124800.html</url>
      
        <content type="html"><![CDATA[<h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><p>通过调整图片的<code>分辨率</code>或者绘图<code>质量</code>来达到图片压缩的效果：</p><ol><li><p>获取上传 Input 中的图片对象 File</p></li><li><p>将图片转换成 base64 格式</p></li><li><p>base64 编码的图片通过 Canvas 转换压缩，这里会用到的 Canvas 的 drawImage 以及 toDataURL 这两个 Api，一个调节图片的分辨率的，一个是调节图片压缩质量并且输出的</p></li><li><p>转换后的图片生成对应的新图片，然后输出</p></li></ol><hr><h2 id="获取上传-Input-中的图片对象-File"><a href="#获取上传-Input-中的图片对象-File" class="headerlink" title="获取上传 Input 中的图片对象 File"></a>获取上传 Input 中的图片对象 File</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 压缩图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">File</span>&#125; file : 图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; maxSize ：最大文件大小</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">compressImage</span> = (<span class="params">file, maxSize = <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">0.5</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (file.<span class="property">size</span> &gt; maxSize) &#123;</span><br><span class="line">    <span class="title function_">canvasDataURL</span>(file, <span class="function">(<span class="params">blob</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;压缩前：&quot;</span> + file.<span class="property">size</span> / <span class="number">1024</span> / <span class="number">1024</span> + <span class="string">&quot;M&quot;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;压缩后：&quot;</span> + blob.<span class="property">size</span> / <span class="number">1024</span> / <span class="number">1024</span> + <span class="string">&quot;M&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> compresFile = <span class="keyword">new</span> <span class="title class_">File</span>([blob], file.<span class="property">name</span>, &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;image/jpeg&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 判断文件是否需要继续压缩</span></span><br><span class="line">      <span class="comment">// if (compresFile.size &gt; maxSize) &#123;</span></span><br><span class="line">      <span class="comment">//   compressImage(compresFile, maxSize);</span></span><br><span class="line">      <span class="comment">// &#125; else &#123;</span></span><br><span class="line">      <span class="comment">//   return compresFile;</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="keyword">return</span> compresFile;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><div class="note danger modern"><p>注意：最大文件大小设置过小可能导致无限循环（个人建议为 300kb 以上，最好增加最大循环次数）</p></div><hr><h2 id="通过-canvas-画布实现压缩，并转化为-base64-格式的图片"><a href="#通过-canvas-画布实现压缩，并转化为-base64-格式的图片" class="headerlink" title="通过 canvas 画布实现压缩，并转化为 base64 格式的图片"></a>通过 canvas 画布实现压缩，并转化为 base64 格式的图片</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过canvas画布实现压缩，并转化为base64格式的图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">File</span>&#125; file : 图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; callback ：回调函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">canvasDataURL</span>(<span class="params">file, callback</span>) &#123;</span><br><span class="line">  <span class="comment">//压缩转化为base64</span></span><br><span class="line">  <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>(); <span class="comment">//读取文件的对象</span></span><br><span class="line">  reader.<span class="title function_">readAsDataURL</span>(file); <span class="comment">//对文件读取，读取完成后会将内容以base64的形式赋值给result属性</span></span><br><span class="line">  reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//读取完成的钩子</span></span><br><span class="line">    <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    <span class="comment">//先创建canvas画布，再获取canvas画布上的2d绘图环境，通过这个2d绘图环境才可使用绘制API</span></span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>); <span class="comment">//创建canvas画布</span></span><br><span class="line">    <span class="keyword">const</span> drawer = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>); <span class="comment">//返回一个在画布上绘制2d图的环境对象，该对象上包含有canvas绘制2d图形的API</span></span><br><span class="line">    img.<span class="property">src</span> = <span class="variable language_">this</span>.<span class="property">result</span>;</span><br><span class="line">    <span class="comment">//图片压缩代码，需要注意的是，img图片渲染是异步的，所以必须在img的onlaod钩子中再进行相应操作</span></span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> quality = <span class="number">0.5</span>; <span class="comment">// 比例、质量</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// // 通过改变图像尺寸实现压缩</span></span><br><span class="line">      <span class="comment">// canvas.width = img.width * quality;</span></span><br><span class="line">      <span class="comment">// canvas.height = img.height * quality;</span></span><br><span class="line">      <span class="comment">// drawer.drawImage(img, 0, 0, canvas.width, canvas.height);</span></span><br><span class="line">      <span class="comment">// convertBase64UrlToBlob(canvas.toDataURL(&quot;image/jpeg&quot;, 1), callback);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 通过改变图像质量实现压缩</span></span><br><span class="line">      <span class="title function_">convertBase64UrlToBlob</span>(canvas.<span class="title function_">toDataURL</span>(<span class="string">&quot;image/jpeg&quot;</span>, quality), callback);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="将-base64-格式转化为-Blob-格式"><a href="#将-base64-格式转化为-Blob-格式" class="headerlink" title="将 base64 格式转化为 Blob 格式"></a>将 base64 格式转化为 Blob 格式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将base64格式转化为Blob格式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; urlData : urlData格式的数据，通过这个转化为Blob对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; callback : 回调函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">convertBase64UrlToBlob</span>(<span class="params">urlData, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> arr = urlData.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> mime = arr[<span class="number">0</span>].<span class="title function_">match</span>(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> bstr = <span class="title function_">atob</span>(arr[<span class="number">1</span>]); <span class="comment">//atob方法用于解码base64</span></span><br><span class="line">  <span class="comment">// console.log(&quot;将base64进行解码:&quot;,bstr);</span></span><br><span class="line">  <span class="keyword">let</span> n = bstr.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">const</span> u8arr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(n);</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    u8arr[n] = bstr.<span class="title function_">charCodeAt</span>(n);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">callback</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Blob</span>([u8arr], &#123;</span><br><span class="line">      <span class="attr">type</span>: mime,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="相关插件"><a href="#相关插件" class="headerlink" title="相关插件"></a>相关插件</h2><a class="tag-Link" target="_blank" href="https://github.com/fengyuanchen/compressorjs/blob/main/README.md"><div class="tag-link-tips">引用站外地址</div><div class="tag-link-bottom"><div class="tag-link-left" style="background-image: url(https://api.iowen.cn/favicon/github.com/fengyuanchen/compressorjs/blob/main/README.md.png);"></div><div class="tag-link-right"><div class="tag-link-title">compressor.js 官方文档</div><div class="tag-link-sitename">使用canvas做压缩工作的图像压缩器</div></div><i class="fa-solid fa-angle-right"></i></div></a><h3 id="安装compression-js"><a href="#安装compression-js" class="headerlink" title="安装compression.js"></a>安装<code>compression.js</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install compressorjs</span><br></pre></td></tr></table></figure><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Compressor</span> <span class="keyword">from</span> <span class="string">&quot;compressorjs&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;file&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&quot;change&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> file = e.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Compressor</span>(file, &#123;</span><br><span class="line">    <span class="attr">quality</span>: <span class="number">0.6</span>,</span><br><span class="line">    <span class="title function_">success</span>(<span class="params">result</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">      formData.<span class="title function_">append</span>(<span class="string">&quot;file&quot;</span>, result, result.<span class="property">name</span>);</span><br><span class="line">      axios.<span class="title function_">post</span>(<span class="string">&quot;/path/to/upload&quot;</span>, formData).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Upload success&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">error</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Canvas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端实现图片批量下载、并打包成压缩包</title>
      <link href="/posts/a8a74f38.html"/>
      <url>/posts/a8a74f38.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将DOM元素保存为图片</title>
      <link href="/posts/eb575759.html"/>
      <url>/posts/eb575759.html</url>
      
        <content type="html"><![CDATA[<div class="note danger modern"><p>注意：无法绘制跨域图片</p></div><a class="tag-Link" target="_blank" href="http://html2canvas.hertzen.com"><div class="tag-link-tips">引用站外地址</div><div class="tag-link-bottom"><div class="tag-link-left" style="background-image: url(https://api.iowen.cn/favicon/html2canvas.hertzen.com.png);"></div><div class="tag-link-right"><div class="tag-link-title">html2canvas 官方文档</div><div class="tag-link-sitename">Screenshots with JavaScript</div></div><i class="fa-solid fa-angle-right"></i></div></a><hr><h2 id="安装-html2canvas"><a href="#安装-html2canvas" class="headerlink" title="安装 html2canvas"></a>安装 html2canvas</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i html2canvas</span><br></pre></td></tr></table></figure><h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> html2canvas <span class="keyword">from</span> <span class="string">&quot;html2canvas&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;code&quot;&gt;存为图片&lt;/div&gt;</span><br><span class="line">  &lt;button @click=&quot;generateImages&quot;&gt;下载&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import html2canvas from &quot;html2canvas&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  ...</span><br><span class="line">  methods:&#123;</span><br><span class="line">    generateImages() &#123;</span><br><span class="line">      html2canvas(document.querySelector(&quot;.code&quot;)).then((canvas) =&gt; &#123;</span><br><span class="line">        // 生成图片</span><br><span class="line">        const imgUrl = canvas.toDataURL(&quot;image/png&quot;, 1);</span><br><span class="line">        const image = document.createElement(&quot;img&quot;);</span><br><span class="line">        image.src = imgUrl;</span><br><span class="line">        // 显示图片</span><br><span class="line">        const content = document.createElement(&quot;div&quot;);</span><br><span class="line">        content.appendChild(image);</span><br><span class="line">        // 下载图片</span><br><span class="line">        const a = document.createElement(&quot;a&quot;);</span><br><span class="line">        a.href = imgUrl;</span><br><span class="line">        a.download = &quot;图片名称&quot;;</span><br><span class="line">        a.click();</span><br><span class="line">        content.remove();</span><br><span class="line">        a.remove();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue添加进入、离开、列表过渡动画</title>
      <link href="/posts/fdb7b858.html"/>
      <url>/posts/fdb7b858.html</url>
      
        <content type="html"><![CDATA[<a class="tag-Link" target="_blank" href="https://v2.cn.vuejs.org/v2/guide/transitions.html"><div class="tag-link-tips">引用站外地址</div><div class="tag-link-bottom"><div class="tag-link-left" style="background-image: url(https://api.iowen.cn/favicon/v2.cn.vuejs.org/v2/guide/transitions.html.png);"></div><div class="tag-link-right"><div class="tag-link-title">Vue.js官方文档</div><div class="tag-link-sitename">进入/离开 & 列表过渡</div></div><i class="fa-solid fa-angle-right"></i></div></a>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过Highcharts制作简易甘特图</title>
      <link href="/posts/90077f97.html"/>
      <url>/posts/90077f97.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Highcharts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Node.js编写爬虫程序</title>
      <link href="/posts/f9f25371.html"/>
      <url>/posts/f9f25371.html</url>
      
        <content type="html"><![CDATA[<h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><ol><li> 连接数据库</li><li> 请求需要爬取的内容</li><li> 解析获取的数据</li><li> 写入数据库</li></ol><hr><h2 id="安装并引入所需依赖"><a href="#安装并引入所需依赖" class="headerlink" title="安装并引入所需依赖"></a>安装并引入所需依赖</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save mysql axios cheerio</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&quot;mysql&quot;</span>); <span class="comment">// 操作数据库</span></span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>); <span class="comment">// 发起请求</span></span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">&quot;cheerio&quot;</span>); <span class="comment">// 解析HTML</span></span><br></pre></td></tr></table></figure><h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> connection = mysql.<span class="title function_">createConnection</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&quot;XXXXXXX&quot;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&quot;XXXXXXX&quot;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&quot;XXXXXXX&quot;</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&quot;XXXXXXX&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line">connection.<span class="title function_">connect</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;连接失败: &quot;</span> + err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;连接成功!&quot;</span>);</span><br><span class="line">  <span class="title function_">getDouban250</span>(); <span class="comment">// 连接成功后执行爬取操作</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="请求需要爬取的内容"><a href="#请求需要爬取的内容" class="headerlink" title="请求需要爬取的内容"></a>请求需要爬取的内容</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取豆瓣电影Top250每部电影详情页面</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getDouban250</span>(<span class="params">start = <span class="number">0</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`正在获取数据(<span class="subst">$&#123;start + <span class="number">1</span>&#125;</span>~<span class="subst">$&#123;start + <span class="number">25</span>&#125;</span>)...`</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: html &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(</span><br><span class="line">    <span class="string">`https://movie.douban.com/top250?start=<span class="subst">$&#123;start&#125;</span>&amp;filter=`</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> $ = cheerio.<span class="title function_">load</span>(html);</span><br><span class="line">  <span class="keyword">let</span> urlArr = $(<span class="string">&quot;ol.grid_view &gt; li &gt; div &gt; div.pic &gt; a&quot;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">i, item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> movieUrl = $(item).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> movieUrl;</span><br><span class="line">  &#125;);</span><br><span class="line">  start += <span class="number">25</span>;</span><br><span class="line">  <span class="keyword">if</span> (start &gt;= <span class="number">250</span>) &#123;</span><br><span class="line">    <span class="comment">// 爬取结束，断开数据库</span></span><br><span class="line">    connection.<span class="title function_">end</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;over!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>);</span><br><span class="line">    <span class="title function_">getDouban250</span>(start);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="解析数据并写入数据库"><a href="#解析数据并写入数据库" class="headerlink" title="解析数据并写入数据库"></a>解析数据并写入数据库</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单部电影数据解析</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getMovieData</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: movieHtml &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(url);</span><br><span class="line">  <span class="comment">// 解析html或json</span></span><br><span class="line">  <span class="keyword">const</span> _$ = cheerio.<span class="title function_">load</span>(movieHtml);</span><br><span class="line">  <span class="keyword">const</span> info = <span class="title function_">_$</span>(<span class="string">&quot;#info&quot;</span>).<span class="title function_">html</span>().<span class="title function_">replace</span>(<span class="regexp">/\s/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> movie = &#123;</span><br><span class="line">    <span class="attr">imdb</span>: info.<span class="title function_">match</span>(<span class="regexp">/IMDb.*?&lt;br&gt;/</span>)?.[<span class="number">0</span>].<span class="title function_">replace</span>(<span class="regexp">/&lt;.*?&gt;|IMDb|:/g</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">    <span class="attr">name</span>: <span class="title function_">_$</span>(<span class="string">&quot;#content &gt; h1 &gt; span:nth-child(1)&quot;</span>).<span class="title function_">text</span>().<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>)?.[<span class="number">0</span>],</span><br><span class="line">    <span class="attr">imgUrl</span>: <span class="title function_">_$</span>(<span class="string">&quot;#mainpic &gt; a &gt; img&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>),</span><br><span class="line">    <span class="attr">detail</span>: <span class="title function_">_$</span>(<span class="string">&quot;#link-report-intra &gt; span:nth-child(1)&quot;</span>).<span class="title function_">text</span>(),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 生成sql语句</span></span><br><span class="line">  <span class="keyword">let</span> keyStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> valueStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> movie) &#123;</span><br><span class="line">    movie[key] = movie[key].<span class="title function_">replace</span>(<span class="regexp">/\s/g</span>, <span class="string">&quot;&quot;</span>).<span class="title function_">replace</span>(<span class="regexp">/&#x27;/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    keyStr += key + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    valueStr += movie[key] + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> sqlStr =</span><br><span class="line">    <span class="string">&quot;insert into douban250 (&quot;</span> +</span><br><span class="line">    keyStr.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>) +</span><br><span class="line">    <span class="string">&quot;) values (&quot;</span> +</span><br><span class="line">    valueStr.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>) +</span><br><span class="line">    <span class="string">&quot;)&quot;</span>;</span><br><span class="line">  <span class="comment">// 将数据插入数据库</span></span><br><span class="line">  connection.<span class="title function_">query</span>(sqlStr, <span class="keyword">function</span> (<span class="params">err, results, fields</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新增出错: 《&quot;</span> + movie.<span class="property">name</span> + <span class="string">&quot;》\n&quot;</span> + err);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(sqlStr);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">ms</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Node.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS在循环遍历时按同步顺序依次执行异步操作</title>
      <link href="/posts/7a3e4b9e.html"/>
      <url>/posts/7a3e4b9e.html</url>
      
        <content type="html"><![CDATA[<h2 id="错误写法"><a href="#错误写法" class="headerlink" title="错误写法"></a>错误写法</h2><p>使用<code>forEach</code>循环</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  arr.<span class="title function_">forEach</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">syncMethod</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结果：多个异步函数syncMethod()会并行执行。</span></span><br></pre></td></tr></table></figure><h2 id="正确写法"><a href="#正确写法" class="headerlink" title="正确写法"></a>正确写法</h2><p>使用<code>for i</code>循环</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">syncMethod</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结果：在上一个异步函数执行结束后再开始执行下一个。</span></span><br></pre></td></tr></table></figure><hr><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><blockquote><p><code>forEach</code>的回调函数都是同步调用的，在<code>forEach</code>的回调里进行异步操作，每次遍历进行的这些异步操作会并行执行。在 JavaScript 中几乎所有的回调函数都是异步调用的，但是<code>forEach</code>方法的回调函数是同步调用的，同样，<code>find()</code>和<code>findIndex()</code>函数也都是同步调用回调函数的。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 问题汇总 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在JavaScript中实现sleep睡眠函数</title>
      <link href="/posts/b0c81bfe.html"/>
      <url>/posts/b0c81bfe.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>JavaScript 没有内置的 sleep 函数，如需阻塞程序运行，需要自己实现。</p></blockquote><h2 id="定义-sleep-方法"><a href="#定义-sleep-方法" class="headerlink" title="定义 sleep 方法"></a>定义 sleep 方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">ms</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用-async-await-调用"><a href="#使用-async-await-调用" class="headerlink" title="使用 async await 调用"></a>使用 async await 调用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- <style>#myBtn{  padding: 5px;  border:1px solid var(--text-highlight-color);  color:var(--text-highlight-color);  background:var(--hl-bg);  border-radius:3px;}#myBtn:active{  transform:scale(0.92);}#myContainer{  margin-top:10px;  border:1px solid var(--text-highlight-color);  height:50px;  padding: 5px 10px}</style>效果：<button id="myBtn">按钮</button><div id="myContainer"></div><script>(function () {  let num = 1  let str = ""  const btn = document.querySelector("#myBtn")  const dom = document.querySelector("#myContainer")  btn.addEventListener("click", fn(3000))  function sleep(ms) {    return new Promise((resolve) => setTimeout(resolve, ms));  }  async function fn(ms) {    num = 1;    str = "";    for(let i = 0; i < 3; i++){      str=str+num+" "      myContainer.innerHTML = str      num++      await sleep(ms)    }    await sleep(5000)    myContainer.innerHTML = ""  }})();</script> -->]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>&lt;el-form&gt;根据选择条件动态控制表单必填项</title>
      <link href="/posts/a086744a.html"/>
      <url>/posts/a086744a.html</url>
      
        <content type="html"><![CDATA[<h2 id="页面效果"><a href="#页面效果" class="headerlink" title="页面效果"></a>页面效果</h2><blockquote><p>当【来款方式】= 银行来款，【来款银行】必填，选择其他选项，非必填。</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200605181354448.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200605181415889.png" alt="在这里插入图片描述"></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><blockquote><p>rules 判断要写在 el-form-item 中。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;来款方式&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;fIncomeWay&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">eIncomeWay</span> <span class="attr">v-model</span>=<span class="string">&quot;form.fIncomeWay&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form-item</span></span></span><br><span class="line"><span class="tag">    <span class="attr">label</span>=<span class="string">&quot;来款银行&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">prop</span>=<span class="string">&quot;fOppositeBank&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:rules</span>=<span class="string">&quot;form.fIncomeWay == 726 ? rules.fOppositeBank : [&#123;required: false&#125;]&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-autocomplete</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;inline-input&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;form.fOppositeBank&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:fetch-suggestions</span>=<span class="string">&quot;queryBankSearchAsync&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">value-key</span>=<span class="string">&quot;fOppositeBank&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:trigger-on-focus</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:debounce</span>=<span class="string">&quot;300&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">&quot;请输入来款银行&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:maxlength</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">el-autocomplete</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span>&#123;</span><br><span class="line">    <span class="attr">rules</span>: &#123;</span><br><span class="line"> <span class="attr">fIncomeWay</span>: [</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">     <span class="attr">message</span>: <span class="string">&quot;请选择来款方式&quot;</span>,</span><br><span class="line">     <span class="attr">trigger</span>: [<span class="string">&quot;blur&quot;</span>, <span class="string">&quot;change&quot;</span>]</span><br><span class="line">   &#125;</span><br><span class="line"> ],</span><br><span class="line"> <span class="attr">fOppositeBank</span>: [</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">     <span class="attr">message</span>: <span class="string">&quot;请输入来款银行&quot;</span>,</span><br><span class="line">     <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 问题汇总 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Element </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将一维数组按指定长度转为二维数组</title>
      <link href="/posts/bed71315.html"/>
      <url>/posts/bed71315.html</url>
      
        <content type="html"><![CDATA[<h2 id="定义转换函数"><a href="#定义转换函数" class="headerlink" title="定义转换函数"></a>定义转换函数</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">pages</span>(<span class="params">arr, len</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> pages = [];</span><br><span class="line">  arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> page = <span class="title class_">Math</span>.<span class="title function_">floor</span>(index / len);</span><br><span class="line">    <span class="keyword">if</span> (!pages[page]) &#123;</span><br><span class="line">      pages[page] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    pages[page].<span class="title function_">push</span>(item);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> pages;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">pages</span>(arr, <span class="number">3</span>)); <span class="comment">// [[1, 2, 3], [4, 5, 6], [7, 8, 9]]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">pages</span>(arr, <span class="number">8</span>)); <span class="comment">// [[1, 2, 3, 4, 5, 6, 7, 8], [9]]</span></span><br></pre></td></tr></table></figure><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>略。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文字过长超出时显示省略号</title>
      <link href="/posts/38c6db38.html"/>
      <url>/posts/38c6db38.html</url>
      
        <content type="html"><![CDATA[<h2 id="一行超出显示省略号"><a href="#一行超出显示省略号" class="headerlink" title="一行超出显示省略号"></a>一行超出显示省略号</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">overflow</span>: hidden;</span><br><span class="line"><span class="attribute">white-space</span>: nowrap;</span><br><span class="line"><span class="attribute">text-overflow</span>: ellipsis;</span><br></pre></td></tr></table></figure><style>.test1{width: 200px;background: var(--hl-bg);border: 1px solid var(--heo-fontcolor);overflow: hidden;white-space: nowrap;text-overflow: ellipsis;}</style><div class="test1">效果：超出显示省略号超出显示省略号超出显示省略号超出显示省略号超出显示省略号超出显示省略号超出显示省略号</div><h2 id="两行（多行）超出显示省略号"><a href="#两行（多行）超出显示省略号" class="headerlink" title="两行（多行）超出显示省略号"></a>两行（多行）超出显示省略号</h2><blockquote><p>显示的行数由 line-clamp 样式的值决定。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">overflow</span>: hidden;</span><br><span class="line"><span class="attribute">white-space</span>: normal;</span><br><span class="line"><span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line"><span class="attribute">display</span>: -webkit-box;</span><br><span class="line">-webkit-line-clamp: <span class="number">3</span>;</span><br><span class="line">-webkit-box-orient: vertical;</span><br></pre></td></tr></table></figure><style>.test2{width: 200px;background: var(--hl-bg);border: 1px solid var(--heo-fontcolor);overflow: hidden;white-space: normal;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 3;-webkit-box-orient: vertical;}</style><div class="test2">效果：超出显示省略号超出显示省略号超出显示省略号超出显示省略号超出显示省略号超出显示省略号超出显示省略号</div><h2 id="JS-判断是否显示了省略号"><a href="#JS-判断是否显示了省略号" class="headerlink" title="JS 判断是否显示了省略号"></a>JS 判断是否显示了省略号</h2><p>有时候我们需要知道是否已经超出，显示了省略号，可以用到<code>clientHeight</code>和<code>scrollHeight</code>的知识：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cHeight = dom.<span class="property">clientHeight</span>;</span><br><span class="line"><span class="keyword">let</span> sHeight = dom.<span class="property">scrollHeight</span>;</span><br><span class="line"><span class="keyword">if</span> (sHeight &gt; cHeight) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;已经超出显示省略号&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;没有超出&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>scrollHeight：元素内容的高度，包括由于超出导致的视图中不可见内容。不包含滚动条、边框和外边距。<br>clientHeight：元素内容的可视区的高度，包含内边距，但不包括水平滚动条、边框和外边距。<br>offsetHeight：元素的像素高度，高度包含该元素的垂直内边距和边框，且是一个整数。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pjax学习笔记</title>
      <link href="/posts/9038ba86.html"/>
      <url>/posts/9038ba86.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Pjax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>svg学习笔记</title>
      <link href="/posts/d62e2c4e.html"/>
      <url>/posts/d62e2c4e.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> SVG </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown使用说明</title>
      <link href="/posts/1f9f495d.html"/>
      <url>/posts/1f9f495d.html</url>
      
        <content type="html"><![CDATA[<h2 id="Markdown-简介"><a href="#Markdown-简介" class="headerlink" title="Markdown 简介"></a>Markdown 简介</h2><blockquote><p>Markdown 是一种轻量级的「标记语言」，它的优点很多，目前也被越来越多的写作爱好者，撰稿者广泛使用。看到这里请不要被「标记」、「语言」所迷惑，Markdown 的语法十分简单。常用的标记符号也不超过十个，这种相对于更为复杂的 HTML 标记语言来说，Markdown 可谓是十分轻量的，学习成本也不需要太多，且一旦熟悉这种语法规则，会有一劳永逸的效果。</p></blockquote><h2 id="为什么要用-MarkDown"><a href="#为什么要用-MarkDown" class="headerlink" title="为什么要用 MarkDown"></a>为什么要用 MarkDown</h2><p>有一天，想随便写点什么，就点开各种操作按键，功能强大的<em>Word</em>，间接想起论文的复杂格式和痛苦，发觉短短的几句话就用<code>.doc .docx</code>来承载实在太过大材小用，而使用<code>.txt</code>又显得不够庄重，即使在<code>Win</code>里记事本是去格式神器。</p><p>刚好这几天搭建了 Hexo 博客，与大多数大型同性社交网路都支持 Markdown，例如 github，简书，coding…….</p><p>发现，在如今越来越标准化的互联网环境下，Markdown 已经算是一套写作标准。在这几乎被 MarkDown 统治的环境下，掌握这一项技能是很重要的，无论是编程的 coder，还是写作的 writer。</p><p>工欲善其事，必先利其器</p><h3 id="创作工具"><a href="#创作工具" class="headerlink" title="创作工具"></a>创作工具</h3><p>既然下定了决心学这一门「标记语言」，就要选择一把好用的武器。在 Mac 平台相较 Win 有更多的选择，例如：</p><ul><li><a href="https://www.typora.io/">Typora</a>：如记事本一般简洁的操作，却可以书写标准 MarkDown，犹如光头般清爽。</li><li><a href="https://bear.app/">Bear</a>:图标好评，界面好评，操作好评，设备之间互联性满分，收费差评。</li><li><a href="https://macdown.uranusjr.com/">Macdown</a>:国产良心软件，免费开源，种草。</li></ul><p>对比了很多编辑软件，最终我还是选择<em>Github</em>出品的<em>Atom</em>搭配插件<em>markdown preview</em>,享受充分的个性化以及实时显示。</p><p>重要的是！</p><p>适配<em>Window</em>!!!</p><p>参考教程：<a href="https://www.jianshu.com/p/ad3e737e5dc2">Atom 与 markdown</a></p><p>进入 Atom 后的操作快捷键：</p><p>windows : <code>ctrl + shift + m</code></p><p>mac : <code>command + shift + m</code></p><h3 id="图床工具"><a href="#图床工具" class="headerlink" title="图床工具"></a>图床工具</h3><p>互联网时代，单纯的文字显得干枯，图片显得极其重要。<br>为了证明文章目标不是刊登在知音读者，就需要插一张图。</p><p><img src="https://upload-images.jianshu.io/upload_images/6402699-09313be5d30c7457.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/440/format/webp" alt="img"></p><p>IMG_1395.jpg</p><p>而选择恰当的图片又是区分专业论文和公众号搞笑推文的只要因素，所以要慎重。</p><p>那么如何让本地图片可以显示在每一台设备？那就需要上传到云端，再以链接的方式添加到*.md*文件中。</p><p>这种操作就需要使用云床，推荐：</p><ul><li><a href="https://sm.ms/">sm.ms</a>：网页版<em>sm.ms</em>还有<em>app</em>版，可以将手机里的图片上传直接返回*.md*格式，很是方便。</li><li><a href="http://weibotuchuang.sinaapp.com/">围脖图床修复计划</a>：网页端插件 图片一拖即可。</li><li><a href="https://sso.qiniu.com/">七牛</a>：开发者云储存 极其稳定 就是靠谱。</li></ul><hr><h2 id="如何使用-MarkDown？"><a href="#如何使用-MarkDown？" class="headerlink" title="如何使用 MarkDown？"></a>如何使用 MarkDown？</h2><h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p>代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一级标题</span></span><br><span class="line"><span class="comment">## 二级标题</span></span><br><span class="line"><span class="comment">### 三级标题</span></span><br><span class="line"><span class="comment">#### 四级标题</span></span><br><span class="line"><span class="comment">##### 五级标题</span></span><br><span class="line"><span class="comment">###### 六级标题</span></span><br></pre></td></tr></table></figure><p>效果：</p><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6><h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><ul><li><p>网页链接</p><ul><li><p>内联</p><ul><li>代码：<code>[百度](www.baidu.com)</code></li><li>效果：</li><li>这是一个<a href="https://link.jianshu.com/?t=www.baidu.com">百度</a>链接</li></ul></li><li><p>引用</p><ul><li><p>代码： <code>这是一个[百度][1]链接 + [1]:www.baidu.com</code></p></li><li><p>效果：</p></li><li><p>这是一个[百度][1]链接 适合同一网址多处引用</p></li></ul><p>  [1]: <a href="http://www.baidu.com/(https://link.jianshu.com?t=http://www.baidu.com/)">www.baidu.com/(https://link.jianshu.com?t=http://www.baidu.com/)</a></p></li></ul></li><li><p>图片链接</p><ul><li><p>本地</p><ul><li>代码：<code>![](/Users/zhangchenyu/Downloads/IMG_1093.JPG)</code></li><li>效果：</li><li><img src="/Users/zhangchenyu/Downloads/IMG_1093.JPG" alt="img"></li></ul></li><li><p>内联</p><ul><li><p>代码：<code>![header](http://upload-images.jianshu.io/upload_images/6402699-76a86ea2e1168545.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</code></p></li><li><p>效果：</p></li><li><p><img src="https://upload-images.jianshu.io/upload_images/6402699-76a86ea2e1168545.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/640/format/webp" alt="img"></p><p>header</p></li></ul></li></ul><p>但是，图片太大怎么办？</p><ul><li>修改图片大小<ul><li><code>![](http://upload-images.jianshu.io/upload_images/6402699-76a86ea2e1168545.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</code></li><li>效果：</li><li><img src="https://upload-images.jianshu.io/upload_images/6402699-76a86ea2e1168545.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/640/format/webp" alt="img"></li></ul></li></ul></li></ul><h3 id="强调"><a href="#强调" class="headerlink" title="强调"></a>强调</h3><ul><li>正常</li><li><code>*斜*</code> <em>斜</em></li><li><code>**粗**</code> <strong>粗</strong></li><li><code>***又粗又斜***</code> <strong><em>又粗又斜</em></strong></li><li><code>~~划线~~</code> <del>划线</del></li><li><code>&lt;u&gt;下划线&lt;/u&gt;</code> <u>下划线</u></li></ul><h3 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h3><p>***、___（3 个星号、底线）<br>华丽丽的分割线~</p><p>代码：<code>***</code></p><hr><p>代码：<code>___</code></p><hr><h3 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h3><p>代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0. 打开冰箱门</span><br><span class="line">1. 把大象塞进去</span><br><span class="line">4. 关上冰箱门</span><br></pre></td></tr></table></figure><p>效果：</p><ol><li>打开冰箱门</li><li>关上冰箱门</li><li>把大象塞进去</li></ol><p>可以看出，有序列表的顺序与编号大小有关但是与内容无关。</p><h3 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h3><p>代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 打开冰箱门</span><br><span class="line">     * 把大象塞进去</span><br><span class="line">         * 关上冰箱门</span><br></pre></td></tr></table></figure><p>效果：</p><ul><li>打开冰箱门<ul><li>把大象塞进去<ul><li>关上冰箱门</li></ul></li></ul></li></ul><p>无序列表可以根据<code>Tab</code>键调整，并且 <code>* + -</code>三个符号效果相同。</p><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p>代码：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; 打开冰箱门</span><br><span class="line"><span class="meta prompt_">&gt;&gt;</span> 把大象塞进去</span><br><span class="line">&gt;&gt;&gt; 关上冰箱门</span><br></pre></td></tr></table></figure><p>效果：</p><blockquote><p>打开冰箱门</p><blockquote><p>把大象塞进去</p><blockquote><p>关上冰箱门</p></blockquote></blockquote></blockquote><p>可见引用列表与<code>Tab</code>键无关，与<code>&gt;</code>数量有关</p><h3 id="代码区域"><a href="#代码区域" class="headerlink" title="代码区域"></a>代码区域</h3><ul><li><code>Tab</code>键缩进或连续空格</li><li><code>&#39;</code>号或<code>~</code>对应一个一行代码 三个包括区域为代码区域</li></ul><p>用 python 的头文件做示范</p><p>代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~~~</span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#! /usr/local/bin/python</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">~~~</span><br></pre></td></tr></table></figure><p>效果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#! /usr/local/bin/python</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="图表"><a href="#图表" class="headerlink" title="图表"></a>图表</h3><p>代码：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|<span class="params">第一列</span>|第二列|<span class="params">第三列</span>|</span><br><span class="line">----|<span class="params">------</span>|----</span><br><span class="line"><span class="number">1</span> |<span class="params"> 2  </span>| <span class="number">3</span></span><br><span class="line"><span class="number">1</span> |<span class="params"> 2  </span>| <span class="number">3</span></span><br><span class="line"><span class="number">1</span> |<span class="params"> 2  </span>| <span class="number">3</span></span><br></pre></td></tr></table></figure><p>效果:</p><table><thead><tr><th>第一列</th><th>第二列</th><th>第三列</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>1</td><td>2</td><td>3</td></tr></tbody></table><p>代码：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|<span class="params">第一列</span>|第二列|<span class="params">第三列</span>|</span><br><span class="line">|<span class="params">:-:</span>|<span class="symbol">:-|-</span><span class="symbol">:|</span></span><br><span class="line">|<span class="params">第一列是居中的</span>|第二列是居左的|<span class="params">第三列是居右的</span>|</span><br></pre></td></tr></table></figure><p>效果:</p><table><thead><tr><th align="center">第一列</th><th align="left">第二列</th><th align="right">第三列</th></tr></thead><tbody><tr><td align="center">第一列是居中的</td><td align="left">第二列是居左的</td><td align="right">第三列是居右的</td></tr></tbody></table><h2 id="4-使用它，爱上它"><a href="#4-使用它，爱上它" class="headerlink" title="4.使用它，爱上它"></a>4.使用它，爱上它</h2><p>无论<br>写一封邮件<br>写一篇博客<br>还是写一篇公众号推文<br>Markdown<br>让文字与图片与其彼此融合</p><p>使用它<br>并爱上它</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chrome浏览器扩展开发</title>
      <link href="/posts/870abd39.html"/>
      <url>/posts/870abd39.html</url>
      
        <content type="html"><![CDATA[<h3 id="1-什么是-Chrome-插件"><a href="#1-什么是-Chrome-插件" class="headerlink" title="1. 什么是 Chrome 插件"></a>1. 什么是 Chrome 插件</h3><p>Chrome 插件是一个用 Web 技术开发、用来增强浏览器功能的软件，它其实就是一个由 HTML、CSS、JS、图片等资源组成的一个<a href="https://developer.chrome.com/docs/extensions/mv3/hosting/">.crx</a>后缀的压缩包.</p><p>为什么是 Chrome 插件而不是 Firefox 插件</p><blockquote><ol><li>Chrome 占有率更高，更多人用；</li><li>开发更简单；</li><li>应用场景更广泛，Firefox 插件只能运行在 Firefox 上，而 Chrome 除了 Chrome 浏览器之外，还可以运行在所有 webkit 内核的国产浏览器，比如 360 极速浏览器、360 安全浏览器、搜狗浏览器、QQ 浏览器等等；</li><li>除此之外，Firefox 浏览器也对 Chrome 插件的运行提供了一定的支持；</li></ol></blockquote><h3 id="2-开发与调试"><a href="#2-开发与调试" class="headerlink" title="2.开发与调试"></a>2.开发与调试</h3><p>Chrome 插件没有严格的项目结构要求，只要保证本目录有一个<code>manifest.json</code>即可，也不需要专门的 IDE，普通的 web 开发工具即可。</p><p>从右上角菜单-&gt;更多工具-&gt;扩展程序可以进入 插件管理页面，也可以直接在地址栏输入 <a href="https://chrome//extensions">chrome://extensions</a> 访问。</p><p>勾选<code>开发者模式</code>即可以文件夹的形式直接加载插件，否则只能安装<code>.crx</code>格式的文件。Chrome 要求插件必须从它的 Chrome 应用商店安装，其它任何网站下载的都无法直接安装，所以，其实我们可以把<code>crx</code>文件解压，然后通过开发者模式直接加载。</p><p>开发中，代码有任何改动都必须重新加载插件，只需要在插件管理页按下<code>Ctrl+R</code>即可，以防万一最好还把页面刷新一下。</p><h3 id="3-核心介绍"><a href="#3-核心介绍" class="headerlink" title="3.核心介绍"></a>3.核心介绍</h3><p><code>manifest_version</code>、<code>name</code>、<code>version</code>3 个是必不可少的，<code>description</code>和<code>icons</code>是推荐的</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 清单文件的版本，这个必须写，而且必须是2</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 插件的名称</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;demo&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 插件的版本</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 插件描述</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;简单的Chrome扩展demo&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 图标，一般偷懒全部用一个尺寸的也没问题</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;48&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;128&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">    <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;background.html&quot;</span></span><br><span class="line">    <span class="comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 浏览器右上角图标设置，browser_action、page_action、app必须三选一</span></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;这是一个示例Chrome插件&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 当某些特定页面打开才显示的图标</span></span><br><span class="line">  <span class="comment">/*&quot;page_action&quot;:</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        &quot;default_icon&quot;: &quot;img/icon.png&quot;,</span></span><br><span class="line"><span class="comment">        &quot;default_title&quot;: &quot;我是pageAction&quot;,</span></span><br><span class="line"><span class="comment">        &quot;default_popup&quot;: &quot;popup.html&quot;</span></span><br><span class="line"><span class="comment">    &#125;,*/</span></span><br><span class="line">  <span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span></span><br><span class="line">      <span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line">      <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;all_urls&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/jquery-1.8.3.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;js/content-script.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">      <span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;css/custom.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_start&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 这里仅仅是为了演示content-script可以配置多个规则</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*://*/*.png&quot;</span><span class="punctuation">,</span> <span class="string">&quot;*://*/*.jpg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;*://*/*.gif&quot;</span><span class="punctuation">,</span> <span class="string">&quot;*://*/*.bmp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/show-image-content-size.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 权限申请</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;contextMenus&quot;</span><span class="punctuation">,</span> <span class="comment">// 右键菜单</span></span><br><span class="line">    <span class="string">&quot;tabs&quot;</span><span class="punctuation">,</span> <span class="comment">// 标签</span></span><br><span class="line">    <span class="string">&quot;notifications&quot;</span><span class="punctuation">,</span> <span class="comment">// 通知</span></span><br><span class="line">    <span class="string">&quot;webRequest&quot;</span><span class="punctuation">,</span> <span class="comment">// web请求</span></span><br><span class="line">    <span class="string">&quot;webRequestBlocking&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;storage&quot;</span><span class="punctuation">,</span> <span class="comment">// 插件本地存储</span></span><br><span class="line">    <span class="string">&quot;http://*/*&quot;</span><span class="punctuation">,</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">    <span class="string">&quot;https://*/*&quot;</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">  <span class="attr">&quot;web_accessible_resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/inject.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 插件主页，这个很重要，不要浪费了这个免费广告位</span></span><br><span class="line">  <span class="attr">&quot;homepage_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.baidu.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 覆盖浏览器默认页面</span></span><br><span class="line">  <span class="attr">&quot;chrome_url_overrides&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 覆盖浏览器默认的新标签页</span></span><br><span class="line">    <span class="attr">&quot;newtab&quot;</span><span class="punctuation">:</span> <span class="string">&quot;newtab.html&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">  <span class="attr">&quot;options_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;options.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// Chrome40以后的插件配置页写法，如果2个都写，新版Chrome只认后面这一个</span></span><br><span class="line">  <span class="attr">&quot;options_ui&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;options.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">    <span class="attr">&quot;chrome_style&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">  <span class="attr">&quot;omnibox&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="string">&quot;go&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 默认语言</span></span><br><span class="line">  <span class="attr">&quot;default_locale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zh_CN&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// devtools页面入口，注意只能指向一个HTML文件，不能是JS文件</span></span><br><span class="line">  <span class="attr">&quot;devtools_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;devtools.html&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-content-scripts"><a href="#4-content-scripts" class="headerlink" title="4.content-scripts"></a>4.content-scripts</h3><p>所谓<a href="https://developer.chrome.com/docs/extensions/mv3/content_scripts/">content-scripts</a>，其实就是 Chrome 插件中向页面注入脚本的一种形式（虽然名为 script，其实还可以包括 css 的），借助<code>content-scripts</code>我们可以实现通过配置的方式轻松向指定页面注入 JS 和 CSS（如果需要动态注入，可以参考下文），最常见的比如：广告屏蔽、页面 CSS 定制，等等。</p><p>示例配置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span></span><br><span class="line">      <span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line">      <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;all_urls&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/jquery-1.8.3.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;js/content-script.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">      <span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;css/custom.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_start&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>特别注意，如果没有主动指定<code>run_at</code>为<code>document_start</code>（默认为<code>document_idle</code>），下面这种代码是不会生效的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我被执行了！&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>content-scripts</code>和原始页面共享 DOM，但是不共享 JS，如要访问页面 JS（例如某个 JS 变量），只能通过<code>injected js</code>来实现。<code>content-scripts</code>不能访问绝大部分<code>chrome.xxx.api</code>，除了下面这 4 种：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="title function_">extension</span>(getURL, inIncognitoContext, lastError, onRequest, sendRequest);</span><br><span class="line"></span><br><span class="line">chrome.<span class="property">i18n</span>;</span><br><span class="line"></span><br><span class="line">chrome.<span class="title function_">runtime</span>(</span><br><span class="line">  connect,</span><br><span class="line">  getManifest,</span><br><span class="line">  getURL,</span><br><span class="line">  id,</span><br><span class="line">  onConnect,</span><br><span class="line">  onMessage,</span><br><span class="line">  sendMessage</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">chrome.<span class="property">storage</span>;</span><br></pre></td></tr></table></figure><h3 id="5-background"><a href="#5-background" class="headerlink" title="5. background"></a>5. background</h3><p>后台（姑且这么翻译吧），是一个常驻的页面，它的生命周期是插件中所有类型页面中最长的，它随着浏览器的打开而打开，随着浏览器的关闭而关闭，所以通常把需要一直运行的、启动就运行的、全局的代码放在 background 里面。</p><p>background 的权限非常高，几乎可以调用所有的 Chrome 扩展 API（除了 devtools），而且它可以无限制跨域，也就是可以跨域访问任何网站而无需要求对方设置<code>CORS</code>。</p><blockquote><p>经过测试，其实不止是 background，所有的直接通过<code>chrome-extension://id/xx.html</code>这种方式打开的网页都可以无限制跨域。</p></blockquote><p>配置中，<code>background</code>可以通过<code>page</code>指定一张网页，也可以通过<code>scripts</code>直接指定一个 JS，Chrome 会自动为这个 JS 生成一个默认的网页：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">    <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;background.html&quot;</span></span><br><span class="line">    <span class="comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>需要特别说明的是</strong>，虽然你可以通过<code>chrome-extension://xxx/background.html</code>直接打开后台页，但是你打开的后台页和真正一直在后台运行的那个页面不是同一个，换句话说，你可以打开无数个<code>background.html</code>，但是真正在后台常驻的只有一个，而且这个你永远看不到它的界面，只能调试它的代码。</p><h3 id="6-event-pages"><a href="#6-event-pages" class="headerlink" title="6. event-pages"></a>6. event-pages</h3><p>这里顺带介绍一下<a href="https://developer.chrome.com/docs/apps/event_pages/">event-pages</a>，它是一个什么东西呢？鉴于 background 生命周期太长，长时间挂载后台可能会影响性能，所以 Google 又弄一个<code>event-pages</code>，在配置文件上，它与 background 的唯一区别就是多了一个<code>persistent</code>参数：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;event-page.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>它的生命周期是：在被需要时加载，在空闲时被关闭，什么叫被需要时呢？比如第一次安装、插件更新、有 content-script 向它发送消息，等等。</p><h3 id="7-popup"><a href="#7-popup" class="headerlink" title="7. popup"></a>7. popup</h3><p><code>popup</code>是点击<code>browser_action</code>或者<code>page_action</code>图标时打开的一个小窗口网页，焦点离开网页就立即关闭，一般用来做一些临时性的交互。</p><p><code>popup</code>可以包含任意你想要的 HTML 内容，并且会自适应大小。可以通过<code>default_popup</code>字段来指定 popup 页面，也可以调用<code>setPopup()</code>方法。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;这是一个示例Chrome插件&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>需要特别注意的是</strong>，由于单击图标打开 popup，焦点离开又立即关闭，所以 popup 页面的生命周期一般很短，需要长时间运行的代码千万不要写在 popup 里面。</p><p>在权限上，它和 background 非常类似，它们之间最大的不同是生命周期的不同，popup 中可以直接通过<code>chrome.extension.getBackgroundPage()</code>获取 background 的 window 对象。</p><h3 id="8-injected-script"><a href="#8-injected-script" class="headerlink" title="8. injected-script"></a>8. injected-script</h3><p>这里的<code>injected-script</code>是我给它取的，指的是通过 DOM 操作的方式向页面注入的一种 JS。为什么要把这种 JS 单独拿出来讨论呢？又或者说为什么需要通过这种方式注入 JS 呢？</p><p>这是因为<code>content-script</code>有一个很大的“缺陷”，也就是无法访问页面中的 JS，虽然它可以操作 DOM，但是 DOM 却不能调用它，也就是无法在 DOM 中通过绑定事件的方式调用<code>content-script</code>中的代码（包括直接写<code>onclick</code>和<code>addEventListener</code>2 种方式都不行），但是，“在页面上添加一个按钮并调用插件的扩展 API”是一个很常见的需求，那该怎么办呢？其实这就是本小节要讲的。</p><p>在<code>content-script</code>中通过 DOM 方式向页面注入<code>inject-script</code>代码示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向页面注入JS</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">injectCustomJs</span>(<span class="params">jsPath</span>) &#123;</span><br><span class="line">  jsPath = jsPath || <span class="string">&quot;js/inject.js&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> temp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">  temp.<span class="title function_">setAttribute</span>(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text/javascript&quot;</span>);</span><br><span class="line">  <span class="comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span></span><br><span class="line">  temp.<span class="property">src</span> = chrome.<span class="property">extension</span>.<span class="title function_">getURL</span>(jsPath);</span><br><span class="line">  temp.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 放在页面不好看，执行完后移除掉</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你以为这样就行了？执行一下你会看到如下报错：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Denying load of chrome-<span class="keyword">extension</span>:<span class="comment">//efbllncjkjiijkppagepehoekjojdclc/js/inject.js. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.</span></span><br></pre></td></tr></table></figure><p>意思就是你想要在 web 中直接访问插件中的资源的话必须显示声明才行，配置文件中增加如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">    <span class="string">&quot;web_accessible_resources&quot;</span>: [<span class="string">&quot;js/inject.js&quot;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至于<code>inject-script</code>如何调用<code>content-script</code>中的代码，后面我会在专门的一个消息通信章节详细介绍。</p><h3 id="9-homepage-url"><a href="#9-homepage-url" class="headerlink" title="9.homepage_url"></a>9.homepage_url</h3><p>开发者或者插件主页设置，一般会在如下 2 个地方显示：</p><h3 id="10-browserAction-浏览器右上角"><a href="#10-browserAction-浏览器右上角" class="headerlink" title="10. browserAction(浏览器右上角)"></a>10. browserAction(浏览器右上角)</h3><p>通过配置<code>browser_action</code>可以在浏览器的右上角增加一个图标，一个<code>browser_action</code>可以拥有一个图标，一个<code>tooltip</code>，一个<code>badge</code>和一个<code>popup</code>。</p><p>示例配置如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;这是一个示例Chrome插件&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="10-1-图标"><a href="#10-1-图标" class="headerlink" title="10.1 图标"></a>10.1 图标</h4><p><code>browser_action</code>图标推荐使用宽高都为 19 像素的图片，更大的图标会被缩小，格式随意，一般推荐 png，可以通过 manifest 中<code>default_icon</code>字段配置，也可以调用 setIcon()方法。</p><h4 id="10-2-tooltip"><a href="#10-2-tooltip" class="headerlink" title="10.2 tooltip"></a>10.2 tooltip</h4><p>修改<code>browser_action</code>的 manifest 中<code>default_title</code>字段，或者调用<code>setTitle()</code>方法。</p><h4 id="10-3-badge"><a href="#10-3-badge" class="headerlink" title="10.3. badge"></a>10.3. badge</h4><p>所谓<code>badge</code>就是在图标上显示一些文本，可以用来更新一些小的扩展状态提示信息。因为 badge 空间有限，所以只支持 4 个以下的字符（英文 4 个，中文 2 个）。badge 无法通过配置文件来指定，必须通过代码实现，设置 badge 文字和颜色可以分别使用<code>setBadgeText()</code>和<code>setBadgeBackgroundColor()</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">browserAction</span>.<span class="title function_">setBadgeText</span>(&#123; <span class="attr">text</span>: <span class="string">&quot;new&quot;</span> &#125;);</span><br><span class="line">chrome.<span class="property">browserAction</span>.<span class="title function_">setBadgeBackgroundColor</span>(&#123; <span class="attr">color</span>: [<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>] &#125;);</span><br></pre></td></tr></table></figure><p>效果：</p><h3 id="11-pageAction-地址栏右侧"><a href="#11-pageAction-地址栏右侧" class="headerlink" title="11. pageAction(地址栏右侧)"></a>11. pageAction(地址栏右侧)</h3><p>所谓<code>pageAction</code>，指的是只有当某些特定页面打开才显示的图标，它和<code>browserAction</code>最大的区别是一个始终都显示，一个只在特定情况才显示。</p><p>需要特别说明的是早些版本的 Chrome 是将 pageAction 放在地址栏的最右边，左键单击弹出 popup，右键单击则弹出相关默认的选项菜单：</p><p>而新版的 Chrome 更改了这一策略，pageAction 和普通的 browserAction 一样也是放在浏览器右上角，只不过没有点亮时是灰色的，点亮了才是彩色的，灰色时无论左键还是右键单击都是弹出选项：</p><blockquote><p>具体是从哪一版本开始改的没去仔细考究，反正知道 v50.0 的时候还是前者，v58.0 的时候已改为后者。</p></blockquote><p>调整之后的<code>pageAction</code>我们可以简单地把它看成是可以置灰的<code>browserAction</code>。</p><ul><li>chrome.pageAction.show(tabId) 显示图标；</li><li>chrome.pageAction.hide(tabId) 隐藏图标；</li></ul><p>示例(只有打开百度才显示图标)：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;page_action&quot;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;default_icon&quot;</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;我是pageAction&quot;</span>,</span><br><span class="line">        <span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;declarativeContent&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onInstalled</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    chrome.<span class="property">declarativeContent</span>.<span class="property">onPageChanged</span>.<span class="title function_">removeRules</span>(<span class="literal">undefined</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        chrome.<span class="property">declarativeContent</span>.<span class="property">onPageChanged</span>.<span class="title function_">addRules</span>([</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">conditions</span>: [</span><br><span class="line">                    <span class="comment">// 只有打开百度才显示pageAction</span></span><br><span class="line">                    <span class="keyword">new</span> chrome.<span class="property">declarativeContent</span>.<span class="title class_">PageStateMatcher</span>(&#123;<span class="attr">pageUrl</span>: &#123;<span class="attr">urlContains</span>: <span class="string">&#x27;baidu.com&#x27;</span>&#125;&#125;)</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">actions</span>: [<span class="keyword">new</span> chrome.<span class="property">declarativeContent</span>.<span class="title class_">ShowPageAction</span>()]</span><br><span class="line">            &#125;</span><br><span class="line">        ]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>效果图：</p><h3 id="12-右键菜单"><a href="#12-右键菜单" class="headerlink" title="12. 右键菜单"></a>12. 右键菜单</h3><p>通过开发 Chrome 插件可以自定义浏览器的右键菜单，主要是通过<code>chrome.contextMenus</code>API 实现，右键菜单可以出现在不同的上下文，比如普通页面、选中的文字、图片、链接，等等，如果有同一个插件里面定义了多个菜单，Chrome 会自动组合放到以插件名字命名的二级菜单里，如下：</p><h4 id="12-1-最简单的右键菜单示例"><a href="#12-1-最简单的右键菜单示例" class="headerlink" title="12.1 最简单的右键菜单示例"></a>12.1 最简单的右键菜单示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;<span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;contextMenus&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;测试右键菜单&quot;</span>,</span><br><span class="line">    <span class="attr">onclick</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="title function_">alert</span>(<span class="string">&#x27;您点击了右键菜单！&#x27;</span>);&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>效果：</p><h4 id="12-2-添加右键百度搜索"><a href="#12-2-添加右键百度搜索" class="headerlink" title="12.2 添加右键百度搜索"></a>12.2 添加右键百度搜索</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;<span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;contextMenus&quot;</span>， <span class="string">&quot;tabs&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;使用度娘搜索：%s&#x27;</span>, <span class="comment">// %s表示选中的文字</span></span><br><span class="line">    <span class="attr">contexts</span>: [<span class="string">&#x27;selection&#x27;</span>], <span class="comment">// 只有当选中文字时才会出现此右键菜单</span></span><br><span class="line">    <span class="attr">onclick</span>: <span class="keyword">function</span>(<span class="params">params</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 注意不能使用location.href，因为location是属于background的window对象</span></span><br><span class="line">        chrome.<span class="property">tabs</span>.<span class="title function_">create</span>(&#123;<span class="attr">url</span>: <span class="string">&#x27;https://www.baidu.com/s?ie=utf-8&amp;wd=&#x27;</span> + <span class="built_in">encodeURI</span>(params.<span class="property">selectionText</span>)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>效果如下：</p><h4 id="12-3-语法说明"><a href="#12-3-语法说明" class="headerlink" title="12.3 语法说明"></a>12.3 语法说明</h4><p>这里只是简单列举一些常用的，完整 API 参见：<a href="https://developer.chrome.com/docs/extensions/reference/contextMenus/">https://developer.chrome.com/extensions/contextMenus</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;normal&#x27;</span>， <span class="comment">// 类型，可选：[&quot;normal&quot;, &quot;checkbox&quot;, &quot;radio&quot;, &quot;separator&quot;]，默认 normal</span></span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;菜单的名字&#x27;</span>, <span class="comment">// 显示的文字，除非为“separator”类型否则此参数必需，如果类型为“selection”，可以使用%s显示选定的文本</span></span><br><span class="line">    <span class="attr">contexts</span>: [<span class="string">&#x27;page&#x27;</span>], <span class="comment">// 上下文环境，可选：[&quot;all&quot;, &quot;page&quot;, &quot;frame&quot;, &quot;selection&quot;, &quot;link&quot;, &quot;editable&quot;, &quot;image&quot;, &quot;video&quot;, &quot;audio&quot;]，默认page</span></span><br><span class="line">    <span class="attr">onclick</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;, <span class="comment">// 单击时触发的方法</span></span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">1</span>, <span class="comment">// 右键菜单项的父菜单项ID。指定父菜单项将会使此菜单项成为父菜单项的子菜单</span></span><br><span class="line">    <span class="attr">documentUrlPatterns</span>: <span class="string">&#x27;https://*.baidu.com/*&#x27;</span> <span class="comment">// 只在某些页面显示此右键菜单</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 删除某一个菜单项</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">remove</span>(menuItemId)；</span><br><span class="line"><span class="comment">// 删除所有自定义右键菜单</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">removeAll</span>();</span><br><span class="line"><span class="comment">// 更新某一个菜单项</span></span><br><span class="line">chrome.<span class="property">contextMenus</span>.<span class="title function_">update</span>(menuItemId, updateProperties);</span><br></pre></td></tr></table></figure><h4 id="12-4-override-覆盖特定页面"><a href="#12-4-override-覆盖特定页面" class="headerlink" title="12.4 override(覆盖特定页面)"></a>12.4 override(覆盖特定页面)</h4><p>使用<code>override</code>页可以将 Chrome 默认的一些特定页面替换掉，改为使用扩展提供的页面。</p><p>扩展可以替代如下页面：</p><ul><li>历史记录：从工具菜单上点击历史记录时访问的页面，或者从地址栏直接输入 <a href="https://chrome//history">chrome://history</a></li><li>新标签页：当创建新标签的时候访问的页面，或者从地址栏直接输入 <a href="https://chrome//newtab">chrome://newtab</a></li><li>书签：浏览器的书签，或者直接输入 <a href="https://chrome//bookmarks">chrome://bookmarks</a></li></ul><p>注意：</p><ul><li>一个扩展只能替代一个页面；</li><li>不能替代隐身窗口的新标签页；</li><li>网页必须设置 title，否则用户可能会看到网页的 URL，造成困扰；</li></ul><p>下面的截图是默认的新标签页和被扩展替换掉的新标签页。</p><p>代码（注意，一个插件只能替代一个默认页，以下仅为演示）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;chrome_url_overrides&quot;</span>:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;newtab&quot;</span>: <span class="string">&quot;newtab.html&quot;</span>,</span><br><span class="line">    <span class="string">&quot;history&quot;</span>: <span class="string">&quot;history.html&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bookmarks&quot;</span>: <span class="string">&quot;bookmarks.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="13-option-选项页"><a href="#13-option-选项页" class="headerlink" title="13. option(选项页)"></a>13. option(选项页)</h3><p>所谓<code>options</code>页，就是插件的设置页面，有 2 个入口，一个是右键图标有一个“选项”菜单，还有一个在插件管理页面：</p><p>在 Chrome40 以前，options 页面和其它普通页面没什么区别，Chrome40 以后则有了一些变化。</p><p>我们先看老版的<a href="https://developer.chrome.com/docs/extensions/mv3/options/">options</a>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">    <span class="string">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个页面里面的内容就随你自己发挥了，配置之后在插件管理页就会看到一个<code>选项</code>按钮入口，点进去就是打开一个网页，没啥好讲的。</p><p>效果:</p><p>再来看新版的<a href="https://developer.chrome.com/docs/extensions/mv2/options/">optionsV2</a>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;options_ui&quot;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">        <span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">        <span class="string">&quot;chrome_style&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>options.html</code>的代码我们没有任何改动，只是配置文件改了，之后效果如下：</p><p>看起来是不是高大上了？</p><p>几点注意：</p><ul><li>为了兼容，建议 2 种都写，如果都写了，Chrome40 以后会默认读取新版的方式；</li><li>新版 options 中不能使用 alert；</li><li>数据存储建议用 chrome.storage，因为会随用户自动同步；</li></ul><h3 id="14-omnibox"><a href="#14-omnibox" class="headerlink" title="14. omnibox"></a>14. omnibox</h3><p><code>omnibox</code>是向用户提供搜索建议的一种方式。先来看个<code>gif</code>图以便了解一下这东西到底是个什么鬼：</p><p>注册某个关键字以触发插件自己的搜索建议界面，然后可以任意发挥了。</p><p>首先，配置文件如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">    <span class="string">&quot;omnibox&quot;</span>: &#123; <span class="string">&quot;keyword&quot;</span> : <span class="string">&quot;go&quot;</span> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后<code>background.js</code>中注册监听事件：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// omnibox 演示</span></span><br><span class="line">chrome.<span class="property">omnibox</span>.<span class="property">onInputChanged</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">text, suggest</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;inputChanged: &quot;</span> + text);</span><br><span class="line">  <span class="keyword">if</span> (!text) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (text == <span class="string">&quot;美女&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_">suggest</span>([</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;中国&quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;你要找“中国美女”吗？&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;日本&quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;你要找“日本美女”吗？&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;泰国&quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;你要找“泰国美女或人妖”吗？&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;韩国&quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;你要找“韩国美女”吗？&quot;</span> &#125;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (text == <span class="string">&quot;微博&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_">suggest</span>([</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;新浪&quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;新浪&quot;</span> + text &#125;,</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;腾讯&quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;腾讯&quot;</span> + text &#125;,</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;搜狐&quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;搜索&quot;</span> + text &#125;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">suggest</span>([</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;百度搜索 &quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;百度搜索 &quot;</span> + text &#125;,</span><br><span class="line">      &#123; <span class="attr">content</span>: <span class="string">&quot;谷歌搜索 &quot;</span> + text, <span class="attr">description</span>: <span class="string">&quot;谷歌搜索 &quot;</span> + text &#125;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当用户接收关键字建议时触发</span></span><br><span class="line">chrome.<span class="property">omnibox</span>.<span class="property">onInputEntered</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;inputEntered: &quot;</span> + text);</span><br><span class="line">  <span class="keyword">if</span> (!text) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> href = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (text.<span class="title function_">endsWith</span>(<span class="string">&quot;美女&quot;</span>))</span><br><span class="line">    href =</span><br><span class="line">      <span class="string">&quot;http://image.baidu.com/search/index?tn=baiduimage&amp;ie=utf-8&amp;word=&quot;</span> + text;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (text.<span class="title function_">startsWith</span>(<span class="string">&quot;百度搜索&quot;</span>))</span><br><span class="line">    href =</span><br><span class="line">      <span class="string">&quot;https://www.baidu.com/s?ie=UTF-8&amp;wd=&quot;</span> + text.<span class="title function_">replace</span>(<span class="string">&quot;百度搜索 &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (text.<span class="title function_">startsWith</span>(<span class="string">&quot;谷歌搜索&quot;</span>))</span><br><span class="line">    href =</span><br><span class="line">      <span class="string">&quot;https://www.google.com.tw/search?q=&quot;</span> + text.<span class="title function_">replace</span>(<span class="string">&quot;谷歌搜索 &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span> href = <span class="string">&quot;https://www.baidu.com/s?ie=UTF-8&amp;wd=&quot;</span> + text;</span><br><span class="line">  <span class="title function_">openUrlCurrentTab</span>(href);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentTabId</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">  chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span> &#125;, <span class="keyword">function</span> (<span class="params">tabs</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (callback) <span class="title function_">callback</span>(tabs.<span class="property">length</span> ? tabs[<span class="number">0</span>].<span class="property">id</span> : <span class="literal">null</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前标签打开某个链接</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">openUrlCurrentTab</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="title function_">getCurrentTabId</span>(<span class="function">(<span class="params">tabId</span>) =&gt;</span> &#123;</span><br><span class="line">    chrome.<span class="property">tabs</span>.<span class="title function_">update</span>(tabId, &#123; <span class="attr">url</span>: url &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="15-桌面通知"><a href="#15-桌面通知" class="headerlink" title="15. 桌面通知"></a>15. 桌面通知</h3><p>Chrome 提供了一个<code>chrome.notifications</code>API 以便插件推送桌面通知，暂未找到<code>chrome.notifications</code>和 HTML5 自带的<code>Notification</code>的显著区别及优势。</p><p>在后台 JS 中，无论是使用<code>chrome.notifications</code>还是<code>Notification</code>都不需要申请权限（HTML5 方式需要申请权限），直接使用即可。</p><p>最简单的通知：</p><p>代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">notifications</span>.<span class="title function_">create</span>(<span class="literal">null</span>, &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;basic&quot;</span>,</span><br><span class="line">  <span class="attr">iconUrl</span>: <span class="string">&quot;img/icon.png&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;这是标题&quot;</span>,</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&quot;您刚才点击了自定义右键菜单！&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>通知的样式可以很丰富：</p><p>这个没有深入研究，有需要的可以去看官方文档。</p><h3 id="16-5-种类型的-JS-对比"><a href="#16-5-种类型的-JS-对比" class="headerlink" title="16.5 种类型的 JS 对比"></a>16.5 种类型的 JS 对比</h3><p>Chrome 插件的 JS 主要可以分为这 5 类：<code>injected script</code>、<code>content-script</code>、<code>popup js</code>、<code>background js</code>和<code>devtools js</code>，</p><h4 id="16-1-权限对比"><a href="#16-1-权限对比" class="headerlink" title="16.1 权限对比"></a>16.1 权限对比</h4><table><thead><tr><th>JS 种类</th><th>可访问的 API</th><th>DOM 访问情况</th><th>JS 访问情况</th><th>直接跨域</th></tr></thead><tbody><tr><td>injected script</td><td>和普通 JS 无任何差别，不能访问任何扩展 API</td><td>可以访问</td><td>可以访问</td><td>不可以</td></tr><tr><td>content script</td><td>只能访问 extension、runtime 等部分 API</td><td>可以访问</td><td>不可以</td><td>不可以</td></tr><tr><td>popup js</td><td>可访问绝大部分 API，除了 devtools 系列</td><td>不可直接访问</td><td>不可以</td><td>可以</td></tr><tr><td>background js</td><td>可访问绝大部分 API，除了 devtools 系列</td><td>不可直接访问</td><td>不可以</td><td>可以</td></tr><tr><td>devtools js</td><td>只能访问 devtools、extension、runtime 等部分 API</td><td>可以</td><td>可以</td><td>不可以</td></tr></tbody></table><h4 id="16-2-调试方式对比"><a href="#16-2-调试方式对比" class="headerlink" title="16.2 调试方式对比"></a>16.2 调试方式对比</h4><table><thead><tr><th>JS 类型</th><th>调试方式</th><th>图片说明</th></tr></thead><tbody><tr><td>injected script</td><td>直接普通的 F12 即可</td><td>懒得截图</td></tr><tr><td>content-script</td><td>打开 Console,如图切换</td><td></td></tr><tr><td>popup-js</td><td>popup 页面右键审查元素</td><td></td></tr><tr><td>background</td><td>插件管理页点击背景页即可</td><td></td></tr><tr><td>devtools-js</td><td>暂未找到有效方法</td><td>-</td></tr></tbody></table><h3 id="17-消息通信"><a href="#17-消息通信" class="headerlink" title="17.消息通信"></a>17.消息通信</h3><p>通信主页：<a href="https://developer.chrome.com/docs/extensions/mv3/messaging/">https://developer.chrome.com/extensions/messaging</a></p><p>前面我们介绍了 Chrome 插件中存在的 5 种 JS，那么它们之间如何互相通信呢？下面先来系统概况一下，然后再分类细说。需要知道的是，popup 和 background 其实几乎可以视为一种东西，因为它们可访问的 API 都一样、通信机制一样、都可以跨域。</p><h4 id="17-1-互相通信概览"><a href="#17-1-互相通信概览" class="headerlink" title="17.1 互相通信概览"></a>17.1 互相通信概览</h4><p>注：<code>-</code>表示不存在或者无意义，或者待验证。</p><table><thead><tr><th></th><th>injected-script</th><th>content-script</th><th>popup-js</th><th>background-js</th></tr></thead><tbody><tr><td>injected-script</td><td>-</td><td>window.postMessage</td><td>-</td><td>-</td></tr><tr><td>content-script</td><td>window.postMessage</td><td>-</td><td>chrome.runtime.sendMessage chrome.runtime.connect</td><td>chrome.runtime.sendMessage chrome.runtime.connect</td></tr><tr><td>popup-js</td><td>-</td><td>chrome.tabs.sendMessage chrome.tabs.connect</td><td>-</td><td>chrome.extension. getBackgroundPage()</td></tr><tr><td>background-js</td><td>-</td><td>chrome.tabs.sendMessage chrome.tabs.connect</td><td>chrome.extension.getViews</td><td>-</td></tr><tr><td>devtools-js</td><td>chrome.devtools. inspectedWindow.eval</td><td>-</td><td>chrome.runtime.sendMessage</td><td>chrome.runtime.sendMessage</td></tr></tbody></table><h4 id="17-2-通信详细介绍"><a href="#17-2-通信详细介绍" class="headerlink" title="17.2. 通信详细介绍"></a>17.2. 通信详细介绍</h4><h5 id="17-2-1-popup-和-background"><a href="#17-2-1-popup-和-background" class="headerlink" title="17.2.1. popup 和 background"></a>17.2.1. popup 和 background</h5><p>popup 可以直接调用 background 中的 JS 方法，也可以直接访问 background 的 DOM：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;我是background！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// popup.js</span></span><br><span class="line"><span class="keyword">var</span> bg = chrome.<span class="property">extension</span>.<span class="title function_">getBackgroundPage</span>();</span><br><span class="line">bg.<span class="title function_">test</span>(); <span class="comment">// 访问bg的函数</span></span><br><span class="line"><span class="title function_">alert</span>(bg.<span class="property">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span>); <span class="comment">// 访问bg的DOM</span></span><br></pre></td></tr></table></figure><blockquote><p>小插曲，今天碰到一个情况，发现 popup 无法获取 background 的任何方法，找了半天才发现是因为 background 的 js 报错了，而你如果不主动查看 background 的 js 的话，是看不到错误信息的，特此提醒。</p></blockquote><p>至于<code>background</code>访问<code>popup</code>如下（前提是<code>popup</code>已经打开）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> views = chrome.<span class="property">extension</span>.<span class="title function_">getViews</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;popup&quot;</span> &#125;);</span><br><span class="line"><span class="keyword">if</span> (views.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(views[<span class="number">0</span>].<span class="property">location</span>.<span class="property">href</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="17-2-2-popup-或者-bg-向-content-主动发送消息"><a href="#17-2-2-popup-或者-bg-向-content-主动发送消息" class="headerlink" title="17.2.2. popup 或者 bg 向 content 主动发送消息"></a>17.2.2. popup 或者 bg 向 content 主动发送消息</h5><p>background.js 或者 popup.js：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sendMessageToContentScript</span>(<span class="params">message, callback</span>) &#123;</span><br><span class="line">  chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span> &#125;, <span class="keyword">function</span> (<span class="params">tabs</span>) &#123;</span><br><span class="line">    chrome.<span class="property">tabs</span>.<span class="title function_">sendMessage</span>(tabs[<span class="number">0</span>].<span class="property">id</span>, message, <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (callback) <span class="title function_">callback</span>(response);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sendMessageToContentScript</span>(</span><br><span class="line">  &#123; <span class="attr">cmd</span>: <span class="string">&quot;test&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;你好，我是popup！&quot;</span> &#125;,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;来自content的回复：&quot;</span> + response);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>content-script.js</code>接收：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params">request, sender, sendResponse</span>) &#123;</span><br><span class="line">  <span class="comment">// console.log(sender.tab ?&quot;from a content script:&quot; + sender.tab.url :&quot;from the extension&quot;);</span></span><br><span class="line">  <span class="keyword">if</span> (request.<span class="property">cmd</span> == <span class="string">&quot;test&quot;</span>) <span class="title function_">alert</span>(request.<span class="property">value</span>);</span><br><span class="line">  <span class="title function_">sendResponse</span>(<span class="string">&quot;我收到了你的消息！&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>双方通信直接发送的都是 JSON 对象，不是 JSON 字符串，所以无需解析，很方便（当然也可以直接发送字符串）。</p><blockquote><p>网上有些老代码中用的是<code>chrome.extension.onMessage</code>，没有完全查清二者的区别(貌似是别名)，但是建议统一使用<code>chrome.runtime.onMessage</code>。</p></blockquote><h5 id="17-2-3-content-script-主动发消息给后台"><a href="#17-2-3-content-script-主动发消息给后台" class="headerlink" title="17.2.3. content-script 主动发消息给后台"></a>17.2.3. content-script 主动发消息给后台</h5><p>content-script.js：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="title function_">sendMessage</span>(</span><br><span class="line">  &#123; <span class="attr">greeting</span>: <span class="string">&quot;你好，我是content-script呀，我主动发消息给后台！&quot;</span> &#125;,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到来自后台的回复：&quot;</span> + response);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>background.js 或者 popup.js：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听来自content-script的消息</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params">request, sender, sendResponse</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到来自content-script的消息：&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(request, sender, sendResponse);</span><br><span class="line">  <span class="title function_">sendResponse</span>(<span class="string">&quot;我是后台，我已收到你的消息：&quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(request));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>注意事项：</p><ul><li>content_scripts 向<code>popup</code>主动发消息的前提是 popup 必须打开！否则需要利用 background 作中转；</li><li>如果 background 和 popup 同时监听，那么它们都可以同时收到消息，但是只有一个可以 sendResponse，一个先发送了，那么另外一个再发送就无效；</li></ul><h5 id="17-2-4-injected-script-和-content-script"><a href="#17-2-4-injected-script-和-content-script" class="headerlink" title="17.2.4. injected script 和 content-script"></a>17.2.4. injected script 和 content-script</h5><p><code>content-script</code>和页面内的脚本（<code>injected-script</code>自然也属于页面内的脚本）之间唯一共享的东西就是页面的 DOM 元素，有 2 种方法可以实现二者通讯：</p><ol><li>可以通过<code>window.postMessage</code>和<code>window.addEventListener</code>来实现二者消息通讯；</li><li>通过自定义 DOM 事件来实现；</li></ol><p>第一种方法（推荐）：</p><p><code>injected-script</code>中：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123; <span class="attr">test</span>: <span class="string">&quot;你好！&quot;</span> &#125;, <span class="string">&quot;*&quot;</span>);</span><br></pre></td></tr></table></figure><p>content script 中：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;message&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>第二种方法：</p><p><code>injected-script</code>中：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> customEvent = <span class="variable language_">document</span>.<span class="title function_">createEvent</span>(<span class="string">&quot;Event&quot;</span>);</span><br><span class="line">customEvent.<span class="title function_">initEvent</span>(<span class="string">&quot;myCustomEvent&quot;</span>, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fireCustomEvent</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  hiddenDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;myCustomEventDiv&quot;</span>);</span><br><span class="line">  hiddenDiv.<span class="property">innerText</span> = data;</span><br><span class="line">  hiddenDiv.<span class="title function_">dispatchEvent</span>(customEvent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fireCustomEvent</span>(<span class="string">&quot;你好，我是普通JS！&quot;</span>);</span><br></pre></td></tr></table></figure><p><code>content-script.js</code>中：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hiddenDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;myCustomEventDiv&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!hiddenDiv) &#123;</span><br><span class="line">  hiddenDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">  hiddenDiv.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(hiddenDiv);</span><br><span class="line">&#125;</span><br><span class="line">hiddenDiv.<span class="title function_">addEventListener</span>(<span class="string">&quot;myCustomEvent&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> eventData = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;myCustomEventDiv&quot;</span>).<span class="property">innerText</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到自定义事件消息：&quot;</span> + eventData);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="17-3-长连接和短连接"><a href="#17-3-长连接和短连接" class="headerlink" title="17.3. 长连接和短连接"></a>17.3. 长连接和短连接</h4><p>其实上面已经涉及到了，这里再单独说明一下。Chrome 插件中有 2 种通信方式，一个是短连接（<code>chrome.tabs.sendMessage</code>和<code>chrome.runtime.sendMessage</code>），一个是长连接（<code>chrome.tabs.connect</code>和<code>chrome.runtime.connect</code>）。</p><p>短连接的话就是挤牙膏一样，我发送一下，你收到了再回复一下，如果对方不回复，你只能重新发，而长连接类似<code>WebSocket</code>会一直建立连接，双方可以随时互发消息。</p><p>短连接上面已经有代码示例了，这里只讲一下长连接。</p><p>popup.js：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getCurrentTabId</span>(<span class="function">(<span class="params">tabId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> port = chrome.<span class="property">tabs</span>.<span class="title function_">connect</span>(tabId, &#123; <span class="attr">name</span>: <span class="string">&quot;test-connect&quot;</span> &#125;);</span><br><span class="line">  port.<span class="title function_">postMessage</span>(&#123; <span class="attr">question</span>: <span class="string">&quot;你是谁啊？&quot;</span> &#125;);</span><br><span class="line">  port.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;收到消息：&quot;</span> + msg.<span class="property">answer</span>);</span><br><span class="line">    <span class="keyword">if</span> (msg.<span class="property">answer</span> &amp;&amp; msg.<span class="property">answer</span>.<span class="title function_">startsWith</span>(<span class="string">&quot;我是&quot;</span>)) &#123;</span><br><span class="line">      port.<span class="title function_">postMessage</span>(&#123; <span class="attr">question</span>: <span class="string">&quot;哦，原来是你啊！&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>content-script.js：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听长连接</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onConnect</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params">port</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(port);</span><br><span class="line">  <span class="keyword">if</span> (port.<span class="property">name</span> == <span class="string">&quot;test-connect&quot;</span>) &#123;</span><br><span class="line">    port.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到长连接消息：&quot;</span>, msg);</span><br><span class="line">      <span class="keyword">if</span> (msg.<span class="property">question</span> == <span class="string">&quot;你是谁啊？&quot;</span>)</span><br><span class="line">        port.<span class="title function_">postMessage</span>(&#123; <span class="attr">answer</span>: <span class="string">&quot;我是你爸！&quot;</span> &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="18-其他重要知识点"><a href="#18-其他重要知识点" class="headerlink" title="18.其他重要知识点"></a>18.其他重要知识点</h3><h4 id="18-1-动态注入或执行-JS"><a href="#18-1-动态注入或执行-JS" class="headerlink" title="18.1. 动态注入或执行 JS"></a>18.1. 动态注入或执行 JS</h4><p>虽然在<code>background</code>和<code>popup</code>中无法直接访问页面 DOM，但是可以通过<code>chrome.tabs.executeScript</code>来执行脚本，从而实现访问 web 页面的 DOM（注意，这种方式也不能直接访问页面 JS）。</p><p>示例<code>manifest.json</code>配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;动态JS注入演示&quot;</span>,</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&quot;permissions&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;tabs&quot;</span>, <span class="string">&quot;http://*/*&quot;</span>, <span class="string">&quot;https://*/*&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JS：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态执行JS代码</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">executeScript</span>(tabId, &#123;</span><br><span class="line">  <span class="attr">code</span>: <span class="string">&#x27;document.body.style.backgroundColor=&quot;red&quot;&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 动态执行JS文件</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">executeScript</span>(tabId, &#123; <span class="attr">file</span>: <span class="string">&quot;some-script.js&quot;</span> &#125;);</span><br></pre></td></tr></table></figure><h4 id="18-2-动态注入-CSS"><a href="#18-2-动态注入-CSS" class="headerlink" title="18.2. 动态注入 CSS"></a>18.2. 动态注入 CSS</h4><p>示例<code>manifest.json</code>配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;动态CSS注入演示&quot;</span>,</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&quot;permissions&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;tabs&quot;</span>, <span class="string">&quot;http://*/*&quot;</span>, <span class="string">&quot;https://*/*&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JS 代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态执行CSS代码，TODO，这里有待验证</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">insertCSS</span>(tabId, &#123; <span class="attr">code</span>: <span class="string">&quot;xxx&quot;</span> &#125;);</span><br><span class="line"><span class="comment">// 动态执行CSS文件</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">insertCSS</span>(tabId, &#123; <span class="attr">file</span>: <span class="string">&quot;some-style.css&quot;</span> &#125;);</span><br></pre></td></tr></table></figure><h4 id="18-3-获取当前窗口-ID"><a href="#18-3-获取当前窗口-ID" class="headerlink" title="18.3. 获取当前窗口 ID"></a>18.3. 获取当前窗口 ID</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">windows</span>.<span class="title function_">getCurrent</span>(<span class="keyword">function</span> (<span class="params">currentWindow</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;当前窗口ID：&quot;</span> + currentWindow.<span class="property">id</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="18-4-获取当前标签页-ID"><a href="#18-4-获取当前标签页-ID" class="headerlink" title="18.4 获取当前标签页 ID"></a>18.4 获取当前标签页 ID</h4><p>一般有 2 种方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentTabId</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">  chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span> &#125;, <span class="keyword">function</span> (<span class="params">tabs</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (callback) <span class="title function_">callback</span>(tabs.<span class="property">length</span> ? tabs[<span class="number">0</span>].<span class="property">id</span> : <span class="literal">null</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取当前选项卡 id 的另一种方法，大部分时候都类似，只有少部分时候会不一样（例如当窗口最小化时）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentTabId2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  chrome.<span class="property">windows</span>.<span class="title function_">getCurrent</span>(<span class="keyword">function</span> (<span class="params">currentWindow</span>) &#123;</span><br><span class="line">    chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(</span><br><span class="line">      &#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">windowId</span>: currentWindow.<span class="property">id</span> &#125;,</span><br><span class="line">      <span class="keyword">function</span> (<span class="params">tabs</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (callback) <span class="title function_">callback</span>(tabs.<span class="property">length</span> ? tabs[<span class="number">0</span>].<span class="property">id</span> : <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="18-5-本地存储"><a href="#18-5-本地存储" class="headerlink" title="18.5. 本地存储"></a>18.5. 本地存储</h4><p>本地存储建议用<code>chrome.storage</code>而不是普通的<code>localStorage</code>，区别有好几点，个人认为最重要的 2 点区别是：</p><ul><li><code>chrome.storage</code>是针对插件全局的，即使你在<code>background</code>中保存的数据，在<code>content-script</code>也能获取到；</li><li><code>chrome.storage.sync</code>可以跟随当前登录用户自动同步，这台电脑修改的设置会自动同步到其它电脑，很方便，如果没有登录或者未联网则先保存到本地，等登录了再同步至网络；</li></ul><p>需要声明<code>storage</code>权限，有<code>chrome.storage.sync</code>和<code>chrome.storage.local</code>2 种方式可供选择，使用示例如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取数据，第一个参数是指定要读取的key以及设置默认值</span></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">get</span>(&#123; <span class="attr">color</span>: <span class="string">&quot;red&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;, <span class="keyword">function</span> (<span class="params">items</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(items.<span class="property">color</span>, items.<span class="property">age</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 保存数据</span></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">set</span>(&#123; <span class="attr">color</span>: <span class="string">&quot;blue&quot;</span> &#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;保存成功！&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="18-6-webRequest"><a href="#18-6-webRequest" class="headerlink" title="18.6. webRequest"></a>18.6. webRequest</h4><p>通过 webRequest 系列 API 可以对 HTTP 请求进行任性地修改、定制，这里通过<code>beforeRequest</code>来简单演示一下它的冰山一角：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 权限申请</span></span><br><span class="line">    <span class="string">&quot;permissions&quot;</span>:</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;webRequest&quot;</span>, <span class="comment">// web请求</span></span><br><span class="line">        <span class="string">&quot;webRequestBlocking&quot;</span>, <span class="comment">// 阻塞式web请求</span></span><br><span class="line">        <span class="string">&quot;storage&quot;</span>, <span class="comment">// 插件本地存储</span></span><br><span class="line">        <span class="string">&quot;http://*/*&quot;</span>, <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">        <span class="string">&quot;https://*/*&quot;</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="comment">// 是否显示图片</span></span><br><span class="line"><span class="keyword">var</span> showImage;</span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">sync</span>.<span class="title function_">get</span>(&#123;<span class="attr">showImage</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span>(<span class="params">items</span>) &#123;</span><br><span class="line">    showImage = items.<span class="property">showImage</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// web请求监听，最后一个参数表示阻塞式，需单独声明权限：webRequestBlocking</span></span><br><span class="line">chrome.<span class="property">webRequest</span>.<span class="property">onBeforeRequest</span>.<span class="title function_">addListener</span>(<span class="function"><span class="params">details</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// cancel 表示取消本次请求</span></span><br><span class="line">    <span class="keyword">if</span>(!showImage &amp;&amp; details.<span class="property">type</span> == <span class="string">&#x27;image&#x27;</span>) <span class="keyword">return</span> &#123;<span class="attr">cancel</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">    <span class="comment">// 简单的音视频检测</span></span><br><span class="line">    <span class="comment">// 大部分网站视频的type并不是media，且视频做了防下载处理，所以这里仅仅是为了演示效果，无实际意义</span></span><br><span class="line">    <span class="keyword">if</span>(details.<span class="property">type</span> == <span class="string">&#x27;media&#x27;</span>) &#123;</span><br><span class="line">        chrome.<span class="property">notifications</span>.<span class="title function_">create</span>(<span class="literal">null</span>, &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;basic&#x27;</span>,</span><br><span class="line">            <span class="attr">iconUrl</span>: <span class="string">&#x27;img/icon.png&#x27;</span>,</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;检测到音视频&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;音视频地址：&#x27;</span> + details.<span class="property">url</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;<span class="attr">urls</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>]&#125;, [<span class="string">&quot;blocking&quot;</span>]);</span><br></pre></td></tr></table></figure><h4 id="18-7-国际化"><a href="#18-7-国际化" class="headerlink" title="18.7. 国际化"></a>18.7. 国际化</h4><p>插件根目录新建一个名为<code>_locales</code>的文件夹，再在下面新建一些语言的文件夹，如<code>en</code>、<code>zh_CN</code>、<code>zh_TW</code>，然后再在每个文件夹放入一个<code>messages.json</code>，同时必须在清单文件中设置<code>default_locale</code>。</p><p><code>_locales\en\messages.json</code>内容：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;pluginDesc&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;A simple chrome extension demo&quot;</span>&#125;,</span><br><span class="line">    <span class="string">&quot;helloWorld&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World!&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>_locales\zh_CN\messages.json</code>内容：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;pluginDesc&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;一个简单的Chrome插件demo&quot;</span>&#125;,</span><br><span class="line">    <span class="string">&quot;helloWorld&quot;</span>: &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;你好啊，世界！&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>manifest.json</code>和<code>CSS</code>文件中通过<code>__MSG_messagename__</code>引入，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;__MSG_pluginDesc__&quot;</span>,</span><br><span class="line">    <span class="comment">// 默认语言</span></span><br><span class="line">    <span class="string">&quot;default_locale&quot;</span>: <span class="string">&quot;zh_CN&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JS 中则直接<code>chrome.i18n.getMessage(&quot;helloWorld&quot;)</code>。</p><p>测试时，通过给 chrome 建立一个不同的快捷方式<code>chrome.exe --lang=en</code>来切换语言，如：</p><p><img src="https://upload-images.jianshu.io/upload_images/23753054-f7913a40eac13f49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/422/format/webp" alt="img"></p><p>英文效果：<img src="https://upload-images.jianshu.io/upload_images/23753054-1fb17212e09cd1ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/492/format/webp" alt="img"></p><p>中文效果：<img src="https://upload-images.jianshu.io/upload_images/23753054-a50d43b22cfcdbb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/507/format/webp" alt="img"></p><h4 id="18-8-API-总结"><a href="#18-8-API-总结" class="headerlink" title="18.8. API 总结"></a>18.8. API 总结</h4><p>比较常用用的一些 API 系列：</p><ul><li>chrome.tabs</li><li>chrome.runtime</li><li>chrome.webRequest</li><li>chrome.window</li><li>chrome.storage</li><li>chrome.contextMenus</li><li>chrome.devtools</li><li>chrome.extension</li></ul><hr><p>作者：William92<br>链接：<a href="https://www.jianshu.com/p/72727465ab86">https://www.jianshu.com/p/72727465ab86</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Chrome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Autojs脚本开发</title>
      <link href="/posts/86ce39c9.html"/>
      <url>/posts/86ce39c9.html</url>
      
        <content type="html"><![CDATA[<h2 id="Autojs-概述"><a href="#Autojs-概述" class="headerlink" title="Autojs 概述"></a>Autojs 概述</h2><h3 id="1、Autojs-是什么，能做什么？"><a href="#1、Autojs-是什么，能做什么？" class="headerlink" title="1、Autojs 是什么，能做什么？"></a>1、Autojs 是什么，能做什么？</h3><ul><li><p>**不需要 Root 权限 ** 的 JavaScript 自动化 软件</p></li><li><p>基于无障碍服务接口</p></li><li><p>官网：<a href="https://hyb1996.github.io/AutoJs-Docs/#/">https://hyb1996.github.io/AutoJs-Docs/#/</a></p></li><li><p>开发 APP 脚本</p></li><li><p>自动化操作、引流脚本、游戏脚本、简单 app</p></li></ul><h3 id="2、Autojs-各版本之间的区别"><a href="#2、Autojs-各版本之间的区别" class="headerlink" title="2、Autojs 各版本之间的区别"></a>2、Autojs 各版本之间的区别</h3><ul><li><p>4.1.1 版本</p></li><li><p>7.0.0 pro 版本</p></li><li><p>8.0.0 pro 版本</p></li></ul><h3 id="3、Autojs-的学习路径和学习方法"><a href="#3、Autojs-的学习路径和学习方法" class="headerlink" title="3、Autojs 的学习路径和学习方法"></a>3、Autojs 的学习路径和学习方法</h3><ul><li><p>基础入门 JavaScript</p></li><li><p>ES6 语法</p></li><li><p>Autojs 文档</p></li><li><p>Autojs 示例</p></li><li><p>Autojs 实战</p></li></ul><hr><ul><li><p>专业程序员的培训方式</p></li><li><p>Autojs 英语单词入门</p></li><li><p>Autojs 代码书写规范</p></li><li><p>Autojs 错误调试和分析</p></li><li><p>每天直播答疑解惑</p></li></ul><h2 id="Autojs-脚本开发环境搭建"><a href="#Autojs-脚本开发环境搭建" class="headerlink" title="Autojs 脚本开发环境搭建"></a>Autojs 脚本开发环境搭建</h2><h3 id="1、autojs-软件安装及简单使用"><a href="#1、autojs-软件安装及简单使用" class="headerlink" title="1、autojs 软件安装及简单使用"></a>1、autojs 软件安装及简单使用</h3><ul><li><p>4.1.1 版本的安装</p></li><li><p>8.0 pro 版本的安装</p></li><li><p>简单熟悉一下 autojs 软件</p></li></ul><h3 id="2、安卓手机投屏软件的安装和使用"><a href="#2、安卓手机投屏软件的安装和使用" class="headerlink" title="2、安卓手机投屏软件的安装和使用"></a>2、安卓手机投屏软件的安装和使用</h3><h3 id="3、雷电模拟器的安装和使用"><a href="#3、雷电模拟器的安装和使用" class="headerlink" title="3、雷电模拟器的安装和使用"></a>3、雷电模拟器的安装和使用</h3><h3 id="4、VScode-编辑器的安装和使用"><a href="#4、VScode-编辑器的安装和使用" class="headerlink" title="4、VScode 编辑器的安装和使用"></a>4、VScode 编辑器的安装和使用</h3><h3 id="5、autojs-插件安装和使用"><a href="#5、autojs-插件安装和使用" class="headerlink" title="5、autojs 插件安装和使用"></a>5、autojs 插件安装和使用</h3><ul><li><p>hyb1996</p></li><li><p>ctrl+shift+p</p></li></ul><h3 id="6、autojs-手机端（模拟器端）和电脑端相互连接"><a href="#6、autojs-手机端（模拟器端）和电脑端相互连接" class="headerlink" title="6、autojs 手机端（模拟器端）和电脑端相互连接"></a>6、autojs 手机端（模拟器端）和电脑端相互连接</h3><ul><li><p>手机和电脑务必在同一个局域网下</p></li><li><p>4.1.1 版本的电脑端需要开启 autojs 服务</p></li><li><p>ipconfig 查看本机 IP 地址</p></li><li><p>安卓版本需要在 7.0 以上</p></li></ul><h3 id="7、编写第一个-autojs-脚本并打包成-apk"><a href="#7、编写第一个-autojs-脚本并打包成-apk" class="headerlink" title="7、编写第一个 autojs 脚本并打包成 apk"></a>7、编写第一个 autojs 脚本并打包成 apk</h3><ul><li>保存 js 文件到手机</li></ul><h2 id="应用-—-APP"><a href="#应用-—-APP" class="headerlink" title="应用 — APP"></a>应用 — APP</h2><h3 id="1、关于-APP-版本的命令"><a href="#1、关于-APP-版本的命令" class="headerlink" title="1、关于 APP 版本的命令"></a>1、关于 APP 版本的命令</h3><h4 id="app-versionCode"><a href="#app-versionCode" class="headerlink" title="app.versionCode"></a>app.versionCode</h4><ul><li>当前软件版本号</li></ul><h4 id="app-versionName"><a href="#app-versionName" class="headerlink" title="app.versionName"></a>app.versionName</h4><ul><li>当前软件版本名称</li></ul><h4 id="app-autojs-versionCode"><a href="#app-autojs-versionCode" class="headerlink" title="app.autojs.versionCode"></a>app.autojs.versionCode</h4><ul><li>autojs 版本号</li></ul><h4 id="app-autojs-versionName"><a href="#app-autojs-versionName" class="headerlink" title="app.autojs.versionName"></a>app.autojs.versionName</h4><ul><li>autojs 版本名称</li></ul><h3 id="2、打开-APP"><a href="#2、打开-APP" class="headerlink" title="2、打开 APP"></a>2、打开 APP</h3><h4 id="app-launchApp-appName"><a href="#app-launchApp-appName" class="headerlink" title="app.launchApp(appName)"></a>app.launchApp(appName)</h4><ul><li>通过 APP 名称打开 APP</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该函数也可以作为全局函数使用。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//打开autojs</span></span><br><span class="line"><span class="title function_">launchApp</span>(<span class="string">&quot;Auto.js&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="app-launch-packageName"><a href="#app-launch-packageName" class="headerlink" title="app.launch(packageName)"></a>app.launch(packageName)</h4><ul><li>通过 APP 包名打开 APP</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//另一种写法</span></span><br><span class="line">app.<span class="title function_">launchPackage</span>(packageName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//该函数也可以作为全局函数使用。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//启动微信</span></span><br><span class="line"><span class="title function_">launch</span>(<span class="string">&quot;com.tencent.mm&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="app-getPackageName-appName"><a href="#app-getPackageName-appName" class="headerlink" title="app.getPackageName(appName)"></a>app.getPackageName(appName)</h4><ul><li><p>获取应用名称对应的已安装的应用的包名。</p></li><li><p>如果该找不到该应用，返回 null；如果该名称对应多个应用，则只返回其中某一个的包名。</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该函数也可以作为全局函数使用。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="title function_">getPackageName</span>(<span class="string">&quot;QQ&quot;</span>); <span class="comment">//返回&quot;com.tencent.mobileqq&quot;</span></span><br></pre></td></tr></table></figure><h4 id="app-getAppName-packageName"><a href="#app-getAppName-packageName" class="headerlink" title="app.getAppName(packageName)"></a>app.getAppName(packageName)</h4><ul><li>获取应用包名对应的已安装的应用的名称。如果该找不到该应用，返回 null。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该函数也可以作为全局函数使用。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="title function_">getAppName</span>(<span class="string">&quot;com.tencent.mobileqq&quot;</span>); <span class="comment">//返回&quot;QQ&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3、查看和编辑文件"><a href="#3、查看和编辑文件" class="headerlink" title="3、查看和编辑文件"></a>3、查看和编辑文件</h3><h4 id="app-viewFile-path"><a href="#app-viewFile-path" class="headerlink" title="app.viewFile(path)"></a>app.viewFile(path)</h4><ul><li>用其他应用查看文件。文件不存在的情况由查看文件的应用处理。</li></ul><h4 id="app-editFile-path"><a href="#app-editFile-path" class="headerlink" title="app.editFile(path)"></a>app.editFile(path)</h4><ul><li>用其他应用编辑文件。文件不存在的情况由编辑文件的应用处理。</li></ul><h3 id="4、APP-的安装和卸载"><a href="#4、APP-的安装和卸载" class="headerlink" title="4、APP 的安装和卸载"></a>4、APP 的安装和卸载</h3><h4 id="app-uninstall-packageName"><a href="#app-uninstall-packageName" class="headerlink" title="app.uninstall(packageName)"></a>app.uninstall(packageName)</h4><ul><li>卸载应用。执行后会会弹出卸载应用的提示框。如果该包名的应用未安装，由应用卸载程序处理，可能弹出”未找到应用”的提示。</li></ul><h4 id="app-viewFile-path-1"><a href="#app-viewFile-path-1" class="headerlink" title="app.viewFile(path)"></a>app.viewFile(path)</h4><ul><li>path：apk 的地址</li></ul><h3 id="5、不同的跳转方式"><a href="#5、不同的跳转方式" class="headerlink" title="5、不同的跳转方式"></a>5、不同的跳转方式</h3><h4 id="app-openAppSetting-packageName"><a href="#app-openAppSetting-packageName" class="headerlink" title="app.openAppSetting(packageName)"></a>app.openAppSetting(packageName)</h4><ul><li><p>打开应用的详情页(设置页)。如果找不到该应用，返回 false; 否则返回 true。</p></li><li><p>该函数也可以作为全局函数使用。</p></li></ul><h4 id="app-startActivity-name"><a href="#app-startActivity-name" class="headerlink" title="app.startActivity(name)"></a>app.startActivity(name)</h4><ul><li><p>启动 Auto.js 的特定界面。该函数在 Auto.js 内运行则会打开 Auto.js 内的界面，在打包应用中运行则会打开打包应用的相应界面。</p></li><li><p><code>name</code> {string} 活动名称，可选的值为:</p></li><li><p><code>console</code> 日志界面</p></li><li><p><code>settings</code> 设置界面</p></li></ul><h4 id="app-openUrl-url"><a href="#app-openUrl-url" class="headerlink" title="app.openUrl(url)"></a>app.openUrl(url)</h4><ul><li>用浏览器打开网站 url。</li></ul><h3 id="6、自动发送邮件"><a href="#6、自动发送邮件" class="headerlink" title="6、自动发送邮件"></a>6、自动发送邮件</h3><h4 id="app-sendEmail-options"><a href="#app-sendEmail-options" class="headerlink" title="app.sendEmail(options)"></a>app.sendEmail(options)</h4><ul><li><p>options</p><p>{Object} 发送邮件的参数。包括:</p><ul><li><code>email</code> {string} | {Array} 收件人的邮件地址。如果有多个收件人，则用字符串数组表示</li><li><code>cc</code> {string} | {Array} 抄送收件人的邮件地址。如果有多个抄送收件人，则用字符串数组表示</li><li><code>bcc</code> {string} | {Array} 密送收件人的邮件地址。如果有多个密送收件人，则用字符串数组表示</li><li><code>subject</code> {string} 邮件主题(标题)</li><li><code>text</code> {string} 邮件正文</li><li><code>attachment</code> {string} 附件的路径。</li></ul></li><li><p>根据选项 options 调用邮箱应用发送邮件。这些选项均是可选的。</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送邮件给10086@qq.com和10001@qq.com。</span></span><br><span class="line">app.<span class="title function_">sendEmail</span>(&#123;</span><br><span class="line">  <span class="attr">email</span>: [<span class="string">&quot;10086@qq.com&quot;</span>, <span class="string">&quot;10001@qq.com&quot;</span>],</span><br><span class="line">  <span class="attr">subject</span>: <span class="string">&quot;这是一个邮件标题&quot;</span>,</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&quot;这是邮件正文&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="一般全局函数-Globals"><a href="#一般全局函数-Globals" class="headerlink" title="一般全局函数 - Globals"></a>一般全局函数 - Globals</h2><h2 id="悬浮窗-Floaty"><a href="#悬浮窗-Floaty" class="headerlink" title="悬浮窗 - Floaty"></a>悬浮窗 - Floaty</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">悬浮窗在脚本停止运行时会自动关闭，因此，要保持悬浮窗不被关闭，可以用一个空的<span class="built_in">setInterval</span>来实现，例如：</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">()=&gt;</span>&#123;&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h2 id="1、创建和关闭悬浮窗"><a href="#1、创建和关闭悬浮窗" class="headerlink" title="1、创建和关闭悬浮窗"></a>1、创建和关闭悬浮窗</h2><h3 id="floaty-window-layout"><a href="#floaty-window-layout" class="headerlink" title="floaty.window(layout)"></a>floaty.window(layout)</h3><ul><li><p>创建并<strong>显示</strong>一个悬浮窗</p></li><li><p>返回一个<code>FloatyWindow</code>对象。</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var w = floaty.window(</span><br><span class="line"><span class="tag">&lt;<span class="name">frame</span> <span class="attr">gravity</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span>&gt;</span>悬浮文字<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">frame</span>&gt;</span></span><br><span class="line">); setTimeout(()=&gt;&#123; w.close(); &#125;, 2000);</span><br></pre></td></tr></table></figure><ul><li>因为脚本运行的线程不是 UI 线程，而所有对控件的修改操作需要在 UI 线程执行，此时需要用<code>ui.run</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ui.<span class="title function_">run</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  w.<span class="property">text</span>.<span class="title function_">setText</span>(<span class="string">&quot;文本&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="floaty-rawWindow-layout"><a href="#floaty-rawWindow-layout" class="headerlink" title="floaty.rawWindow(layout)"></a>floaty.rawWindow(layout)</h3><ul><li><p>创建并<strong>显示</strong>一个原始悬浮窗，返回一个<code>FloatyRawWindow</code>对象</p></li><li><p>与<code>floaty.window()</code>函数不同的是，该悬浮窗不会增加任何额外设施（例如调整大小、位置按钮），您可以根据自己需要编写任何布局。</p></li><li><p>而且，该悬浮窗支持完全全屏，可以覆盖状态栏，因此可以做护眼模式之类的应用</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var w = floaty.rawWindow(</span><br><span class="line"><span class="tag">&lt;<span class="name">frame</span> <span class="attr">gravity</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span>&gt;</span>悬浮文字<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">frame</span>&gt;</span></span><br><span class="line">); w.setPosition(500, 500); setTimeout(()=&gt;&#123; w.close(); &#125;, 2000);</span><br></pre></td></tr></table></figure><h3 id="floaty-closeAll"><a href="#floaty-closeAll" class="headerlink" title="floaty.closeAll()"></a>floaty.closeAll()</h3><ul><li>关闭所有悬浮窗</li></ul><h2 id="2、FloatyWindow-对象"><a href="#2、FloatyWindow-对象" class="headerlink" title="2、FloatyWindow 对象"></a>2、FloatyWindow 对象</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">悬浮窗对象，可通过FloatyWindow.&#123;id&#125;获取悬浮窗界面上的元素。例如, 悬浮窗window上一个控件的id为aaa, 那么window.aaa即可获取到该控件，类似于ui。</span><br></pre></td></tr></table></figure><h3 id="FloatyWindow-setAdjustEnabled-enabled"><a href="#FloatyWindow-setAdjustEnabled-enabled" class="headerlink" title="FloatyWindow.setAdjustEnabled(enabled)"></a>FloatyWindow.setAdjustEnabled(enabled)</h3><ul><li><p>是否启用悬浮窗调整(大小、位置)</p></li><li><p>ture 启用 false 不启用</p></li></ul><h3 id="FloatyWindow-setPosition-x-y"><a href="#FloatyWindow-setPosition-x-y" class="headerlink" title="FloatyWindow.setPosition(x, y)"></a>FloatyWindow.setPosition(x, y)</h3><ul><li>设置悬浮窗位置</li></ul><h3 id="FloatyWindow-getX"><a href="#FloatyWindow-getX" class="headerlink" title="FloatyWindow.getX()"></a>FloatyWindow.getX()</h3><ul><li>返回悬浮窗位置的 X 坐标。</li></ul><h3 id="FloatyWindow-getY"><a href="#FloatyWindow-getY" class="headerlink" title="FloatyWindow.getY()"></a>FloatyWindow.getY()</h3><ul><li>返回悬浮窗位置的 Y 坐标。</li></ul><h3 id="FloatyWindow-setSize-width-height"><a href="#FloatyWindow-setSize-width-height" class="headerlink" title="FloatyWindow.setSize(width, height)"></a>FloatyWindow.setSize(width, height)</h3><ul><li>设置悬浮窗宽高。</li></ul><h3 id="FloatyWindow-getWidth"><a href="#FloatyWindow-getWidth" class="headerlink" title="FloatyWindow.getWidth()"></a>FloatyWindow.getWidth()</h3><ul><li>返回悬浮窗宽度。</li></ul><h3 id="FloatyWindow-getHeight"><a href="#FloatyWindow-getHeight" class="headerlink" title="FloatyWindow.getHeight()"></a>FloatyWindow.getHeight()</h3><ul><li>返回悬浮窗高度。</li></ul><h3 id="FloatyWindow-close"><a href="#FloatyWindow-close" class="headerlink" title="FloatyWindow.close()"></a>FloatyWindow.close()</h3><ul><li><p>关闭悬浮窗。如果悬浮窗已经是关闭状态，则此函数将不执行任何操作。</p><p>被关闭后的悬浮窗不能再显示。</p></li></ul><h3 id="FloatyWindow-exitOnClose"><a href="#FloatyWindow-exitOnClose" class="headerlink" title="FloatyWindow.exitOnClose()"></a>FloatyWindow.exitOnClose()</h3><ul><li>使悬浮窗被关闭时自动结束脚本运行</li></ul><h2 id="3、FloatyRawWindow-对象"><a href="#3、FloatyRawWindow-对象" class="headerlink" title="3、FloatyRawWindow 对象"></a>3、FloatyRawWindow 对象</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">原始悬浮窗对象，可通过window.&#123;id&#125;获取悬浮窗界面上的元素。例如, 悬浮窗window上一个控件的id为aaa, 那么window.aaa即可获取到该控件，类似于ui。</span><br></pre></td></tr></table></figure><h3 id="FloatyRawWindow-setTouchable-touchable"><a href="#FloatyRawWindow-setTouchable-touchable" class="headerlink" title="FloatyRawWindow.setTouchable(touchable)"></a>FloatyRawWindow.setTouchable(touchable)</h3><ul><li><p><code>touchable</code> {Boolean} 是否可触摸</p></li><li><p>true 可触摸悬浮窗 false 不可触摸悬浮窗</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var w = floaty.rawWindow(</span><br><span class="line">    &lt;frame gravity=&quot;center&quot; bg=&quot;##44ffcc00&quot;/&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">w.setSize(-1, -1);</span><br><span class="line">w.setTouchable(false);</span><br><span class="line"></span><br><span class="line">setTimeout(()=&gt;&#123;</span><br><span class="line">    w.close();</span><br><span class="line">&#125;, 4000);</span><br></pre></td></tr></table></figure><h3 id="FloatyRawWindow-setPosition-x-y"><a href="#FloatyRawWindow-setPosition-x-y" class="headerlink" title="FloatyRawWindow.setPosition(x, y)"></a>FloatyRawWindow.setPosition(x, y)</h3><ul><li>设置悬浮窗位置</li></ul><h3 id="FloatyRawWindow-getX"><a href="#FloatyRawWindow-getX" class="headerlink" title="FloatyRawWindow.getX()"></a>FloatyRawWindow.getX()</h3><ul><li>返回悬浮窗位置的 X 坐标。</li></ul><h3 id="FloatyRawWindow-getY"><a href="#FloatyRawWindow-getY" class="headerlink" title="FloatyRawWindow.getY()"></a>FloatyRawWindow.getY()</h3><ul><li>返回悬浮窗位置的 Y 坐标。</li></ul><h3 id="FloatyRawWindow-setSize-width-height"><a href="#FloatyRawWindow-setSize-width-height" class="headerlink" title="FloatyRawWindow.setSize(width, height)"></a>FloatyRawWindow.setSize(width, height)</h3><ul><li><p>设置悬浮窗宽高。</p></li><li><p>如果设置为-1，则为占满全屏；</p></li></ul><h3 id="FloatyRawWindow-getWidth"><a href="#FloatyRawWindow-getWidth" class="headerlink" title="FloatyRawWindow.getWidth()"></a>FloatyRawWindow.getWidth()</h3><ul><li>返回悬浮窗宽度。</li></ul><h3 id="FloatyRawWindow-getHeight"><a href="#FloatyRawWindow-getHeight" class="headerlink" title="FloatyRawWindow.getHeight()"></a>FloatyRawWindow.getHeight()</h3><ul><li>返回悬浮窗高度。</li></ul><h3 id="FloatyRawWindow-close"><a href="#FloatyRawWindow-close" class="headerlink" title="FloatyRawWindow.close()"></a>FloatyRawWindow.close()</h3><ul><li><p>关闭悬浮窗。如果悬浮窗已经是关闭状态，则此函数将不执行任何操作。</p><p>被关闭后的悬浮窗不能再显示。</p></li></ul><h3 id="FloatyRawWindow-exitOnClose"><a href="#FloatyRawWindow-exitOnClose" class="headerlink" title="FloatyRawWindow.exitOnClose()"></a>FloatyRawWindow.exitOnClose()</h3><ul><li>使悬浮窗被关闭时自动结束脚本运行</li></ul><h2 id="脚本引擎-Engines"><a href="#脚本引擎-Engines" class="headerlink" title="脚本引擎 - Engines"></a>脚本引擎 - Engines</h2><p>engines 模块包含了一些与脚本环境、脚本运行、脚本引擎有关的函数，包括运行其他脚本，关闭脚本等。</p><p>例如，获取脚本所在目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">toast(engines.myEngine().cwd());</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1、在脚本引擎中运行脚本"><a href="#1、在脚本引擎中运行脚本" class="headerlink" title="1、在脚本引擎中运行脚本"></a>1、在脚本引擎中运行脚本</h2><h3 id="engines-execScript-name-script-config"><a href="#engines-execScript-name-script-config" class="headerlink" title="engines.execScript(name, script[, config])"></a>engines.execScript(name, script[, config])</h3><ul><li><code>name</code> {string} 要运行的脚本名称。这个名称和文件名称无关，只是在任务管理中显示的名称。</li><li><code>script</code> {string} 要运行的脚本内容。</li><li><code>config</code>{Object} 运行配置项<ul><li><code>delay</code> {number} 延迟执行的毫秒数，默认为 0</li><li><code>loopTimes</code> {number} 循环运行次数，默认为 1。0 为无限循环。</li><li><code>interval</code> {number} 循环运行时两次运行之间的时间间隔，默认为 0</li><li><code>path</code> {Array} | {string} 指定脚本运行的目录。这些路径会用于 require 时寻找模块文件。</li></ul></li></ul><p>在新脚本环境中运行脚本 script。返回一个 ScriptExectuion 对象。</p><p>所谓新的脚本环境，指定是，脚本中的变量和原脚本的变量是不共享的，并且，脚本会在新的线程中运行。</p><p>最简单的例子如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">engines.execScript(&quot;hello world&quot;, &quot;toast(&#x27;hello world&#x27;)&quot;);</span><br></pre></td></tr></table></figure><p>如果要循环运行，则：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//每隔3秒运行一次脚本，循环10次</span><br><span class="line">engines.execScript(&quot;hello world&quot;, &quot;toast(&#x27;hello world&#x27;)&quot;, &#123;</span><br><span class="line">    loopTimes: 10,</span><br><span class="line">    interval: 3000</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>用字符串来编写脚本非常不方便，可以结合 <code>Function.toString()</code>的方法来执行特定函数:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function helloWorld()&#123;</span><br><span class="line">    //注意，这里的变量和脚本主体的变量并不共享</span><br><span class="line">    toast(&quot;hello world&quot;);</span><br><span class="line">&#125;</span><br><span class="line">engines.execScript(&quot;hello world&quot;, &quot;helloWorld();\n&quot; + helloWorld.toString());</span><br></pre></td></tr></table></figure><p>如果要传递变量，则可以把这些封装成一个函数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//在新的脚本环境中执行 1 + 2</span><br><span class="line">exec(add, &#123;a: 1, b:2&#125;);</span><br><span class="line"></span><br><span class="line">function exec(action, args)&#123;</span><br><span class="line">    args = args || &#123;&#125;;</span><br><span class="line">    var tmp = action.toString();</span><br><span class="line">    var re = /function\s*(\w*)/i;</span><br><span class="line">    var matches = re.exec(tmp);//方法名</span><br><span class="line">    var name=matches[1];</span><br><span class="line">    engines.execScript(name, name + &quot;(&quot; + JSON.stringify(args) + &quot;);\n&quot; + action.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// var tmp = ddd.toString();</span><br><span class="line">// var re = /function\s*(\w*)/i;</span><br><span class="line">// var matches = re.exec(tmp);//方法名</span><br><span class="line">// var name=matches[1];</span><br><span class="line">// log(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//要执行的函数，是一个简单的加法</span><br><span class="line">function ddd(args)&#123;</span><br><span class="line">    toast(args.a + args.b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2、在脚本引擎中运行-js-文件"><a href="#2、在脚本引擎中运行-js-文件" class="headerlink" title="2、在脚本引擎中运行 js 文件"></a>2、在脚本引擎中运行 js 文件</h2><h3 id="engines-execScriptFile-path-config"><a href="#engines-execScriptFile-path-config" class="headerlink" title="engines.execScriptFile(path[, config])"></a>engines.execScriptFile(path[, config])</h3><ul><li><code>path</code> {string} 要运行的脚本路径。</li><li><code>config</code>{Object} 运行配置项<ul><li><code>delay</code> {number} 延迟执行的毫秒数，默认为 0</li><li><code>loopTimes</code> {number} 循环运行次数，默认为 1。0 为无限循环。</li><li><code>interval</code> {number} 循环运行时两次运行之间的时间间隔，默认为 0</li><li><code>path</code> {Array} | {string} 指定脚本运行的目录。这些路径会用于 require 时寻找模块文件。</li></ul></li></ul><p>在新的脚本环境中运行脚本文件 path。返回一个<a href="https://hyb1996.github.io/AutoJs-Docs/##/engines?id=scriptexecution">ScriptExecution</a>对象。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">engines.execScriptFile(&quot;/sdcard/脚本/1.js&quot;);</span><br></pre></td></tr></table></figure><h2 id="3、在脚本引擎中运行录制的脚本文件"><a href="#3、在脚本引擎中运行录制的脚本文件" class="headerlink" title="3、在脚本引擎中运行录制的脚本文件"></a>3、在脚本引擎中运行录制的脚本文件</h2><h3 id="engines-execAutoFile-path-config"><a href="#engines-execAutoFile-path-config" class="headerlink" title="engines.execAutoFile(path[, config])"></a>engines.execAutoFile(path[, config])</h3><ul><li><code>path</code> {string} 要运行的录制文件路径。</li><li><code>config</code>{Object} 运行配置项<ul><li><code>delay</code> {number} 延迟执行的毫秒数，默认为 0</li><li><code>loopTimes</code> {number} 循环运行次数，默认为 1。0 为无限循环。</li><li><code>interval</code> {number} 循环运行时两次运行之间的时间间隔，默认为 0</li><li><code>path</code> {Array} | {string} 指定脚本运行的目录。这些路径会用于 require 时寻找模块文件。</li></ul></li></ul><p>在新的脚本环境中运行录制文件 path。返回一个 ScriptExecution 对象。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">engines.execAutoFile(&quot;/sdcard/脚本/1.auto&quot;);</span><br></pre></td></tr></table></figure><h2 id="4、脚本引擎控制方法"><a href="#4、脚本引擎控制方法" class="headerlink" title="4、脚本引擎控制方法"></a>4、脚本引擎控制方法</h2><h3 id="engines-stopAll"><a href="#engines-stopAll" class="headerlink" title="engines.stopAll()"></a>engines.stopAll()</h3><ul><li>停止所有正在运行的脚本。包括当前脚本自身</li></ul><h3 id="engines-stopAllAndToast"><a href="#engines-stopAllAndToast" class="headerlink" title="engines.stopAllAndToast()"></a>engines.stopAllAndToast()</h3><ul><li>停止所有正在运行的脚本并显示停止的脚本数量。包括当前脚本自身。</li></ul><h3 id="engines-myEngine"><a href="#engines-myEngine" class="headerlink" title="engines.myEngine()"></a>engines.myEngine()</h3><ul><li>返回当前脚本的脚本引擎对象(ScriptEngine）</li></ul><p>ScriptExecution 执行对象</p><p>ScriptEngine 引擎对象</p><h3 id="engines-all"><a href="#engines-all" class="headerlink" title="engines.all()"></a>engines.all()</h3><ul><li>返回当前所有正在运行的脚本的脚本引擎对象 ScriptEngine 的数组。</li></ul><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h2 id="5、脚本执行对象–ScriptExecution"><a href="#5、脚本执行对象–ScriptExecution" class="headerlink" title="5、脚本执行对象–ScriptExecution"></a>5、脚本执行对象–ScriptExecution</h2><p>执行脚本时返回的对象，可以通过他获取执行的引擎、配置等，也可以停止这个执行。</p><p>要停止这个脚本的执行，使用<code>ScriptExecution.getEngine().forceStop()</code></p><h3 id="ScriptExecution-getEngine"><a href="#ScriptExecution-getEngine" class="headerlink" title="ScriptExecution.getEngine()"></a>ScriptExecution.getEngine()</h3><ul><li>返回执行该脚本的脚本引擎对象(ScriptEngine)</li></ul><h3 id="ScriptExecution-getConfig"><a href="#ScriptExecution-getConfig" class="headerlink" title="ScriptExecution.getConfig()"></a>ScriptExecution.getConfig()</h3><ul><li>返回该脚本的运行配置(ScriptConfig)</li></ul><h2 id="6、脚本引擎对象–ScriptEngine"><a href="#6、脚本引擎对象–ScriptEngine" class="headerlink" title="6、脚本引擎对象–ScriptEngine"></a>6、脚本引擎对象–ScriptEngine</h2><h3 id="ScriptEngine-forceStop"><a href="#ScriptEngine-forceStop" class="headerlink" title="ScriptEngine.forceStop()"></a>ScriptEngine.forceStop()</h3><ul><li>停止脚本引擎的执行</li></ul><h3 id="ScriptEngine-cwd"><a href="#ScriptEngine-cwd" class="headerlink" title="ScriptEngine.cwd()"></a>ScriptEngine.cwd()</h3><ul><li><p>返回脚本执行的路径。对于一个脚本文件而言为这个脚本所在的文件夹；</p></li><li><p>对于其他脚本，例如字符串脚本，则为<code>null</code>或者执行时的设置值。</p></li></ul><h3 id="ScriptEngine-getSource"><a href="#ScriptEngine-getSource" class="headerlink" title="ScriptEngine.getSource()"></a>ScriptEngine.getSource()</h3><ul><li><p>返回当前脚本引擎正在执行的脚本对象。</p></li><li><p>返回脚本路径</p></li></ul><h2 id="7、脚本引擎之间的通信"><a href="#7、脚本引擎之间的通信" class="headerlink" title="7、脚本引擎之间的通信"></a>7、脚本引擎之间的通信</h2><h3 id="ScriptEngine-emit-eventName-…args"><a href="#ScriptEngine-emit-eventName-…args" class="headerlink" title="ScriptEngine.emit(eventName[, …args])"></a>ScriptEngine.emit(eventName[, …args])</h3><ul><li><code>eventName</code> {string} 事件名称</li><li><code>...args</code> {any} 事件参数</li></ul><p>向该脚本引擎发送一个事件，该事件可以在该脚本引擎对应的脚本的 events 模块监听到并在脚本主线程执行事件处理。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">例如脚本receiver.<span class="property">js</span>的内容如下：</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听say事件</span></span><br><span class="line">events.<span class="title function_">on</span>(<span class="string">&quot;say&quot;</span>, <span class="keyword">function</span>(<span class="params">words</span>)&#123;</span><br><span class="line">    <span class="title function_">toastLog</span>(words);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//保持脚本运行</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">()=&gt;</span>&#123;&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//运行脚本</span></span><br><span class="line"><span class="keyword">var</span> e = engines.<span class="title function_">execScriptFile</span>(<span class="string">&quot;./receiver.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//等待脚本启动</span></span><br><span class="line"><span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//向该脚本发送事件</span></span><br><span class="line">e.<span class="title function_">getEngine</span>().<span class="title function_">emit</span>(<span class="string">&quot;say&quot;</span>, <span class="string">&quot;你好&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="8、脚本引擎配置–ScriptConfig"><a href="#8、脚本引擎配置–ScriptConfig" class="headerlink" title="8、脚本引擎配置–ScriptConfig"></a>8、脚本引擎配置–ScriptConfig</h2><h3 id="delay"><a href="#delay" class="headerlink" title="delay"></a>delay</h3><ul><li>延迟执行的毫秒数</li></ul><h3 id="interval"><a href="#interval" class="headerlink" title="interval"></a>interval</h3><ul><li>循环运行时两次运行之间的时间间隔</li></ul><h3 id="loopTimes"><a href="#loopTimes" class="headerlink" title="loopTimes"></a>loopTimes</h3><ul><li>循环运行次数</li></ul><h3 id="getPath"><a href="#getPath" class="headerlink" title="getPath()"></a>getPath()</h3><ul><li>返回一个字符串数组表示脚本运行时模块寻找的路径</li></ul><h2 id="一般全局函数-Globals-1"><a href="#一般全局函数-Globals-1" class="headerlink" title="一般全局函数 - Globals"></a>一般全局函数 - Globals</h2><h2 id="1、常用的全局函数"><a href="#1、常用的全局函数" class="headerlink" title="1、常用的全局函数"></a>1、常用的全局函数</h2><h3 id="sleep-n"><a href="#sleep-n" class="headerlink" title="sleep(n)"></a>sleep(n)</h3><ul><li>暂停运行 n 毫秒的时间。1 秒等于 1000 毫秒。</li></ul><h3 id="toast-message"><a href="#toast-message" class="headerlink" title="toast(message)"></a>toast(message)</h3><ul><li>以气泡显示信息 message 几秒。(具体时间取决于安卓系统，一般都是 2 秒)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//保证每次显示完成</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _toast_ = toast;</span><br><span class="line">toast = <span class="keyword">function</span> (<span class="params">message</span>) &#123;</span><br><span class="line">  <span class="title function_">_toast_</span>(message);</span><br><span class="line">  <span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">  <span class="title function_">toast</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="log-message"><a href="#log-message" class="headerlink" title="log(message)"></a>log(message)</h3><ul><li>在控制台调试输出信息</li></ul><h3 id="toastLog-message"><a href="#toastLog-message" class="headerlink" title="toastLog(message)"></a>toastLog(message)</h3><ul><li>在控制台和气泡中同时输出信息</li></ul><h3 id="exit"><a href="#exit" class="headerlink" title="exit()"></a>exit()</h3><ul><li>立即停止脚本运行。</li></ul><h2 id="2、返回当前监测包名和-Activity"><a href="#2、返回当前监测包名和-Activity" class="headerlink" title="2、返回当前监测包名和 Activity"></a>2、返回当前监测包名和 Activity</h2><h3 id="currentPackage"><a href="#currentPackage" class="headerlink" title="currentPackage()"></a>currentPackage()</h3><ul><li>返回最近一次监测到的正在运行的应用的包名，一般可以认为就是当前正在运行的应用的包名。</li></ul><h3 id="currentActivity"><a href="#currentActivity" class="headerlink" title="currentActivity()"></a>currentActivity()</h3><ul><li>返回最近一次监测到的正在运行的 Activity 的名称，一般可以认为就是当前正在运行的 Activity 的名称。</li></ul><h2 id="3、等待包名和-Activity-的出现"><a href="#3、等待包名和-Activity-的出现" class="headerlink" title="3、等待包名和 Activity 的出现"></a>3、等待包名和 Activity 的出现</h2><h3 id="waitForActivity-activity-period-200"><a href="#waitForActivity-activity-period-200" class="headerlink" title="waitForActivity(activity[, period = 200])"></a>waitForActivity(activity[, period = 200])</h3><ul><li><code>activity</code> Activity 名称</li><li><code>period</code> 轮询等待间隔（毫秒）</li></ul><p>等待指定的 Activity 出现，period 为检查 Activity 的间隔。</p><h3 id="waitForPackage-package-period-200"><a href="#waitForPackage-package-period-200" class="headerlink" title="waitForPackage(package[, period = 200])"></a>waitForPackage(package[, period = 200])</h3><ul><li><code>package</code> 包名</li><li><code>period</code> 轮询等待间隔（毫秒）</li></ul><p>等待指定的应用出现。例如<code>waitForPackage(&quot;com.tencent.mm&quot;)</code>为等待当前界面为微信。</p><h2 id="4、剪切板：实现复制粘贴功能"><a href="#4、剪切板：实现复制粘贴功能" class="headerlink" title="4、剪切板：实现复制粘贴功能"></a>4、剪切板：实现复制粘贴功能</h2><h3 id="setClip-text"><a href="#setClip-text" class="headerlink" title="setClip(text)"></a>setClip(text)</h3><ul><li>设置剪贴板内容。此剪贴板即系统剪贴板，在一般应用的输入框中”粘贴”既可使用。</li></ul><h3 id="getClip"><a href="#getClip" class="headerlink" title="getClip()"></a>getClip()</h3><ul><li>返回系统剪贴板的内容。</li></ul><h3 id="paste"><a href="#paste" class="headerlink" title="paste()"></a>paste()</h3><ul><li>粘贴</li></ul><h2 id="5、获取随机数"><a href="#5、获取随机数" class="headerlink" title="5、获取随机数"></a>5、获取随机数</h2><h3 id="random"><a href="#random" class="headerlink" title="random()"></a>random()</h3><ul><li>返回在[0, 1)的随机浮点数。</li></ul><h3 id="random-min-max"><a href="#random-min-max" class="headerlink" title="random(min, max)"></a>random(min, max)</h3><ul><li>返回一个在[min…max]之间的随机数。例如 random(0, 2)可能产生 0, 1, 2。</li></ul><h2 id="6、适配安卓版本和-Autojs-版本"><a href="#6、适配安卓版本和-Autojs-版本" class="headerlink" title="6、适配安卓版本和 Autojs 版本"></a>6、适配安卓版本和 Autojs 版本</h2><h3 id="requiresApi-api"><a href="#requiresApi-api" class="headerlink" title="requiresApi(api)"></a>requiresApi(api)</h3><ul><li><p>表示此脚本需要 Android API 版本达到指定版本才能运行。例如<code>requiresApi(19)</code>表示脚本需要在 Android 4.4 以及以上运行。</p></li><li><p>调用该函数时会判断运行脚本的设备系统的版本号，如果没有达到要求则抛出异常。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">平台版本： API级别</span><br><span class="line"></span><br><span class="line">Android 7.0： 24</span><br><span class="line"></span><br><span class="line">Android 6.0： 23</span><br><span class="line"></span><br><span class="line">Android 5.1： 22</span><br><span class="line"></span><br><span class="line">Android 5.0： 21</span><br><span class="line"></span><br><span class="line">Android 4.4W： 20</span><br><span class="line"></span><br><span class="line">Android 4.4： 19</span><br><span class="line"></span><br><span class="line">Android 4.3： 18</span><br></pre></td></tr></table></figure></li></ul><h3 id="requiresAutojsVersion-version"><a href="#requiresAutojsVersion-version" class="headerlink" title="requiresAutojsVersion(version)"></a>requiresAutojsVersion(version)</h3><ul><li><p><code>version</code> {string} | {number} Auto.js 的版本或版本号</p></li><li><p>表示此脚本需要 Auto.js 版本达到指定版本才能运行。例如<code>requiresAutojsVersion(&quot;3.0.0 Beta&quot;)</code>表示脚本需要在 Auto.js 3.0.0 Beta 以及以上运行</p></li><li><p>调用该函数时会判断运行脚本的 Auto.js 的版本号，如果没有达到要求则抛出异常。</p></li><li><p>可以通过<code>app.autojs.versionCode</code>和<code>app.autojs.versionName</code>获取当前的 Auto.js 版本号和版本。</p></li></ul><h2 id="控制台-Console"><a href="#控制台-Console" class="headerlink" title="控制台 - Console"></a>控制台 - Console</h2><h2 id="1、控制台的常用命令"><a href="#1、控制台的常用命令" class="headerlink" title="1、控制台的常用命令"></a>1、控制台的常用命令</h2><h3 id="console-show"><a href="#console-show" class="headerlink" title="console.show()"></a>console.show()</h3><ul><li>显示控制台。这会显示一个控制台的悬浮窗(需要悬浮窗权限)。</li></ul><h3 id="console-hide"><a href="#console-hide" class="headerlink" title="console.hide()"></a>console.hide()</h3><ul><li>隐藏控制台悬浮窗。</li></ul><h3 id="console-clear"><a href="#console-clear" class="headerlink" title="console.clear()"></a>console.clear()</h3><ul><li>清空控制台。</li></ul><h2 id="2、控制台输出信息的几种方式"><a href="#2、控制台输出信息的几种方式" class="headerlink" title="2、控制台输出信息的几种方式"></a>2、控制台输出信息的几种方式</h2><h3 id="console-log-data-…args"><a href="#console-log-data-…args" class="headerlink" title="console.log([data][, …args])"></a>console.log([data][, …args])</h3><ul><li><code>data</code> {any}</li><li><code>...args</code> {any}</li></ul><p>打印到控制台，并带上换行符。 可以传入多个参数</p><p>该函数也可以作为全局函数使用。</p><h3 id="console-trace-data-…args"><a href="#console-trace-data-…args" class="headerlink" title="console.trace([data][, …args])"></a>console.trace([data][, …args])</h3><ul><li><code>data</code> {any}</li><li><code>...args</code> {any}</li></ul><p>与 console.log 类似，同时会打印出调用这个函数所在的调用栈信息（即当前运行的文件、行数等信息）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">trace</span>(<span class="string">&quot;Show me&quot;</span>);</span><br><span class="line"><span class="comment">// 打印: (堆栈跟踪会根据被调用的跟踪的位置而变化)</span></span><br><span class="line"><span class="comment">// Show me</span></span><br><span class="line"><span class="comment">//  at &lt;test&gt;:7</span></span><br></pre></td></tr></table></figure><h3 id="print-text-…args"><a href="#print-text-…args" class="headerlink" title="print(text[, …args])"></a>print(text[, …args])</h3><ul><li>text {string} | {Object} 要打印到控制台的信息</li></ul><p>相当于<code>log(text)</code>。</p><h2 id="3、控制台信息的输出样式"><a href="#3、控制台信息的输出样式" class="headerlink" title="3、控制台信息的输出样式"></a>3、控制台信息的输出样式</h2><h3 id="console-verbose-data-…args"><a href="#console-verbose-data-…args" class="headerlink" title="console.verbose([data][, …args])"></a>console.verbose([data][, …args])</h3><ul><li><code>data</code> {any}</li><li><code>...args</code> {any}</li></ul><p>与 console.log 类似，但输出结果以灰色字体显示。输出优先级低于 log，用于输出观察性质的信息。</p><h3 id="console-info-data-…args"><a href="#console-info-data-…args" class="headerlink" title="console.info([data][, …args])"></a>console.info([data][, …args])</h3><ul><li><code>data</code> {any}</li><li><code>...args</code> {any}</li></ul><p>与 console.log 类似，但输出结果以绿色字体显示。输出优先级高于 log, 用于输出重要信息。</p><h3 id="console-warn-data-…args"><a href="#console-warn-data-…args" class="headerlink" title="console.warn([data][, …args])"></a>console.warn([data][, …args])</h3><ul><li><code>data</code> {any}</li><li><code>...args</code> {any}</li></ul><p>与 console.log 类似，但输出结果以蓝色字体显示。输出优先级高于 info, 用于输出警告信息。</p><h3 id="console-error-data-…args"><a href="#console-error-data-…args" class="headerlink" title="console.error([data][, …args])"></a>console.error([data][, …args])</h3><ul><li><code>data</code> {any}</li><li><code>...args</code> {any}</li></ul><p>与 console.log 类似，但输出结果以红色字体显示。输出优先级高于 warn, 用于输出错误信息。</p><h3 id="console-assert-value-message"><a href="#console-assert-value-message" class="headerlink" title="console.assert(value, message)"></a>console.assert(value, message)</h3><ul><li>value {any} 要断言的布尔值</li><li>message {string} value 为 false 时要输出的信息</li></ul><p>断言。如果 value 为 false 则输出错误信息 message 并停止脚本运行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var a = 1 + 1;</span><br><span class="line">console.assert(a == 2, &quot;加法出错啦&quot;);</span><br></pre></td></tr></table></figure><h2 id="4、控制台计时操作"><a href="#4、控制台计时操作" class="headerlink" title="4、控制台计时操作"></a>4、控制台计时操作</h2><h3 id="console-time-label"><a href="#console-time-label" class="headerlink" title="console.time([label])"></a>console.time([label])</h3><ul><li><code>label</code> {String} 计时器标签，可省略</li></ul><p>启动一个定时器，用以计算一个操作的持续时间。 定时器由一个唯一的 <code>label</code> 标识。 当调用 <code>console.timeEnd()</code> 时，可以使用相同的 <code>label</code> 来停止定时器，并以毫秒为单位将持续时间输出到控制台。 重复启动同一个标签的定时器会覆盖之前启动同一标签的定时器。</p><h3 id="console-timeEnd-label"><a href="#console-timeEnd-label" class="headerlink" title="console.timeEnd(label)"></a>console.timeEnd(label)</h3><ul><li><code>label</code> {String} 计时器标签</li></ul><p>停止之前通过调用 <code>console.time()</code> 启动的定时器，并打印结果到控制台。 调用 <code>console.timeEnd()</code> 后定时器会被删除。如果不存在标签指定的定时器则会打印 <code>NaNms</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;求和&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  sum += i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;求和&quot;</span>);</span><br><span class="line"><span class="comment">// 打印 求和: xxx ms</span></span><br></pre></td></tr></table></figure><h2 id="5、控制台输入框（无效）"><a href="#5、控制台输入框（无效）" class="headerlink" title="5、控制台输入框（无效）"></a>5、控制台输入框（无效）</h2><h3 id="console-input-data-…args"><a href="#console-input-data-…args" class="headerlink" title="console.input(data[, …args])"></a>console.input(data[, …args])</h3><ul><li><code>data</code> {any}</li><li><code>...args</code> {any}</li></ul><p>与 console.log 一样输出信息，并在控制台显示输入框等待输入。按控制台的确认按钮后会将输入的字符串用 eval 计算后返回。</p><p><strong>部分机型可能会有控制台不显示输入框的情况，属于 bug。</strong></p><p>例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var n = console.input(&quot;请输入一个数字:&quot;);</span><br><span class="line">//输入123之后：</span><br><span class="line">toast(n + 1);</span><br><span class="line">//显示124</span><br></pre></td></tr></table></figure><h3 id="console-rawInput-data-…args"><a href="#console-rawInput-data-…args" class="headerlink" title="console.rawInput(data[, …args])"></a>console.rawInput(data[, …args])</h3><ul><li><code>data</code> {any}</li><li><code>...args</code> {any}</li></ul><p>与 console.log 一样输出信息，并在控制台显示输入框等待输入。按控制台的确认按钮后会将输入的字符串直接返回。</p><p>部分机型可能会有控制台不显示输入框的情况，属于 bug。</p><p>例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var n = console.rawInput(&quot;请输入一个数字:&quot;);</span><br><span class="line">//输入123之后：</span><br><span class="line"></span><br><span class="line">toast(n + 1);</span><br><span class="line">//显示1231</span><br></pre></td></tr></table></figure><h2 id="6、控制台的大小和位置设置"><a href="#6、控制台的大小和位置设置" class="headerlink" title="6、控制台的大小和位置设置"></a>6、控制台的大小和位置设置</h2><h3 id="console-setSize-w-h"><a href="#console-setSize-w-h" class="headerlink" title="console.setSize(w, h)"></a>console.setSize(w, h)</h3><ul><li><code>w</code> {number} 宽度</li><li><code>h</code> {number} 高度</li></ul><p>设置控制台的大小，单位像素。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">console.show();</span><br><span class="line">sleep(2000)</span><br><span class="line">//设置控制台大小为屏幕的四分之一</span><br><span class="line">console.setSize(device.width / 2, device.height / 2);</span><br></pre></td></tr></table></figure><h3 id="console-setPosition-x-y"><a href="#console-setPosition-x-y" class="headerlink" title="console.setPosition(x, y)"></a>console.setPosition(x, y)</h3><ul><li><code>x</code> {number} 横坐标</li><li><code>y</code> {number} 纵坐标</li></ul><p>设置控制台的位置，单位像素。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.show();</span><br><span class="line">console.setPosition(100, 100);</span><br></pre></td></tr></table></figure><h2 id="基于坐标的操作-CoordinatesBasedAutomation"><a href="#基于坐标的操作-CoordinatesBasedAutomation" class="headerlink" title="基于坐标的操作 - CoordinatesBasedAutomation"></a>基于坐标的操作 - CoordinatesBasedAutomation</h2><p>本章节介绍了一些使用坐标进行点击、滑动的函数。</p><p>这些函数有的需要安卓 7.0 以上，有的需要 root 权限。</p><p>要获取要点击的位置的坐标，可以在开发者选项中开启”指针位置”。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取这个控件</span></span><br><span class="line"><span class="keyword">var</span> widget = <span class="title function_">id</span>(<span class="string">&quot;xxx&quot;</span>).<span class="title function_">findOne</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取其中心位置并点击</span></span><br><span class="line"><span class="title function_">click</span>(widget.<span class="title function_">bounds</span>().<span class="title function_">centerX</span>(), widget.<span class="title function_">bounds</span>().<span class="title function_">centerY</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果用root权限则用Tap</span></span><br></pre></td></tr></table></figure><h2 id="1、设置屏幕的宽度和高度"><a href="#1、设置屏幕的宽度和高度" class="headerlink" title="1、设置屏幕的宽度和高度"></a>1、设置屏幕的宽度和高度</h2><h3 id="setScreenMetrics-width-height"><a href="#setScreenMetrics-width-height" class="headerlink" title="setScreenMetrics(width, height)"></a>setScreenMetrics(width, height)</h3><ul><li>width {number} 屏幕宽度，单位像素</li><li>height {number} 屏幕高度，单位像素</li></ul><p>设置脚本坐标点击所适合的屏幕宽高。如果脚本运行时，屏幕宽度不一致会自动放缩坐标。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">例如在1920*1080的设备中，某个操作的代码为</span><br><span class="line"></span><br><span class="line">setScreenMetrics(1080, 1920);</span><br><span class="line">click(800, 200);</span><br><span class="line">longClick(300, 500);</span><br><span class="line"></span><br><span class="line">那么在其他设备上AutoJs会自动放缩坐标以便脚本仍然有效。例如在540 * 960的屏幕中click(800, 200)实际上会点击位置(400, 100)</span><br></pre></td></tr></table></figure><h2 id="2、免-root-手机的三种模拟点击方式"><a href="#2、免-root-手机的三种模拟点击方式" class="headerlink" title="2、免 root 手机的三种模拟点击方式"></a>2、免 root 手机的三种模拟点击方式</h2><h3 id="click-x-y"><a href="#click-x-y" class="headerlink" title="click(x, y)"></a>click(x, y)</h3><ul><li>模拟点击坐标(x, y)，并返回是否点击成功。只有在点击执行完成后脚本才继续执行。</li></ul><blockquote><p>一般而言，只有点击过程(大约 150 毫秒)中被其他事件中断(例如用户自行点击)才会点击失败。</p><p>使用该函数模拟连续点击时可能有点击速度过慢的问题，这时可以用<code>press()</code>函数代替。</p></blockquote><h3 id="longClick-x-y"><a href="#longClick-x-y" class="headerlink" title="longClick(x, y)"></a>longClick(x, y)</h3><ul><li>模拟长按坐标(x, y), 并返回是否成功。只有在长按执行完成（大约 600 毫秒）时脚本才会继续执行。</li></ul><h3 id="press-x-y-duration"><a href="#press-x-y-duration" class="headerlink" title="press(x, y, duration)"></a>press(x, y, duration)</h3><ul><li>模拟按住坐标(x, y), 并返回是否成功。只有按住操作执行完成时脚本才会继续执行。</li></ul><h2 id="3、免-root-手机的三种模拟滑动方式"><a href="#3、免-root-手机的三种模拟滑动方式" class="headerlink" title="3、免 root 手机的三种模拟滑动方式"></a>3、免 root 手机的三种模拟滑动方式</h2><h3 id="swipe-x1-y1-x2-y2-duration"><a href="#swipe-x1-y1-x2-y2-duration" class="headerlink" title="swipe(x1, y1, x2, y2, duration)"></a>swipe(x1, y1, x2, y2, duration)</h3><ul><li><code>x1</code> {number} 滑动的起始坐标的 x 值</li><li><code>y1</code> {number} 滑动的起始坐标的 y 值</li><li><code>x2</code> {number} 滑动的结束坐标的 x 值</li><li><code>y2</code> {number} 滑动的结束坐标的 y 值</li><li><code>duration</code> {number} 滑动时长，单位毫秒</li></ul><p>模拟从坐标(x1, y1)滑动到坐标(x2, y2)，并返回是否成功。只有滑动操作执行完成时脚本才会继续执行。</p><h3 id="gesture-duration-x1-y1-x2-y2-…"><a href="#gesture-duration-x1-y1-x2-y2-…" class="headerlink" title="gesture(duration, [x1, y1], [x2, y2], …)"></a>gesture(duration, [x1, y1], [x2, y2], …)</h3><ul><li><code>duration</code> {number} 手势的时长</li><li>[x, y] … 手势滑动路径的一系列坐标</li></ul><p>模拟手势操作。例如<code>gesture(1000, [0, 0], [500, 500], [500, 1000])</code>为模拟一个从(0, 0)到(500, 500)到(500, 100)的手势操作，时长为 2 秒。</p><h3 id="gestures-delay1-duration1-x1-y1-x2-y2-…-delay2-duration2-x3-y3-x4-y4-…-…"><a href="#gestures-delay1-duration1-x1-y1-x2-y2-…-delay2-duration2-x3-y3-x4-y4-…-…" class="headerlink" title="gestures([delay1, duration1, [x1, y1], [x2, y2], …], [delay2, duration2, [x3, y3], [x4, y4], …], …)"></a>gestures([delay1, duration1, [x1, y1], [x2, y2], …], [delay2, duration2, [x3, y3], [x4, y4], …], …)</h3><p>同时模拟多个手势。每个手势的参数为[delay, duration, 坐标], delay 为延迟多久(毫秒)才执行该手势；duration 为手势执行时长；坐标为手势经过的点的坐标。</p><p>其中 delay 参数可以省略，默认为 0。</p><p>例如手指捏合：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gestures([0, 500, [800, 300], [500, 1000]],</span><br><span class="line">         [0, 500, [300, 1500], [500, 1000]]);</span><br></pre></td></tr></table></figure><h2 id="4、使用-root-权限模拟点击"><a href="#4、使用-root-权限模拟点击" class="headerlink" title="4、使用 root 权限模拟点击"></a>4、使用 root 权限模拟点击</h2><p>RootAutomator 是一个使用 root 权限来模拟触摸的对象，用它可以完成触摸与多点触摸，并且这些动作的执行没有延迟。</p><p>一个脚本中最好只存在一个 RootAutomator，并且保证脚本结束退出他。可以在 exit 事件中退出 RootAutomator，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var ra = new RootAutomator();</span><br><span class="line">events.on(&#x27;exit&#x27;, function()&#123;</span><br><span class="line">  ra.exit();</span><br><span class="line">&#125;);</span><br><span class="line">//执行一些点击操作</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="RootAutomator-tap-x-y-id"><a href="#RootAutomator-tap-x-y-id" class="headerlink" title="RootAutomator.tap(x, y[, id])"></a>RootAutomator.tap(x, y[, id])</h3><ul><li><code>x</code> {number} 横坐标</li><li><code>y</code> {number} 纵坐标</li><li><code>id</code> {number} 多点触摸 id，可选，默认为 1，可以通过 setDefaultId 指定。</li></ul><p>点击位置(x, y)。其中 id 是一个整数值，用于区分多点触摸，不同的 id 表示不同的”手指”，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var ra = new RootAutomator();</span><br><span class="line">//让&quot;手指1&quot;点击位置(100, 100)</span><br><span class="line">ra.tap(100, 100, 1);</span><br><span class="line">//让&quot;手指2&quot;点击位置(200, 200);</span><br><span class="line">ra.tap(200, 200, 2);</span><br><span class="line">ra.exit();</span><br></pre></td></tr></table></figure><p>如果不需要多点触摸，则不需要 id 这个参数。 多点触摸通常用于手势或游戏操作，例如模拟双指捏合、双指上滑等。</p><p>某些情况下可能存在 tap 点击无反应的情况，这时可以用<code>RootAutomator.press()</code>函数代替。</p><h3 id="RootAutomator-press-x-y-duration-id"><a href="#RootAutomator-press-x-y-duration-id" class="headerlink" title="RootAutomator.press(x, y, duration[, id])"></a>RootAutomator.press(x, y, duration[, id])</h3><ul><li><code>x</code> {number} 横坐标</li><li><code>y</code> {number} 纵坐标</li><li><code>duration</code> {number} 按下时长</li><li><code>id</code> {number} 多点触摸 id，可选，默认为 1</li></ul><p>模拟按下位置(x, y)，时长为 duration 毫秒。</p><h3 id="RootAutomator-longPress-x-y-id"><a href="#RootAutomator-longPress-x-y-id" class="headerlink" title="RootAutomator.longPress(x, y[, id])"></a>RootAutomator.longPress(x, y[, id])</h3><ul><li><code>x</code> {number} 横坐标</li><li><code>y</code> {number} 纵坐标</li><li><code>id</code> {number} 多点触摸 id，可选，默认为 1</li></ul><p>模拟长按位置(x, y)。</p><p>以上为简单模拟触摸操作的函数。如果要模拟一些复杂的手势，需要更底层的函数。</p><h2 id="5、使用-root-权限模拟滑动（无效果）"><a href="#5、使用-root-权限模拟滑动（无效果）" class="headerlink" title="5、使用 root 权限模拟滑动（无效果）"></a>5、使用 root 权限模拟滑动（无效果）</h2><h3 id="RootAutomator-swipe-x1-x2-y1-y2-duration-id"><a href="#RootAutomator-swipe-x1-x2-y1-y2-duration-id" class="headerlink" title="RootAutomator.swipe(x1, x2, y1, y2[, duration, id])"></a>RootAutomator.swipe(x1, x2, y1, y2[, duration, id])</h3><ul><li><code>x1</code> {number} 滑动起点横坐标</li><li><code>y1</code> {number} 滑动起点纵坐标</li><li><code>x2</code> {number} 滑动终点横坐标</li><li><code>y2</code> {number} 滑动终点纵坐标</li><li><code>duration</code> {number} 滑动时长，单位毫秒，默认值为 300</li><li><code>id</code> {number} 多点触摸 id，可选，默认为 1</li></ul><p>模拟一次从(x1, y1)到(x2, y2)的时间为 duration 毫秒的滑动。</p><h2 id="6、使用-root-权限实现模拟拖动"><a href="#6、使用-root-权限实现模拟拖动" class="headerlink" title="6、使用 root 权限实现模拟拖动"></a>6、使用 root 权限实现模拟拖动</h2><h3 id="RootAutomator-touchDown-x-y-id"><a href="#RootAutomator-touchDown-x-y-id" class="headerlink" title="RootAutomator.touchDown(x, y[, id])"></a>RootAutomator.touchDown(x, y[, id])</h3><ul><li><code>x</code> {number} 横坐标</li><li><code>y</code> {number} 纵坐标</li><li><code>id</code> {number} 多点触摸 id，可选，默认为 1</li></ul><p>模拟手指按下位置(x, y)。</p><h3 id="RootAutomator-touchMove-x-y-id"><a href="#RootAutomator-touchMove-x-y-id" class="headerlink" title="RootAutomator.touchMove(x, y[, id])"></a>RootAutomator.touchMove(x, y[, id])</h3><ul><li><code>x</code> {number} 横坐标</li><li><code>y</code> {number} 纵坐标</li><li><code>id</code> {number} 多点触摸 id，可选，默认为 1</li></ul><p>模拟移动手指到位置(x, y)。</p><h3 id="RootAutomator-touchUp-id"><a href="#RootAutomator-touchUp-id" class="headerlink" title="RootAutomator.touchUp([id])"></a>RootAutomator.touchUp([id])</h3><ul><li><code>id</code> {number} 多点触摸 id，可选，默认为 1</li></ul><p>模拟手指弹起。</p><h2 id="7、使用-root-权限点击和滑动的简单命令"><a href="#7、使用-root-权限点击和滑动的简单命令" class="headerlink" title="7、使用 root 权限点击和滑动的简单命令"></a>7、使用 root 权限点击和滑动的简单命令</h2><ul><li>推荐使用<code>RootAutomator</code></li></ul><h3 id="Tap-x-y"><a href="#Tap-x-y" class="headerlink" title="Tap(x, y)"></a>Tap(x, y)</h3><ul><li>x, y {number} 要点击的坐标。</li></ul><p>点击位置(x, y), 您可以通过”开发者选项”开启指针位置来确定点击坐标。</p><h3 id="Swipe-x1-y1-x2-y2-duration"><a href="#Swipe-x1-y1-x2-y2-duration" class="headerlink" title="Swipe(x1, y1, x2, y2, [duration])"></a>Swipe(x1, y1, x2, y2, [duration])</h3><ul><li>x1, y1 {number} 滑动起点的坐标</li><li>x2, y2 {number} 滑动终点的坐标</li><li>duration {number} 滑动动作所用的时间</li></ul><p>滑动。从(x1, y1)位置滑动到(x2, y2)位置。</p><h2 id="设备-Device"><a href="#设备-Device" class="headerlink" title="设备 - Device"></a>设备 - Device</h2><p>device 模块提供了与设备有关的信息与操作，例如获取设备宽高，内存使用率，IMEI，调整设备亮度、音量等。</p><p>此模块的部分函数，例如调整音量，需要”修改系统设置”的权限。如果没有该权限，会抛出<code>SecurityException</code>并跳转到权限设置界面。</p><h2 id="1、获取设备信息"><a href="#1、获取设备信息" class="headerlink" title="1、获取设备信息"></a>1、获取设备信息</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">device.<span class="property">width</span></span><br><span class="line">设备屏幕分辨率宽度。例如<span class="number">1080</span>。</span><br><span class="line"></span><br><span class="line">device.<span class="property">height</span></span><br><span class="line">设备屏幕分辨率高度。例如<span class="number">1920</span>。</span><br><span class="line"></span><br><span class="line">device.<span class="property">buildId</span></span><br><span class="line">修订版本号，或者诸如<span class="string">&quot;M4-rc20&quot;</span>的标识。</span><br><span class="line"></span><br><span class="line">device.<span class="property">broad</span></span><br><span class="line">设备的主板型号。</span><br><span class="line"></span><br><span class="line">device.<span class="property">brand</span></span><br><span class="line">与产品或硬件相关的厂商品牌，如<span class="string">&quot;Xiaomi&quot;</span>, <span class="string">&quot;Huawei&quot;</span>等。</span><br><span class="line"></span><br><span class="line">device.<span class="property">device</span></span><br><span class="line">设备在工业设计中的名称。</span><br><span class="line"></span><br><span class="line">deivce.<span class="property">model</span></span><br><span class="line">设备型号。</span><br><span class="line"></span><br><span class="line">device.<span class="property">product</span></span><br><span class="line">整个产品的名称。</span><br><span class="line"></span><br><span class="line">device.<span class="property">bootloader</span></span><br><span class="line">设备<span class="title class_">Bootloader</span>的版本。</span><br><span class="line"></span><br><span class="line">device.<span class="property">hardware</span></span><br><span class="line">设备的硬件名称(来自内核命令行或者/proc)。</span><br><span class="line"></span><br><span class="line">device.<span class="property">fingerprint</span></span><br><span class="line">构建(build)的唯一标识码。</span><br><span class="line"></span><br><span class="line">device.<span class="property">serial</span></span><br><span class="line">硬件序列号。</span><br><span class="line"></span><br><span class="line">device.<span class="property">sdkInt</span></span><br><span class="line">安卓系统<span class="variable constant_">API</span>版本。例如安卓<span class="number">4.4</span>的sdkInt为<span class="number">19</span>。</span><br><span class="line"></span><br><span class="line">device.<span class="property">incremental</span></span><br><span class="line"></span><br><span class="line">device.<span class="property">release</span></span><br><span class="line"><span class="title class_">Android</span>系统版本号。例如<span class="string">&quot;5.0&quot;</span>, <span class="string">&quot;7.1.1&quot;</span>。</span><br><span class="line"></span><br><span class="line">device.<span class="property">baseOS</span></span><br><span class="line"></span><br><span class="line">device.<span class="property">securityPatch</span></span><br><span class="line">安全补丁程序级别。</span><br><span class="line"></span><br><span class="line">device.<span class="property">codename</span></span><br><span class="line">开发代号，例如发行版是<span class="string">&quot;REL&quot;</span>。</span><br><span class="line"></span><br><span class="line">device.<span class="title function_">getIMEI</span>()</span><br><span class="line">返回设备的<span class="variable constant_">IMEI</span>.</span><br><span class="line"></span><br><span class="line">device.<span class="title function_">getAndroidId</span>()</span><br><span class="line">返回设备的<span class="title class_">Android</span> <span class="variable constant_">ID</span>。</span><br><span class="line"><span class="title class_">Android</span> <span class="variable constant_">ID</span>为一个用<span class="number">16</span>进制字符串表示的<span class="number">64</span>位整数，在设备第一次使用时随机生成，之后不会更改，除非恢复出厂设置。</span><br><span class="line"></span><br><span class="line">device.<span class="title function_">getMacAddress</span>()</span><br><span class="line">返回设备的<span class="title class_">Mac</span>地址。该函数需要在有<span class="variable constant_">WLAN</span>连接的情况下才能获取，否则会返回<span class="literal">null</span>。</span><br><span class="line">可能的后续修改：未来可能增加有root权限的情况下通过root权限获取，从而在没有<span class="variable constant_">WLAN</span>连接的情况下也能返回正确的<span class="title class_">Mac</span>地址，因此请勿使用此函数判断<span class="variable constant_">WLAN</span>连接。</span><br><span class="line"></span><br><span class="line">device.<span class="title function_">getTotalMem</span>()</span><br><span class="line">返回设备内存总量，单位字节(B)。1MB = <span class="number">1024</span> * 1024B。</span><br><span class="line"></span><br><span class="line">device.<span class="title function_">getAvailMem</span>()</span><br><span class="line">返回设备当前可用的内存，单位字节(B)。</span><br><span class="line"></span><br><span class="line">device.<span class="title function_">getBattery</span>()</span><br><span class="line"><span class="number">0.0</span>~<span class="number">100.0</span>的浮点数</span><br><span class="line">返回当前电量百分比。</span><br><span class="line"></span><br><span class="line">device.<span class="title function_">isCharging</span>()</span><br><span class="line">返回设备是否正在充电。</span><br></pre></td></tr></table></figure><h3 id="2、获取并改变设备亮度"><a href="#2、获取并改变设备亮度" class="headerlink" title="2、获取并改变设备亮度"></a>2、获取并改变设备亮度</h3><h4 id="device-getBrightness"><a href="#device-getBrightness" class="headerlink" title="device.getBrightness()"></a>device.getBrightness()</h4><p>返回当前的(手动)亮度。</p><h4 id="device-getBrightnessMode"><a href="#device-getBrightnessMode" class="headerlink" title="device.getBrightnessMode()"></a>device.getBrightnessMode()</h4><p>返回当前亮度模式，0 为手动亮度，1 为自动亮度。</p><h4 id="device-setBrightness-b"><a href="#device-setBrightness-b" class="headerlink" title="device.setBrightness(b)"></a>device.setBrightness(b)</h4><p>b {number} 亮度，</p><p>如果当前是自动亮度模式，该函数不会影响屏幕的亮度。</p><p>此函数需要”修改系统设置”的权限。如果没有该权限，会抛出 SecurityException 并跳转到权限设置界面。</p><h4 id="device-setBrightnessMode-mode"><a href="#device-setBrightnessMode-mode" class="headerlink" title="device.setBrightnessMode(mode)"></a>device.setBrightnessMode(mode)</h4><p>mode {number} 亮度模式，</p><p>0 为手动亮度，1 为自动亮度<br>设置当前亮度模式。</p><p>此函数需要”修改系统设置”的权限。如果没有该权限，会抛出 SecurityException 并跳转到权限设置界面。</p><h2 id="3、获取并改变设备音量"><a href="#3、获取并改变设备音量" class="headerlink" title="3、获取并改变设备音量"></a>3、获取并改变设备音量</h2><h4 id="device-getMusicVolume"><a href="#device-getMusicVolume" class="headerlink" title="device.getMusicVolume()"></a>device.getMusicVolume()</h4><p>返回当前媒体音量。</p><h4 id="device-getNotificationVolume"><a href="#device-getNotificationVolume" class="headerlink" title="device.getNotificationVolume()"></a>device.getNotificationVolume()</h4><p>返回当前通知音量。</p><h4 id="device-getAlarmVolume"><a href="#device-getAlarmVolume" class="headerlink" title="device.getAlarmVolume()"></a>device.getAlarmVolume()</h4><p>返回当前闹钟音量。</p><h4 id="device-getMusicMaxVolume"><a href="#device-getMusicMaxVolume" class="headerlink" title="device.getMusicMaxVolume()"></a>device.getMusicMaxVolume()</h4><p>返回媒体音量的最大值。</p><h4 id="device-getNotificationMaxVolume"><a href="#device-getNotificationMaxVolume" class="headerlink" title="device.getNotificationMaxVolume()"></a>device.getNotificationMaxVolume()</h4><p>返回通知音量的最大值。</p><h4 id="device-getAlarmMaxVolume"><a href="#device-getAlarmMaxVolume" class="headerlink" title="device.getAlarmMaxVolume()"></a>device.getAlarmMaxVolume()</h4><p>返回闹钟音量的最大值。</p><h4 id="device-setMusicVolume-volume"><a href="#device-setMusicVolume-volume" class="headerlink" title="device.setMusicVolume(volume)"></a>device.setMusicVolume(volume)</h4><p>volume {number} 音量</p><p>设置当前媒体音量。</p><p>此函数需要”修改系统设置”的权限。如果没有该权限，会抛出 SecurityException 并跳转到权限设置界面。</p><h4 id="device-setNotificationVolume-volume"><a href="#device-setNotificationVolume-volume" class="headerlink" title="device.setNotificationVolume(volume)"></a>device.setNotificationVolume(volume)</h4><p>volume {number} 音量</p><p>设置当前通知音量。</p><p>此函数需要”修改系统设置”的权限。如果没有该权限，会抛出 SecurityException 并跳转到权限设置界面。</p><h4 id="device-setAlarmVolume-volume"><a href="#device-setAlarmVolume-volume" class="headerlink" title="device.setAlarmVolume(volume)"></a>device.setAlarmVolume(volume)</h4><p>volume {number} 音量</p><p>设置当前闹钟音量。</p><p>此函数需要”修改系统设置”的权限。如果没有该权限，会抛出 SecurityException 并跳转到权限设置界面。</p><h2 id="4、获取并改变设备屏幕状态"><a href="#4、获取并改变设备屏幕状态" class="headerlink" title="4、获取并改变设备屏幕状态"></a>4、获取并改变设备屏幕状态</h2><h3 id="device-isScreenOn"><a href="#device-isScreenOn" class="headerlink" title="device.isScreenOn()"></a>device.isScreenOn()</h3><ul><li>返回 {boolean}</li></ul><p>返回设备屏幕是否是亮着的。如果屏幕亮着，返回<code>true</code>; 否则返回<code>false</code>。</p><p>需要注意的是，类似于 vivo xplay 系列的息屏时钟不属于”屏幕亮着”的情况，虽然屏幕确实亮着但只能显示时钟而且不可交互，此时<code>isScreenOn()</code>也会返回<code>false</code>。</p><h3 id="device-wakeUp"><a href="#device-wakeUp" class="headerlink" title="device.wakeUp()"></a>device.wakeUp()</h3><p>唤醒设备。包括唤醒设备 CPU、屏幕等。可以用来点亮屏幕。</p><h3 id="device-wakeUpIfNeeded"><a href="#device-wakeUpIfNeeded" class="headerlink" title="device.wakeUpIfNeeded()"></a>device.wakeUpIfNeeded()</h3><p>如果屏幕没有点亮，则唤醒设备。</p><h3 id="device-keepScreenOn-timeout"><a href="#device-keepScreenOn-timeout" class="headerlink" title="device.keepScreenOn([timeout])"></a>device.keepScreenOn([timeout])</h3><ul><li><code>timeout</code> {number} 屏幕保持常亮的时间, 单位毫秒。如果不加此参数，则一直保持屏幕常亮。</li></ul><p>保持屏幕常亮。</p><p>此函数无法阻止用户使用锁屏键等正常关闭屏幕，只能使得设备在无人操作的情况下保持屏幕常亮；</p><p>同时，如果此函数调用时屏幕没有点亮，则会唤醒屏幕。</p><p>在某些设备上，如果不加参数 timeout，只能在 Auto.js 的界面保持屏幕常亮，在其他界面会自动失效，这是因为设备的省电策略造成的。因此，建议使用比较长的时长来代替”一直保持屏幕常亮”的功能，例如<code>device.keepScreenOn(3600 * 1000)</code>。</p><p>可以使用<code>device.cancelKeepingAwake()</code>来取消屏幕常亮。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//一直保持屏幕常亮</span><br><span class="line">device.keepScreenOn()</span><br></pre></td></tr></table></figure><h3 id="device-keepScreenDim-timeout"><a href="#device-keepScreenDim-timeout" class="headerlink" title="device.keepScreenDim([timeout])"></a>device.keepScreenDim([timeout])</h3><ul><li><code>timeout</code> {number} 屏幕保持常亮的时间, 单位毫秒。如果不加此参数，则一直保持屏幕常亮。</li></ul><p>保持屏幕常亮，但允许屏幕变暗来节省电量。</p><p>此函数可以用于定时脚本唤醒屏幕操作，不需要用户观看屏幕，可以让屏幕变暗来节省电量。</p><p>此函数无法阻止用户使用锁屏键等正常关闭屏幕，只能使得设备在无人操作的情况下保持屏幕常亮；</p><p>同时，如果此函数调用时屏幕没有点亮，则会唤醒屏幕。</p><p>可以使用<code>device.cancelKeepingAwake()</code>来取消屏幕常亮。</p><h3 id="device-cancelKeepingAwake"><a href="#device-cancelKeepingAwake" class="headerlink" title="device.cancelKeepingAwake()"></a>device.cancelKeepingAwake()</h3><p>取消设备保持唤醒状态。</p><p>用于取消<code>device.keepScreenOn()</code>, <code>device.keepScreenDim()</code>等函数设置的屏幕常亮。</p><h2 id="5、设置设备震动状态"><a href="#5、设置设备震动状态" class="headerlink" title="5、设置设备震动状态"></a>5、设置设备震动状态</h2><h3 id="device-vibrate-millis"><a href="#device-vibrate-millis" class="headerlink" title="device.vibrate(millis)"></a>device.vibrate(millis)</h3><ul><li><code>millis</code> {number} 震动时间，单位毫秒</li></ul><p>使设备震动一段时间。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//震动两秒</span><br><span class="line">device.vibrate(2000);</span><br></pre></td></tr></table></figure><h3 id="device-cancelVibration"><a href="#device-cancelVibration" class="headerlink" title="device.cancelVibration()"></a>device.cancelVibration()</h3><p>如果设备处于震动状态，则取消震动。</p><h2 id="对话框-Dialogs"><a href="#对话框-Dialogs" class="headerlink" title="对话框 - Dialogs"></a>对话框 - Dialogs</h2><h2 id="1、对话框中的回调和-Promise"><a href="#1、对话框中的回调和-Promise" class="headerlink" title="1、对话框中的回调和 Promise"></a>1、对话框中的回调和 Promise</h2><h3 id="alert（str）"><a href="#alert（str）" class="headerlink" title="alert（str）"></a>alert（str）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert（<span class="string">&quot;hello&quot;</span>）</span><br></pre></td></tr></table></figure><h3 id="confirm（str）"><a href="#confirm（str）" class="headerlink" title="confirm（str）"></a>confirm（str）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clear = <span class="title function_">confirm</span>(<span class="string">&quot;要清除所有缓存吗?&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (clear) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;清除成功!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;ui&quot;</span>;</span><br><span class="line"><span class="comment">//回调的形式</span></span><br><span class="line"><span class="title function_">confirm</span>(<span class="string">&quot;你确定吗？&quot;</span>, <span class="string">&quot;这里是要写的内容&quot;</span>, <span class="keyword">function</span> (<span class="params">bool</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (bool) &#123;</span><br><span class="line">    <span class="title function_">toast</span>(<span class="string">&quot;你点击了确定&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">toast</span>(<span class="string">&quot;你点击了取消&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Promise形式</span></span><br><span class="line"><span class="title function_">confirm</span>(<span class="string">&quot;要清除所有缓存吗?&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">clear</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (clear) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;清除成功!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="2、对话框：alert-和-confirm"><a href="#2、对话框：alert-和-confirm" class="headerlink" title="2、对话框：alert 和 confirm"></a>2、对话框：alert 和 confirm</h2><h3 id="dialogs-alert-title-content-callback"><a href="#dialogs-alert-title-content-callback" class="headerlink" title="dialogs.alert(title[, content, callback])"></a>dialogs.alert(title[, content, callback])</h3><ul><li><code>title</code> {string} 对话框的标题。</li><li><code>content</code> {string} 可选，对话框的内容。默认为空。</li><li><code>callback</code> {Function} 回调函数，可选。当用户点击确定时被调用,一般用于 ui 模式。</li></ul><p>显示一个只包含“确定”按钮的提示对话框。直至用户点击确定脚本才继续运行。</p><p>该函数也可以作为全局函数使用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(&quot;出现错误~&quot;, &quot;出现未知错误，请联系脚本作者”);</span><br></pre></td></tr></table></figure><p>在 ui 模式下该函数返回一个<code>Promise</code>。例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;ui&quot;;</span><br><span class="line"></span><br><span class="line">alert(&quot;嘿嘿嘿&quot;).then(()=&gt;&#123;</span><br><span class="line">    //当点击确定后会执行这里</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="dialogs-confirm-title-content-callback"><a href="#dialogs-confirm-title-content-callback" class="headerlink" title="dialogs.confirm(title[, content, callback])"></a>dialogs.confirm(title[, content, callback])</h3><ul><li><code>title</code> {string} 对话框的标题。</li><li><code>content</code> {string} 可选，对话框的内容。默认为空。</li><li><code>callback</code> {Function} 回调函数，可选。当用户点击确定时被调用,一般用于 ui 模式。</li></ul><p>显示一个包含“确定”和“取消”按钮的提示对话框。如果用户点击“确定”则返回 <code>true</code> ，否则返回 <code>false</code> 。</p><p>该函数也可以作为全局函数使用。</p><p>在 ui 模式下该函数返回一个<code>Promise</code>。例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;ui&quot;;</span><br><span class="line">confirm(&quot;确定吗&quot;).then(value=&gt;&#123;</span><br><span class="line">    //当点击确定后会执行这里, value为true或false, 表示点击&quot;确定&quot;或&quot;取消&quot;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="3、对话框：rawInput-和-input"><a href="#3、对话框：rawInput-和-input" class="headerlink" title="3、对话框：rawInput 和 input"></a>3、对话框：rawInput 和 input</h2><h3 id="dialogs-rawInput-title-prefill-callback"><a href="#dialogs-rawInput-title-prefill-callback" class="headerlink" title="dialogs.rawInput(title[, prefill, callback])"></a>dialogs.rawInput(title[, prefill, callback])</h3><ul><li><code>title</code> {string} 对话框的标题。</li><li><code>prefill</code> {string} 输入框的初始内容，可选，默认为空。</li><li><code>callback</code> {Function} 回调函数，可选。当用户点击确定时被调用,一般用于 ui 模式。</li></ul><p>显示一个包含输入框的对话框，等待用户输入内容，并在用户点击确定时将输入的字符串返回。如果用户取消了输入，返回 null。</p><p>该函数也可以作为全局函数使用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var name = rawInput(&quot;请输入您的名字&quot;, &quot;小明&quot;);</span><br><span class="line">alert(&quot;您的名字是&quot; + name);</span><br></pre></td></tr></table></figure><p>在 ui 模式下该函数返回一个<code>Promise</code>。例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;ui&quot;;</span><br><span class="line">rawInput(&quot;请输入您的名字&quot;, &quot;小明&quot;).then(name =&gt; &#123;</span><br><span class="line">    alert(&quot;您的名字是&quot; + name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>当然也可以使用回调函数，例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rawInput(&quot;请输入您的名字&quot;, &quot;小明&quot;, name =&gt; &#123;</span><br><span class="line">     alert(&quot;您的名字是&quot; + name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="dialogs-input-title-prefill-callback"><a href="#dialogs-input-title-prefill-callback" class="headerlink" title="dialogs.input(title[, prefill, callback])"></a>dialogs.input(title[, prefill, callback])</h3><p>等效于 <code>eval(dialogs.rawInput(title, prefill, callback))</code>, 该函数和 rawInput 的区别在于，会把输入的字符串用 eval 计算一遍再返回，返回的可能不是字符串。</p><p>可以用该函数输入数字、数组等。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var age = dialogs.input(&quot;请输入您的年龄&quot;, &quot;18&quot;);</span><br><span class="line"></span><br><span class="line">// new Date().getYear() + 1900 可获取当前年份</span><br><span class="line"></span><br><span class="line">var year = new Date().getYear() + 1900 - age;</span><br><span class="line"></span><br><span class="line">alert(&quot;您的出生年份是&quot; + year);</span><br></pre></td></tr></table></figure><p>在 ui 模式下该函数返回一个<code>Promise</code>。例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;ui&quot;;</span><br><span class="line">dialogs.input(&quot;请输入您的年龄&quot;, &quot;18&quot;).then(age =&gt; &#123;</span><br><span class="line">    var year = new Date().getYear() + 1900 - age;</span><br><span class="line">    alert(&quot;您的出生年份是&quot; + year);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="4、对话框：选项列表"><a href="#4、对话框：选项列表" class="headerlink" title="4、对话框：选项列表"></a>4、对话框：选项列表</h2><h3 id="dialogs-select-title-items-callback"><a href="#dialogs-select-title-items-callback" class="headerlink" title="dialogs.select(title, items, callback)"></a>dialogs.select(title, items, callback)</h3><ul><li><code>title</code> {string} 对话框的标题。</li><li><code>items</code> {Array} 对话框的选项列表，是一个字符串数组。</li><li><code>callback</code> {Function} 回调函数，可选。当用户点击确定时被调用,一般用于 ui 模式。</li></ul><p>显示一个带有选项列表的对话框，等待用户选择，返回用户选择的选项索引(0 ~ item.length - 1)。如果用户取消了选择，返回-1。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = [<span class="string">&quot;选项A&quot;</span>, <span class="string">&quot;选项B&quot;</span>, <span class="string">&quot;选项C&quot;</span>, <span class="string">&quot;选项D&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = dialogs.<span class="title function_">select</span>(<span class="string">&quot;请选择一个选项&quot;</span>, options);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="title function_">toast</span>(<span class="string">&quot;您选择的是&quot;</span> + options[i]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_">toast</span>(<span class="string">&quot;您取消了选择&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 ui 模式下该函数返回一个<code>Promise</code>。例如:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;ui&quot;</span>;</span><br><span class="line"></span><br><span class="line">dialogs</span><br><span class="line">  .<span class="title function_">select</span>(<span class="string">&quot;请选择一个选项&quot;</span>, [<span class="string">&quot;选项A&quot;</span>, <span class="string">&quot;选项B&quot;</span>, <span class="string">&quot;选项C&quot;</span>, <span class="string">&quot;选项D&quot;</span>])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">toast</span>(i);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="5、对话框：单选和多选"><a href="#5、对话框：单选和多选" class="headerlink" title="5、对话框：单选和多选"></a>5、对话框：单选和多选</h2><h3 id="dialogs-singleChoice-title-items-index-callback"><a href="#dialogs-singleChoice-title-items-index-callback" class="headerlink" title="dialogs.singleChoice(title, items[, index, callback])"></a>dialogs.singleChoice(title, items[, index, callback])</h3><ul><li><code>title</code> {string} 对话框的标题。</li><li><code>items</code> {Array} 对话框的选项列表，是一个字符串数组。</li><li><code>index</code> {number} 对话框的初始选项的位置，默认为 0。</li><li><code>callback</code> {Function} 回调函数，可选。当用户点击确定时被调用,一般用于 ui 模式。</li></ul><p>显示一个单选列表对话框，等待用户选择，返回用户选择的选项索引(0 ~ item.length - 1)。如果用户取消了选择，返回-1。</p><h3 id="dialogs-multiChoice-title-items-indices-callback"><a href="#dialogs-multiChoice-title-items-indices-callback" class="headerlink" title="dialogs.multiChoice(title, items[, indices, callback])"></a>dialogs.multiChoice(title, items[, indices, callback])</h3><ul><li><code>title</code> {string} 对话框的标题。</li><li><code>items</code> {Array} 对话框的选项列表，是一个字符串数组。</li><li><code>indices</code> {Array} 选项列表中初始选中的项目索引的数组，默认为空数组。</li><li><code>callback</code> {Function} 回调函数，可选。当用户点击确定时被调用,一般用于 ui 模式。</li></ul><p>显示一个多选列表对话框，等待用户选择，返回用户选择的选项索引的数组。如果用户取消了选择，返回<code>[]</code>。</p><p>在 ui 模式下该函数返回一个<code>Promise</code>。</p><h2 id="对话框-Dialogs-1"><a href="#对话框-Dialogs-1" class="headerlink" title="对话框 - Dialogs"></a>对话框 - Dialogs</h2><p>主讲：<strong>阿涛 QQ/微信：656206105</strong></p><p><strong>微信公众号：立体空间</strong></p><p><img src="dyh.jpg"></p><h2 id="6、对话框：自定义对话框"><a href="#6、对话框：自定义对话框" class="headerlink" title="6、对话框：自定义对话框"></a>6、对话框：自定义对话框</h2><h3 id="dialogs-build-properties"><a href="#dialogs-build-properties" class="headerlink" title="dialogs.build(properties)"></a>dialogs.build(properties)</h3><ul><li><code>properties</code> {Object} 对话框属性，用于配置对话框。</li><li>返回 {Dialog}</li></ul><p>创建一个可自定义的对话框，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dialogs.build(&#123;</span><br><span class="line">    //对话框标题</span><br><span class="line">    title: &quot;发现新版本&quot;,</span><br><span class="line">    //对话框内容</span><br><span class="line">    content: &quot;更新日志: 新增了若干了BUG&quot;,</span><br><span class="line">    //确定键内容</span><br><span class="line">    positive: &quot;下载&quot;,</span><br><span class="line">    //取消键内容</span><br><span class="line">    negative: &quot;取消&quot;,</span><br><span class="line">    //中性键内容</span><br><span class="line">    neutral: &quot;到浏览器下载&quot;,</span><br><span class="line">    //勾选框内容</span><br><span class="line">    checkBoxPrompt: &quot;不再提示&quot;</span><br><span class="line">&#125;).show()</span><br></pre></td></tr></table></figure><p>选项 properties 可供配置的项目为:</p><ul><li><p><code>title</code> {string} 对话框标题</p></li><li><p><code>titleColor</code> {string} | {number} 对话框标题的颜色</p></li><li><p><code>buttonRippleColor</code> {string} | {number} 对话框按钮的波纹效果颜色</p></li><li><p><code>icon</code> {string} | {Image} 对话框的图标，是一个 URL 或者图片对象</p></li><li><p><code>content</code> {string} 对话框文字内容</p></li><li><p><code>contentColor</code>{string} | {number} 对话框文字内容的颜色</p></li><li><p><code>contentLineSpacing</code>{number} 对话框文字内容的行高倍数，1.0 为一倍行高</p></li><li><p><code>items</code> {Array} 对话框列表的选项</p></li><li><p><code>itemsColor</code> {string} | {number} 对话框列表的选项的文字颜色</p></li><li><p>```<br>itemsSelectMode</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  &#123;string&#125; 对话框列表的选项选择模式，可以为:</span><br><span class="line"></span><br><span class="line">  - `select` 普通选择模式</span><br><span class="line">  - `single` 单选模式</span><br><span class="line">  - `multi` 多选模式</span><br><span class="line"></span><br><span class="line">- `itemsSelectedIndex` &#123;number&#125; | &#123;Array&#125; 对话框列表中预先选中的项目索引，如果是单选模式为一个索引；多选模式则为数组</span><br><span class="line"></span><br><span class="line">- `positive` &#123;string&#125; 对话框确定按钮的文字内容(最右边按钮)</span><br><span class="line"></span><br><span class="line">- `positiveColor` &#123;string&#125; | &#123;number&#125; 对话框确定按钮的文字颜色(最右边按钮)</span><br><span class="line"></span><br><span class="line">- `neutral` &#123;string&#125; 对话框中立按钮的文字内容(最左边按钮)</span><br><span class="line"></span><br><span class="line">- `neutralColor` &#123;string&#125; | &#123;number&#125; 对话框中立按钮的文字颜色(最左边按钮)</span><br><span class="line"></span><br><span class="line">- `negative` &#123;string&#125; 对话框取消按钮的文字内容(确定按钮左边的按钮)</span><br><span class="line"></span><br><span class="line">- `negativeColor` &#123;string&#125; | &#123;number&#125; 对话框取消按钮的文字颜色(确定按钮左边的按钮)</span><br><span class="line"></span><br><span class="line">- `checkBoxPrompt` &#123;string&#125; 勾选框文字内容</span><br><span class="line"></span><br><span class="line">- `checkBoxChecked` &#123;boolean&#125; 勾选框是否勾选</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  progress</span><br></pre></td></tr></table></figure><p>{Object} 配置对话框进度条的对象：</p><ul><li><code>max</code> {number} 进度条的最大值，如果为-1 则为无限循环的进度条</li><li><code>horizontal</code> {boolean} 如果为 true, 则对话框无限循环的进度条为水平进度条</li><li><code>showMinMax</code> {boolean} 是否显示进度条的最大值和最小值</li></ul></li><li><p><code>cancelable</code> {boolean} 对话框是否可取消，如果为 false，则对话框只能用代码手动取消</p></li><li><p><code>canceledOnTouchOutside</code> {boolean} 对话框是否在点击对话框以外区域时自动取消，默认为 true</p></li><li><p><code>inputHint</code> {string} 对话框的输入框的输入提示</p></li><li><p><code>inputPrefill</code> {string} 对话框输入框的默认输入内容</p></li></ul><p>通过这些选项可以自定义一个对话框，并通过监听返回的 Dialog 对象的按键、输入事件来实现交互。</p><h2 id="7、对话框事件：显示和消失事件"><a href="#7、对话框事件：显示和消失事件" class="headerlink" title="7、对话框事件：显示和消失事件"></a>7、对话框事件：显示和消失事件</h2><h3 id="事件-show"><a href="#事件-show" class="headerlink" title="事件: show"></a>事件: show</h3><ul><li><code>dialog</code> {Dialog} 对话框</li></ul><p>对话框显示时会触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dialogs.build(&#123;</span><br><span class="line">    title: &quot;标题&quot;</span><br><span class="line">&#125;).on(&quot;show&quot;, (dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;对话框显示了&quot;);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h3 id="事件-dismiss"><a href="#事件-dismiss" class="headerlink" title="事件: dismiss"></a>事件: dismiss</h3><ul><li><code>dialog</code> {Dialog} 对话框</li></ul><p>对话框消失时会触发的事件。对话框被取消或者手动调用<code>dialog.dismiss()</code>函数都会触发该事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var d = dialogs.build(&#123;</span><br><span class="line">    title: &quot;标题&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;</span><br><span class="line">&#125;).on(&quot;dismiss&quot;, (dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;对话框消失了&quot;);</span><br><span class="line">&#125;).show();</span><br><span class="line"></span><br><span class="line">setTimeout(()=&gt;&#123;</span><br><span class="line">    d.dismiss();</span><br><span class="line">&#125;, 5000);</span><br></pre></td></tr></table></figure><h2 id="8、对话框事件：按钮事件"><a href="#8、对话框事件：按钮事件" class="headerlink" title="8、对话框事件：按钮事件"></a>8、对话框事件：按钮事件</h2><h3 id="事件-positive"><a href="#事件-positive" class="headerlink" title="事件: positive"></a>事件: positive</h3><ul><li><code>dialog</code> {Dialog} 对话框</li></ul><p>确定按钮按下时触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var d = dialogs.build(&#123;</span><br><span class="line">    title: &quot;标题&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;</span><br><span class="line">&#125;).on(&quot;positive&quot;, (dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;你点击了确定&quot;);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h3 id="事件-negative"><a href="#事件-negative" class="headerlink" title="事件: negative"></a>事件: negative</h3><ul><li><code>dialog</code> {Dialog} 对话框</li></ul><p>取消按钮按下时触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var d = dialogs.build(&#123;</span><br><span class="line">    title: &quot;标题&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;</span><br><span class="line">&#125;).on(&quot;negative&quot;, (dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;你点击了取消&quot;);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h3 id="事件-cancel"><a href="#事件-cancel" class="headerlink" title="事件: cancel"></a>事件: cancel</h3><ul><li><code>dialog</code> {Dialog} 对话框</li></ul><p>对话框被取消时会触发的事件。一个对话框可能按取消按钮、返回键取消或者点击对话框以外区域取消。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dialogs.build(&#123;</span><br><span class="line">    title: &quot;标题&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;</span><br><span class="line">&#125;).on(&quot;cancel&quot;, (dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;对话框取消了&quot;);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h3 id="事件-neutral"><a href="#事件-neutral" class="headerlink" title="事件: neutral"></a>事件: neutral</h3><ul><li><code>dialog</code> {Dialog} 对话框</li></ul><p>中性按钮按下时触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var d = dialogs.build(&#123;</span><br><span class="line">    title: &quot;标题&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;,</span><br><span class="line">    neutral: &quot;稍后提示&quot;</span><br><span class="line">&#125;).on(&quot;positive&quot;, (dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;你点击了稍后提示&quot;);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h3 id="事件-any"><a href="#事件-any" class="headerlink" title="事件: any"></a>事件: any</h3><ul><li><code>dialog</code> {Dialog} 对话框</li><li>action {string} 被点击的按钮，可能的值为:<ul><li><code>positive</code> 确定按钮</li><li><code>negative</code> 取消按钮</li><li><code>neutral</code> 中性按钮</li></ul></li></ul><p>任意按钮按下时触发的事件。例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var d = dialogs.build(&#123;</span><br><span class="line">    title: &quot;标题&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;,</span><br><span class="line">    neutral: &quot;稍后提示&quot;</span><br><span class="line">&#125;).on(&quot;any&quot;, (action, dialog)=&gt;&#123;</span><br><span class="line">    if(action == &quot;positive&quot;)&#123;</span><br><span class="line">        toast(&quot;你点击了确定&quot;);</span><br><span class="line">    &#125;else if(action == &quot;negative&quot;)&#123;</span><br><span class="line">        toast(&quot;你点击了取消&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h2 id="9、对话框事件：单选多选事件"><a href="#9、对话框事件：单选多选事件" class="headerlink" title="9、对话框事件：单选多选事件"></a>9、对话框事件：单选多选事件</h2><h3 id="事件-item-select"><a href="#事件-item-select" class="headerlink" title="事件: item_select"></a>事件: item_select</h3><ul><li><code>index</code> {number} 被选中的项目索引，从 0 开始</li><li><code>item</code> {Object} 被选中的项目</li><li><code>dialog</code> {Dialog} 对话框</li></ul><p>对话框列表(itemsSelectMode 为”select”)的项目被点击选中时触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var d = dialogs.build(&#123;</span><br><span class="line">    title: &quot;请选择&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;,</span><br><span class="line">    items: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;],</span><br><span class="line">    itemsSelectMode: &quot;select&quot;</span><br><span class="line">&#125;).on(&quot;item_select&quot;, (index, item, dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;您选择的是第&quot; + (index + 1) + &quot;项, 选项为&quot; + item);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h3 id="事件-single-choice"><a href="#事件-single-choice" class="headerlink" title="事件: single_choice"></a>事件: single_choice</h3><ul><li><code>index</code> {number} 被选中的项目索引，从 0 开始</li><li><code>item</code> {Object} 被选中的项目</li><li><code>dialog</code> {Dialog} 对话框</li></ul><p>对话框单选列表(itemsSelectMode 为”singleChoice”)的项目被选中并点击确定时触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dialogs.build(&#123;</span><br><span class="line">    title: &#x27;这是选择框事件&#x27;,</span><br><span class="line">    items: [&#x27;A&#x27;,&#x27;B&#x27;,&#x27;C&#x27;,&#x27;D&#x27;],</span><br><span class="line">    itemsSelectMode: &#x27;single&#x27;,</span><br><span class="line">    itemsSelectedIndex: 0,</span><br><span class="line">    positive: &#x27;确定&#x27;</span><br><span class="line">&#125;).on(&#x27;single_choice&#x27;,function(index,item,dialog)&#123;</span><br><span class="line"></span><br><span class="line">    toastLog(index+&quot;----&quot;+item)</span><br><span class="line">    // 3----D</span><br><span class="line"></span><br><span class="line">    toastLog(&quot;你选择的是第&quot;+(index+1).toString()+&quot;个选项：&quot;+item)</span><br><span class="line">&#125;).show()</span><br></pre></td></tr></table></figure><h3 id="事件-multi-choice-【失效】"><a href="#事件-multi-choice-【失效】" class="headerlink" title="事件: multi_choice 【失效】"></a>事件: multi_choice 【失效】</h3><ul><li><code>indices</code> {Array} 被选中的项目的索引的数组</li><li><code>items</code> {Array} 被选中的项目的数组</li><li><code>dialog</code> {Dialog} 对话框</li></ul><p>对话框多选列表(itemsSelectMode 为”multiChoice”)的项目被选中并点击确定时触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var d = dialogs.build(&#123;</span><br><span class="line">    title: &quot;请选择&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;,</span><br><span class="line">    items: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;],</span><br><span class="line">    itemsSelectMode: &quot;multiChoice&quot;</span><br><span class="line">&#125;).on(&quot;item_select&quot;, (indices, items, dialog)=&gt;&#123;</span><br><span class="line">    toast(util.format(&quot;您选择的项目为%o, 选项为%o&quot;, indices, items);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h2 id="10、对话框事件：输入事件"><a href="#10、对话框事件：输入事件" class="headerlink" title="10、对话框事件：输入事件"></a>10、对话框事件：输入事件</h2><h3 id="事件-input"><a href="#事件-input" class="headerlink" title="事件: input"></a>事件: input</h3><ul><li><code>text</code> {string} 输入框的内容</li><li><code>dialog</code> {Dialog} 对话框</li></ul><p>带有输入框的对话框当点击确定时会触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dialogs.build(&#123;</span><br><span class="line">    title: &quot;请输入&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;,</span><br><span class="line">    inputPrefill: &quot;&quot;</span><br><span class="line">&#125;).on(&quot;input&quot;, (text, dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;你输入的是&quot; + text);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h3 id="事件-input-change"><a href="#事件-input-change" class="headerlink" title="事件: input_change"></a>事件: input_change</h3><ul><li><code>text</code> {string} 输入框的内容</li><li><code>dialog</code> {Dialog} 对话框</li></ul><p>对话框的输入框的文本发生变化时会触发的事件。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dialogs.build(&#123;</span><br><span class="line">    title: &quot;请输入&quot;,</span><br><span class="line">    positive: &quot;确定&quot;,</span><br><span class="line">    negative: &quot;取消&quot;,</span><br><span class="line">    inputPrefill: &quot;&quot;</span><br><span class="line">&#125;).on(&quot;input_change&quot;, (text, dialog)=&gt;&#123;</span><br><span class="line">    toast(&quot;你输入的是&quot; + text);</span><br><span class="line">&#125;).show();</span><br></pre></td></tr></table></figure><h2 id="11、对话框对象方法"><a href="#11、对话框对象方法" class="headerlink" title="11、对话框对象方法"></a>11、对话框对象方法</h2><h3 id="dialog-getProgress"><a href="#dialog-getProgress" class="headerlink" title="dialog.getProgress()"></a>dialog.getProgress()</h3><ul><li>返回 {number}</li></ul><p>获取当前进度条的进度值，是一个整数</p><h3 id="dialog-getMaxProgress"><a href="#dialog-getMaxProgress" class="headerlink" title="dialog.getMaxProgress()"></a>dialog.getMaxProgress()</h3><ul><li>返回 {number}</li></ul><p>获取当前进度条的最大进度值，是一个整数</p><h3 id="dialog-getActionButton-action"><a href="#dialog-getActionButton-action" class="headerlink" title="dialog.getActionButton(action)"></a>dialog.getActionButton(action)</h3><p>action {string} 动作，包括:</p><ul><li><code>positive</code></li><li><code>negative</code></li><li><code>neutral</code></li></ul><h2 id="事件与监听-Events"><a href="#事件与监听-Events" class="headerlink" title="事件与监听 - Events"></a>事件与监听 - Events</h2><h2 id="1、什么是事件与监听"><a href="#1、什么是事件与监听" class="headerlink" title="1、什么是事件与监听"></a>1、什么是事件与监听</h2><p>events 模块提供了监听手机通知、按键、触摸的接口。您可以用他配合自动操作函数完成自动化工作。</p><p>events 本身是一个 EventEmiiter, 但内置了一些事件、包括按键事件、通知事件、Toast 事件等。</p><p>需要注意的是，事件的处理是单线程的，并且仍然在原线程执行，如果脚本主体或者其他事件处理中有耗时操作、轮询等，则事件将无法得到及时处理（会进入事件队列等待脚本主体或其他事件处理完成才执行）。例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">auto();</span><br><span class="line"></span><br><span class="line">//启用按键监听</span><br><span class="line">events.observeKey();</span><br><span class="line">//监听音量上键按下</span><br><span class="line">events.onKeyDown(&quot;volume_up&quot;, function(event)&#123;</span><br><span class="line">//这里不会被执行</span><br><span class="line">    toast(&quot;音量上键被按下了&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">while(true)&#123;</span><br><span class="line">    //死循环</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2、监听按键事件"><a href="#2、监听按键事件" class="headerlink" title="2、监听按键事件"></a>2、监听按键事件</h2><h3 id="events-observeKey"><a href="#events-observeKey" class="headerlink" title="events.observeKey()"></a>events.observeKey()</h3><p>启用按键监听，例如音量键、Home 键。按键监听使用无障碍服务实现，如果无障碍服务未启用会抛出异常并提示开启。</p><p>只有这个函数成功执行后, <code>onKeyDown</code>, <code>onKeyUp</code>等按键事件的监听才有效。</p><p>该函数在安卓 4.3 以上才能使用。</p><h3 id="events-onKeyDown-keyName-listener"><a href="#events-onKeyDown-keyName-listener" class="headerlink" title="events.onKeyDown(keyName, listener)"></a>events.onKeyDown(keyName, listener)</h3><ul><li><code>keyName</code> {string} 要监听的按键名称</li><li><code>listener</code> {Function} 按键监听器。参数为一个 KeyEvent</li></ul><p>注册一个按键监听函数，当有 keyName 对应的按键被按下会调用该函数。</p><p>按键事件中所有可用的按键名称为：</p><ul><li><code>volume_up</code> 音量上键</li><li><code>volume_down</code> 音量下键</li><li><code>home</code> 主屏幕键</li><li><code>back</code> 返回键</li><li><code>menu</code> 菜单键</li></ul><p>例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//启用按键监听</span><br><span class="line">events.observeKey();</span><br><span class="line">//监听音量上键按下</span><br><span class="line">events.onKeyDown(&quot;volume_up&quot;, function(event)&#123;</span><br><span class="line">    toast(&quot;音量上键被按下了&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">//监听菜单键按下</span><br><span class="line">events.onKeyDown(&quot;menu&quot;, function(event)&#123;</span><br><span class="line">    toast(&quot;菜单键被按下了&quot;);</span><br><span class="line">    exit();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="events-onKeyUp-keyName-listener"><a href="#events-onKeyUp-keyName-listener" class="headerlink" title="events.onKeyUp(keyName, listener)"></a>events.onKeyUp(keyName, listener)</h3><ul><li><code>keyName</code> {string} 要监听的按键名称</li><li><code>listener</code> {Function} 按键监听器。参数为一个 KeyEvent。</li></ul><p>注册一个按键监听函数，当有 keyName 对应的按键弹起会调用该函数。</p><p>按键事件中所有可用的按键名称为：</p><ul><li><code>volume_up</code> 音量上键</li><li><code>volume_down</code> 音量下键</li><li><code>home</code> 主屏幕键</li><li><code>back</code> 返回键</li><li><code>menu</code> 菜单键</li></ul><p>一次完整的按键动作包括了按键按下和弹起。按下事件会在手指按下一个按键的”瞬间”触发, 弹起事件则在手指放开这个按键时触发。</p><p>例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//启用按键监听</span><br><span class="line">events.observeKey();</span><br><span class="line">//监听音量下键弹起</span><br><span class="line">events.onKeyDown(&quot;volume_down&quot;, function(event)&#123;</span><br><span class="line">    toast(&quot;音量上键弹起&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">//监听Home键弹起</span><br><span class="line">events.onKeyDown(&quot;home&quot;, function(event)&#123;</span><br><span class="line">    toast(&quot;Home键弹起&quot;);</span><br><span class="line">    exit();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="3、KeyEvent-对象方法"><a href="#3、KeyEvent-对象方法" class="headerlink" title="3、KeyEvent 对象方法"></a>3、KeyEvent 对象方法</h2><h3 id="KeyEvent-getAction"><a href="#KeyEvent-getAction" class="headerlink" title="KeyEvent.getAction()"></a>KeyEvent.getAction()</h3><p>返回事件的动作。包括：</p><ul><li><code>KeyEvent.ACTION_DOWN</code> 按下事件</li><li><code>KeyEvent.ACTION_UP</code> 弹起事件</li></ul><h3 id="KeyEvent-getKeyCode"><a href="#KeyEvent-getKeyCode" class="headerlink" title="KeyEvent.getKeyCode()"></a>KeyEvent.getKeyCode()</h3><p>返回按键的键值。包括：</p><ul><li><code>KeyEvent.KEYCODE_HOME</code> 主页键</li><li><code>KeyEvent.KEYCODE_BACK</code> 返回键</li><li><code>KeyEvent.KEYCODE_MENU</code> 菜单键</li><li><code>KeyEvent.KEYCODE_VOLUME_UP</code> 音量上键</li><li><code>KeyEvent.KEYCODE_VOLUME_DOWN</code> 音量下键</li></ul><h3 id="KeyEvent-getEventTime"><a href="#KeyEvent-getEventTime" class="headerlink" title="KeyEvent.getEventTime()"></a>KeyEvent.getEventTime()</h3><ul><li>返回 {number}</li></ul><p>返回事件发生的时间戳。</p><h3 id="KeyEvent-getDownTime"><a href="#KeyEvent-getDownTime" class="headerlink" title="KeyEvent.getDownTime()"></a>KeyEvent.getDownTime()</h3><p>返回最近一次按下事件的时间戳。如果本身是按下事件，则与<code>getEventTime()</code>相同。</p><h3 id="KeyEvent-keyCodeToString-keyCode"><a href="#KeyEvent-keyCodeToString-keyCode" class="headerlink" title="KeyEvent.keyCodeToString(keyCode)"></a>KeyEvent.keyCodeToString(keyCode)</h3><p>把键值转换为字符串。例如 24 转换为”KEYCODE_HOME”。</p><h2 id="4、事件：key、key-down、key-up"><a href="#4、事件：key、key-down、key-up" class="headerlink" title="4、事件：key、key_down、key_up"></a>4、事件：key、key_down、key_up</h2><h3 id="事件-‘key’"><a href="#事件-‘key’" class="headerlink" title="事件: ‘key’"></a>事件: ‘key’</h3><ul><li><code>keyCode</code> {number} 键值</li><li><code>event</code> {KeyEvent} 事件</li></ul><p>当有按键被按下或弹起时会触发该事件。 例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto();</span><br><span class="line">events.observeKey();</span><br><span class="line">events.on(&quot;key&quot;, function(keyCode, event)&#123;</span><br><span class="line">    //处理按键事件</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>其中监听器的参数 KeyCode 包括：</p><ul><li><code>keys.home</code> 主页键</li><li><code>keys.back</code> 返回键</li><li><code>keys.menu</code> 菜单键</li><li><code>keys.volume_up</code> 音量上键</li><li><code>keys.volume_down</code> 音量下键</li></ul><p>例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">auto();</span><br><span class="line">events.observeKey();</span><br><span class="line">events.on(&quot;key&quot;, function(keyCode, event)&#123;</span><br><span class="line">    if(keyCode == keys.menu &amp;&amp; event.getAction() == event.ACTION_UP)&#123;</span><br><span class="line">        toast(&quot;菜单键按下&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="事件-‘key-down’"><a href="#事件-‘key-down’" class="headerlink" title="事件: ‘key_down’"></a>事件: ‘key_down’</h3><ul><li><code>keyCode</code> {number} 键值</li><li><code>event</code> {KeyEvent} 事件</li></ul><p>当有按键被按下时会触发该事件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto();</span><br><span class="line">events.observeKey();</span><br><span class="line">events.on(&quot;key_down&quot;, function(keyCode, event)&#123;</span><br><span class="line">    //处理按键按下事件</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="事件-‘key-up’"><a href="#事件-‘key-up’" class="headerlink" title="事件: ‘key_up’"></a>事件: ‘key_up’</h3><ul><li><code>keyCode</code> {number} 键值</li><li><code>event</code> {KeyEvent} 事件</li></ul><p>当有按键弹起时会触发该事件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto();</span><br><span class="line">events.observeKey();</span><br><span class="line">events.on(&quot;key_up&quot;, function(keyCode, event)&#123;</span><br><span class="line">    //处理按键弹起事件</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="5、单次监听按键事件"><a href="#5、单次监听按键事件" class="headerlink" title="5、单次监听按键事件"></a>5、单次监听按键事件</h2><h3 id="events-onceKeyDown-keyName-listener"><a href="#events-onceKeyDown-keyName-listener" class="headerlink" title="events.onceKeyDown(keyName, listener)"></a>events.onceKeyDown(keyName, listener)</h3><ul><li><code>keyName</code> {string} 要监听的按键名称</li><li><code>listener</code> {Function} 按键监听器。参数为一个 KeyEvent</li></ul><p>注册一个按键监听函数，当有 keyName 对应的按键被按下时会调用该函数，之后会注销该按键监听器。</p><p>也就是 listener 只有在 onceKeyDown 调用后的第一次按键事件被调用一次。</p><h3 id="events-onceKeyUp-keyName-listener"><a href="#events-onceKeyUp-keyName-listener" class="headerlink" title="events.onceKeyUp(keyName, listener)"></a>events.onceKeyUp(keyName, listener)</h3><ul><li><code>keyName</code> {string} 要监听的按键名称</li><li><code>listener</code> {Function} 按键监听器。参数为一个 KeyEvent</li></ul><p>注册一个按键监听函数，当有 keyName 对应的按键弹起时会调用该函数，之后会注销该按键监听器。</p><p>也就是 listener 只有在 onceKeyUp 调用后的第一次按键事件被调用一次。</p><h2 id="6、删除按键事件的监听"><a href="#6、删除按键事件的监听" class="headerlink" title="6、删除按键事件的监听"></a>6、删除按键事件的监听</h2><h3 id="events-removeAllKeyDownListeners-keyName"><a href="#events-removeAllKeyDownListeners-keyName" class="headerlink" title="events.removeAllKeyDownListeners(keyName)"></a>events.removeAllKeyDownListeners(keyName)</h3><ul><li><code>keyName</code> {string} 按键名称</li></ul><p>删除该按键的 KeyDown(按下)事件的所有监听。</p><h3 id="events-removeAllKeyUpListeners-keyName"><a href="#events-removeAllKeyUpListeners-keyName" class="headerlink" title="events.removeAllKeyUpListeners(keyName)"></a>events.removeAllKeyUpListeners(keyName)</h3><ul><li><code>keyName</code> {string} 按键名称</li></ul><p>删除该按键的 KeyUp(弹起)事件的所有监听。</p><h2 id="7、屏蔽原有按键功能"><a href="#7、屏蔽原有按键功能" class="headerlink" title="7、屏蔽原有按键功能"></a>7、屏蔽原有按键功能</h2><h3 id="events-setKeyInterceptionEnabled-key-enabled"><a href="#events-setKeyInterceptionEnabled-key-enabled" class="headerlink" title="events.setKeyInterceptionEnabled([key, ]enabled)"></a>events.setKeyInterceptionEnabled([key, ]enabled)</h3><ul><li><code>enabled</code> {boolean}</li><li><code>key</code> {string} 要屏蔽的按键</li></ul><p>设置按键屏蔽是否启用。所谓按键屏蔽指的是，屏蔽原有按键的功能，例如使得音量键不再能调节音量，但此时仍然能通过按键事件监听按键。</p><p>如果不加参数 key 则会屏蔽所有按键。</p><p>例如，调用<code>events.setKeyInterceptionEnabled(true)</code>会使系统的音量、Home、返回等键不再具有调节音量、回到主页、返回的作用，但此时仍然能通过按键事件监听按键。</p><p>该函数通常于按键监听结合，例如想监听音量键并使音量键按下时不弹出音量调节框则为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">events.setKeyInterceptionEnabled(&quot;volume_up&quot;, true);</span><br><span class="line">events.observeKey();</span><br><span class="line">events.onKeyDown(&quot;volume_up&quot;, ()=&gt;&#123;</span><br><span class="line">    log(&quot;音量上键被按下&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>只要有一个脚本屏蔽了某个按键，该按键便会被屏蔽；当脚本退出时，会自动解除所有按键屏蔽。</p><h2 id="8、屏幕触摸事件监听（需要-root-权限）"><a href="#8、屏幕触摸事件监听（需要-root-权限）" class="headerlink" title="8、屏幕触摸事件监听（需要 root 权限）"></a>8、屏幕触摸事件监听（需要 root 权限）</h2><h3 id="events-observeTouch"><a href="#events-observeTouch" class="headerlink" title="events.observeTouch()"></a>events.observeTouch()</h3><p>启用屏幕触摸监听。（需要 root 权限）</p><p>只有这个函数被成功执行后, 触摸事件的监听才有效。</p><p>没有 root 权限调用该函数则什么也不会发生。</p><h3 id="events-setTouchEventTimeout-timeout"><a href="#events-setTouchEventTimeout-timeout" class="headerlink" title="events.setTouchEventTimeout(timeout)"></a>events.setTouchEventTimeout(timeout)</h3><ul><li><code>timeout</code> {number} 两个触摸事件的最小间隔。单位毫秒。默认为 10 毫秒。如果 number 小于 0，视为 0 处理。</li></ul><p>设置两个触摸事件分发的最小时间间隔。</p><p>例如间隔为 10 毫秒的话，前一个触摸事件发生并被注册的监听器处理后，至少要过 10 毫秒才能分发和处理下一个触摸事件，这 10 毫秒之间的触摸将会被忽略。</p><p>建议在满足需要的情况下尽量提高这个间隔。一个简单滑动动作可能会连续触发上百个触摸事件，如果 timeout 设置过低可能造成事件拥堵。强烈建议不要设置 timeout 为 0。</p><h3 id="events-getTouchEventTimeout"><a href="#events-getTouchEventTimeout" class="headerlink" title="events.getTouchEventTimeout()"></a>events.getTouchEventTimeout()</h3><p>返回触摸事件的最小时间间隔。</p><h3 id="events-onTouch-listener"><a href="#events-onTouch-listener" class="headerlink" title="events.onTouch(listener)"></a>events.onTouch(listener)</h3><ul><li><code>listener</code> {Function} 参数为<a href="https://hyb1996.github.io/AutoJs-Docs/##/images.html?id=images_point">Point</a>的函数</li></ul><p>注册一个触摸监听函数。相当于<code>on(&quot;touch&quot;, listener)</code>。</p><p>例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//启用触摸监听</span><br><span class="line">events.observeTouch();</span><br><span class="line">//注册触摸监听器</span><br><span class="line">events.onTouch(function(p)&#123;</span><br><span class="line">    //触摸事件发生时, 打印出触摸的点的坐标</span><br><span class="line">    log(p.x + &quot;, &quot; + p.y);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="events-removeAllTouchListeners"><a href="#events-removeAllTouchListeners" class="headerlink" title="events.removeAllTouchListeners()"></a>events.removeAllTouchListeners()</h3><p>删除所有事件监听函数。</p><h2 id="9、通知事件监听：QQ-消息、微信消息、推送等通知"><a href="#9、通知事件监听：QQ-消息、微信消息、推送等通知" class="headerlink" title="9、通知事件监听：QQ 消息、微信消息、推送等通知"></a>9、通知事件监听：QQ 消息、微信消息、推送等通知</h2><h3 id="events-observeNotification"><a href="#events-observeNotification" class="headerlink" title="events.observeNotification()"></a>events.observeNotification()</h3><p>通知监听依赖于通知服务，如果通知服务没有运行，会抛出异常并跳转到通知权限开启界面。（有时即使通知权限已经开启通知服务也没有运行，这时需要关闭权限再重新开启一次）</p><p>例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events.<span class="title function_">obvereNotification</span>();</span><br><span class="line">events.<span class="title function_">onNotification</span>(<span class="keyword">function</span> (<span class="params">notification</span>) &#123;</span><br><span class="line">  <span class="title function_">log</span>(notification.<span class="title function_">getText</span>());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="事件-‘notification’"><a href="#事件-‘notification’" class="headerlink" title="事件: ‘notification’"></a>事件: ‘notification’</h3><ul><li><code>notification</code> Notification 通知对象</li></ul><p>当有应用发出通知时会触发该事件，参数为 Notification。</p><p>例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">events.<span class="title function_">observeNotification</span>();</span><br><span class="line">events.<span class="title function_">on</span>(<span class="string">&quot;notification&quot;</span>, <span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="title function_">log</span>(</span><br><span class="line">    <span class="string">&quot;收到新通知:\n 标题: %s, 内容: %s, \n包名: %s&quot;</span>,</span><br><span class="line">    n.<span class="title function_">getTitle</span>(),</span><br><span class="line">    n.<span class="title function_">getText</span>(),</span><br><span class="line">    n.<span class="title function_">getPackageName</span>()</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="10、Notification-对象"><a href="#10、Notification-对象" class="headerlink" title="10、Notification 对象"></a>10、Notification 对象</h2><p>通知对象，可以获取通知详情，包括通知标题、内容、发出通知的包名、时间等，也可以对通知进行操作，比如点击、删除。</p><h3 id="Notification-number"><a href="#Notification-number" class="headerlink" title="Notification.number"></a>Notification.number</h3><ul><li>{number}</li></ul><p>通知数量。例如 QQ 连续收到两条消息时 number 为 2。</p><h3 id="Notification-when"><a href="#Notification-when" class="headerlink" title="Notification.when"></a>Notification.when</h3><ul><li>{number}</li></ul><p>通知发出时间的时间戳，可以用于构造<code>Date</code>对象。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events.observeNotification();</span><br><span class="line">events.on(&quot;notification&quot;, function(n)&#123;</span><br><span class="line">    log(&quot;通知时间为&#125;&quot; + new Date(n.when));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Notification-getPackageName"><a href="#Notification-getPackageName" class="headerlink" title="Notification.getPackageName()"></a>Notification.getPackageName()</h3><ul><li>返回 {string}</li></ul><p>获取发出通知的应用包名。</p><h3 id="Notification-getTitle"><a href="#Notification-getTitle" class="headerlink" title="Notification.getTitle()"></a>Notification.getTitle()</h3><ul><li>返回 {string}</li></ul><p>获取通知的标题。</p><h3 id="Notification-getText"><a href="#Notification-getText" class="headerlink" title="Notification.getText()"></a>Notification.getText()</h3><ul><li>返回 {string}</li></ul><p>获取通知的内容。</p><h3 id="Notification-click"><a href="#Notification-click" class="headerlink" title="Notification.click()"></a>Notification.click()</h3><p>点击该通知。例如对于一条 QQ 消息，点击会进入具体的聊天界面。</p><h3 id="Notification-delete"><a href="#Notification-delete" class="headerlink" title="Notification.delete()"></a>Notification.delete()</h3><p>删除该通知。该通知将从通知栏中消失。</p><h2 id="11、toast-事件监听"><a href="#11、toast-事件监听" class="headerlink" title="11、toast 事件监听"></a>11、toast 事件监听</h2><h3 id="events-observeToast"><a href="#events-observeToast" class="headerlink" title="events.observeToast()"></a>events.observeToast()</h3><p>开启 Toast 监听。</p><p>Toast 监听依赖于无障碍服务，因此此函数会确保无障碍服务运行。</p><h3 id="事件-‘toast’"><a href="#事件-‘toast’" class="headerlink" title="事件: ‘toast’"></a>事件: ‘toast’</h3><ul><li><code>getText()</code> 获取 Toast 的文本内容</li><li><code>getPackageName()</code> 获取发出 Toast 的应用包名</li></ul><p>当有应用发出 toast(气泡消息)时会触发该事件。但 Auto.js 软件本身的 toast 除外。</p><p>例如，要记录发出所有 toast 的应用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events.observeToast();</span><br><span class="line">events.onToast(function(toast)&#123;</span><br><span class="line">    log(&quot;Toast内容: &quot; + toast.getText() + &quot; 包名: &quot; + toast.getPackageName());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="12、EventEmitter-对象"><a href="#12、EventEmitter-对象" class="headerlink" title="12、EventEmitter 对象"></a>12、EventEmitter 对象</h2><p><strong>events 本身是一个 EventEmiiter, 但内置了一些事件、包括按键事件、通知事件、Toast 事件等。</strong></p><h3 id="events-emitter"><a href="#events-emitter" class="headerlink" title="events.emitter()"></a>events.emitter()</h3><p>返回一个新的 EventEmitter。这个 EventEmitter 没有内置任何事件。</p><h2 id="13、EventEmitter-对象：设置监听器数量"><a href="#13、EventEmitter-对象：设置监听器数量" class="headerlink" title="13、EventEmitter 对象：设置监听器数量"></a>13、EventEmitter 对象：设置监听器数量</h2><h3 id="EventEmitter-defaultMaxListeners"><a href="#EventEmitter-defaultMaxListeners" class="headerlink" title="EventEmitter.defaultMaxListeners"></a>EventEmitter.defaultMaxListeners</h3><p>每个事件默认可以注册最多 10 个监听器。 单个 EventEmitter 实例的限制可以使用 emitter.setMaxListeners(n) 方法改变。</p><p>所有 EventEmitter 实例的默认值可以使用 EventEmitter.defaultMaxListeners 属性改变。</p><p>设置 EventEmitter.defaultMaxListeners 要谨慎，因为会影响所有 EventEmitter 实例，包括之前创建的。 因而，调用 emitter.setMaxListeners(n) 优先于 EventEmitter.defaultMaxListeners。</p><p>注意，与 Node.js 不同，<strong>这是一个硬性限制</strong>。 EventEmitter 实例不允许添加更多的监听器，监听器超过最大数量时会抛出 TooManyListenersException。</p><h3 id="EventEmitter-getMaxListeners"><a href="#EventEmitter-getMaxListeners" class="headerlink" title="EventEmitter.getMaxListeners()"></a>EventEmitter.getMaxListeners()</h3><p>返回 EventEmitter 当前的最大监听器限制值，该值可以通过 emitter.setMaxListeners(n) 设置或默认为 EventEmitter.defaultMaxListeners。</p><h3 id="EventEmitter-setMaxListeners-n"><a href="#EventEmitter-setMaxListeners-n" class="headerlink" title="EventEmitter.setMaxListeners(n)"></a>EventEmitter.setMaxListeners(n)</h3><ul><li><code>n</code> {number}</li></ul><p>默认情况下，如果为特定事件添加了超过 10 个监听器，则 EventEmitter 会打印一个警告。 此限制有助于寻找内存泄露。 但是，并不是所有的事件都要被限为 10 个。 emitter.setMaxListeners() 方法允许修改指定的 EventEmitter 实例的限制。 值设为 Infinity（或 0）表明不限制监听器的数量。</p><p>返回一个 EventEmitter 引用，可以链式调用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">emitter.setMaxListeners(emitter.getMaxListeners() + 1);</span><br><span class="line">emitter.once(&#x27;event&#x27;, () =&gt; &#123;</span><br><span class="line">  // 做些操作</span><br><span class="line">  emitter.setMaxListeners(Math.max(emitter.getMaxListeners() - 1, 0));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="14、EventEmitter-对象：添加监听事件"><a href="#14、EventEmitter-对象：添加监听事件" class="headerlink" title="14、EventEmitter 对象：添加监听事件"></a>14、EventEmitter 对象：添加监听事件</h2><h3 id="EventEmitter-addListener-eventName-listener"><a href="#EventEmitter-addListener-eventName-listener" class="headerlink" title="EventEmitter.addListener(eventName, listener)"></a>EventEmitter.addListener(eventName, listener)</h3><ul><li><code>eventName</code> {any}</li><li><code>listener</code> {Function}</li></ul><p>emitter.on(eventName, listener) 的别名。</p><h3 id="EventEmitter-on-eventName-listener"><a href="#EventEmitter-on-eventName-listener" class="headerlink" title="EventEmitter.on(eventName, listener)"></a>EventEmitter.on(eventName, listener)</h3><ul><li><code>eventName</code> {any} 事件名</li><li><code>listener</code> {Function} 回调函数</li></ul><p>添加 listener 函数到名为 eventName 的事件的监听器数组的末尾。 不会检查 listener 是否已被添加。 多次调用并传入相同的 eventName 和 listener 会导致 listener 被添加与调用多次。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.on(&#x27;connection&#x27;, (stream) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;有连接！&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>返回一个 EventEmitter 引用，可以链式调用。</p><p>默认情况下，事件监听器会按照添加的顺序依次调用。 emitter.prependListener() 方法可用于将事件监听器添加到监听器数组的开头。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const myEE = events.emitter();</span><br><span class="line">myEE.on(&#x27;foo&#x27;, () =&gt; console.log(&#x27;a&#x27;));</span><br><span class="line">myEE.prependListener(&#x27;foo&#x27;, () =&gt; console.log(&#x27;b&#x27;));</span><br><span class="line">myEE.emit(&#x27;foo&#x27;);</span><br><span class="line">// 打印:</span><br><span class="line">//   b</span><br><span class="line">//   a</span><br></pre></td></tr></table></figure><h3 id="EventEmitter-once-eventName-listener"><a href="#EventEmitter-once-eventName-listener" class="headerlink" title="EventEmitter.once(eventName, listener)"></a>EventEmitter.once(eventName, listener)</h3><ul><li><code>eventName</code> {any} 事件名</li><li><code>listener</code> {Function} 回调函数</li></ul><p>添加一个单次 listener 函数到名为 eventName 的事件。 下次触发 eventName 事件时，监听器会被移除，然后调用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.once(&#x27;connection&#x27;, (stream) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;首次调用！&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>返回一个 EventEmitter 引用，可以链式调用。</p><p>默认情况下，事件监听器会按照添加的顺序依次调用。 emitter.prependOnceListener() 方法可用于将事件监听器添加到监听器数组的开头。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const myEE = events.emitter();</span><br><span class="line">myEE.once(&#x27;foo&#x27;, () =&gt; console.log(&#x27;a&#x27;));</span><br><span class="line">myEE.prependOnceListener(&#x27;foo&#x27;, () =&gt; console.log(&#x27;b&#x27;));</span><br><span class="line">myEE.emit(&#x27;foo&#x27;);</span><br><span class="line">// 打印:</span><br><span class="line">//   b</span><br><span class="line">//   a</span><br></pre></td></tr></table></figure><h2 id="15、EventEmitter-对象：调用监听事件"><a href="#15、EventEmitter-对象：调用监听事件" class="headerlink" title="15、EventEmitter 对象：调用监听事件"></a>15、EventEmitter 对象：调用监听事件</h2><h3 id="EventEmitter-emit-eventName-…args"><a href="#EventEmitter-emit-eventName-…args" class="headerlink" title="EventEmitter.emit(eventName[, …args])"></a>EventEmitter.emit(eventName[, …args])</h3><ul><li><code>eventName</code> {any}</li><li><code>args</code> {any}</li></ul><p>按监听器的注册顺序，同步地调用每个注册到名为 eventName 事件的监听器，并传入提供的参数。</p><p>如果事件有监听器，则返回 true ，否则返回 false。</p><h2 id="16、EventEmitter-对象：获取监听事件"><a href="#16、EventEmitter-对象：获取监听事件" class="headerlink" title="16、EventEmitter 对象：获取监听事件"></a>16、EventEmitter 对象：获取监听事件</h2><h3 id="EventEmitter-eventNames"><a href="#EventEmitter-eventNames" class="headerlink" title="EventEmitter.eventNames()"></a>EventEmitter.eventNames()</h3><p>返回一个列出触发器已注册监听器的事件的数组。 数组中的值为字符串或符号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const myEE = events.emitter();</span><br><span class="line">myEE.on(&#x27;foo&#x27;, () =&gt; &#123;&#125;);</span><br><span class="line">myEE.on(&#x27;bar&#x27;, () =&gt; &#123;&#125;);</span><br><span class="line"></span><br><span class="line">const sym = Symbol(&#x27;symbol&#x27;);</span><br><span class="line">myEE.on(sym, () =&gt; &#123;&#125;);</span><br><span class="line"></span><br><span class="line">console.log(myEE.eventNames());</span><br><span class="line">// 打印: [ &#x27;foo&#x27;, &#x27;bar&#x27;, Symbol(symbol) ]</span><br></pre></td></tr></table></figure><h3 id="EventEmitter-listenerCount-eventName"><a href="#EventEmitter-listenerCount-eventName" class="headerlink" title="EventEmitter.listenerCount(eventName)"></a>EventEmitter.listenerCount(eventName)</h3><ul><li><code>eventName</code> {string} 正在被监听的事件名</li></ul><p>返回正在监听名为 eventName 的事件的监听器的数量。</p><h3 id="EventEmitter-listeners-eventName"><a href="#EventEmitter-listeners-eventName" class="headerlink" title="EventEmitter.listeners(eventName)"></a>EventEmitter.listeners(eventName)</h3><ul><li><code>eventName</code> {string}</li></ul><p>返回名为 eventName 的事件的监听器数组的副本。</p><h2 id="17、EventEmitter-对象：添加监听事件到开头"><a href="#17、EventEmitter-对象：添加监听事件到开头" class="headerlink" title="17、EventEmitter 对象：添加监听事件到开头"></a>17、EventEmitter 对象：添加监听事件到开头</h2><h3 id="EventEmitter-prependListener-eventName-listener"><a href="#EventEmitter-prependListener-eventName-listener" class="headerlink" title="EventEmitter.prependListener(eventName, listener)"></a>EventEmitter.prependListener(eventName, listener)</h3><ul><li><code>eventName</code> {any} 事件名</li><li><code>listener</code> {Function} 回调函数</li></ul><p>添加 listener 函数到名为 eventName 的事件的监听器数组的开头。 不会检查 listener 是否已被添加。 多次调用并传入相同的 eventName 和 listener 会导致 listener 被添加与调用多次。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.prependListener(&#x27;connection&#x27;, (stream) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;有连接！&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>返回一个 EventEmitter 引用，可以链式调用。</p><h3 id="EventEmitter-prependOnceListener-eventName-listener"><a href="#EventEmitter-prependOnceListener-eventName-listener" class="headerlink" title="EventEmitter.prependOnceListener(eventName, listener)"></a>EventEmitter.prependOnceListener(eventName, listener)</h3><ul><li><code>eventName</code> {any} 事件名</li><li><code>listener</code> {Function} 回调函数</li></ul><p>添加一个单次 listener 函数到名为 eventName 的事件的监听器数组的开头。 下次触发 eventName 事件时，监听器会被移除，然后调用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.prependOnceListener(&#x27;connection&#x27;, (stream) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;首次调用！&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>返回一个 EventEmitter 引用，可以链式调用。</p><h2 id="18、EventEmitter-对象：删除事件监听"><a href="#18、EventEmitter-对象：删除事件监听" class="headerlink" title="18、EventEmitter 对象：删除事件监听"></a>18、EventEmitter 对象：删除事件监听</h2><h3 id="EventEmitter-removeAllListeners-eventName"><a href="#EventEmitter-removeAllListeners-eventName" class="headerlink" title="EventEmitter.removeAllListeners([eventName])"></a>EventEmitter.removeAllListeners([eventName])</h3><ul><li><code>eventName</code> {any}</li></ul><p>移除全部或指定 eventName 的监听器。</p><p>注意，在代码中移除其他地方添加的监听器是一个不好的做法，尤其是当 EventEmitter 实例是其他组件或模块创建的。</p><p>返回一个 EventEmitter 引用，可以链式调用。</p><h3 id="EventEmitter-removeListener-eventName-listener-（有-bug）"><a href="#EventEmitter-removeListener-eventName-listener-（有-bug）" class="headerlink" title="EventEmitter.removeListener(eventName, listener)（有 bug）"></a>EventEmitter.removeListener(eventName, listener)（有 bug）</h3><ul><li><code>eventName</code> {any}</li><li><code>listener</code> {Function}</li></ul><p>从名为 eventName 的事件的监听器数组中移除指定的 listener。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const callback = (stream) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;有连接！&#x27;);</span><br><span class="line">&#125;;</span><br><span class="line">server.on(&#x27;connection&#x27;, callback);</span><br><span class="line">// ...</span><br><span class="line">server.removeListener(&#x27;connection&#x27;, callback);</span><br></pre></td></tr></table></figure><p>removeListener 最多只会从监听器数组里移除一个监听器实例。 如果任何单一的监听器被多次添加到指定 eventName 的监听器数组中，则必须多次调用 removeListener 才能移除每个实例。</p><p>注意，一旦一个事件被触发，所有绑定到它的监听器都会按顺序依次触发。 这意味着，在事件触发后、最后一个监听器完成执行前，任何 removeListener() 或 removeAllListeners() 调用都不会从 emit() 中移除它们。 随后的事件会像预期的那样发生。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const myEmitter = events.emitter();</span><br><span class="line"></span><br><span class="line">const callbackA = () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;A&#x27;);</span><br><span class="line">  myEmitter.removeListener(&#x27;event&#x27;, callbackB);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const callbackB = () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;B&#x27;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">myEmitter.on(&#x27;event&#x27;, callbackA);</span><br><span class="line"></span><br><span class="line">myEmitter.on(&#x27;event&#x27;, callbackB);</span><br><span class="line"></span><br><span class="line">// callbackA 移除了监听器 callbackB，但它依然会被调用。</span><br><span class="line">// 触发是内部的监听器数组为 [callbackA, callbackB]</span><br><span class="line">myEmitter.emit(&#x27;event&#x27;);</span><br><span class="line">// 打印:</span><br><span class="line">//   A</span><br><span class="line">//   B</span><br><span class="line"></span><br><span class="line">// callbackB 被移除了。</span><br><span class="line">// 内部监听器数组为 [callbackA]</span><br><span class="line">myEmitter.emit(&#x27;event&#x27;);</span><br><span class="line">// 打印:</span><br><span class="line">//   A</span><br></pre></td></tr></table></figure><p>因为监听器是使用内部数组进行管理的，所以调用它会改变在监听器被移除后注册的任何监听器的位置索引。</p><p>虽然这不会影响监听器的调用顺序，但意味着由 emitter.listeners() 方法返回的监听器数组副本需要被重新创建。</p><p>返回一个 EventEmitter 引用，可以链式调用。</p><h2 id="19、脚本间广播通信"><a href="#19、脚本间广播通信" class="headerlink" title="19、脚本间广播通信"></a>19、脚本间广播通信</h2><p>脚本间通信除了使用 engines 模块提供的<code>ScriptEngine.emit()</code>方法以外，也可以使用 events 模块提供的 broadcast 广播。</p><p>events.broadcast 本身是一个 EventEmitter，但它的事件是在脚本间共享的，所有脚本都能发送和监听这些事件；事件处理会在脚本主线程执行</p><p>例如在一个脚本发送一个广播 hello:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">events.<span class="property">broadcast</span>.<span class="title function_">emit</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;小明&quot;</span>);</span><br></pre></td></tr></table></figure><p>在其他脚本中监听并处理：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">events.<span class="property">broadcast</span>.<span class="title function_">on</span>(<span class="string">&quot;hello&quot;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="title function_">toast</span>(<span class="string">&quot;你好, &quot;</span> + name);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//保持脚本运行</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h2 id="20、获取-window-窗口信息"><a href="#20、获取-window-窗口信息" class="headerlink" title="20、获取 window 窗口信息"></a>20、获取 window 窗口信息</h2><h3 id="auto-windows"><a href="#auto-windows" class="headerlink" title="auto.windows"></a>auto.windows</h3><p>获取当前窗口的集合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto.windows.filter(w =&gt; &#123;</span><br><span class="line"></span><br><span class="line">//条件</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="21、Autojs-8-0Pro-版本：监听无障碍事件的-API"><a href="#21、Autojs-8-0Pro-版本：监听无障碍事件的-API" class="headerlink" title="21、Autojs 8.0Pro 版本：监听无障碍事件的 API"></a>21、Autojs 8.0Pro 版本：监听无障碍事件的 API</h2><p>在以前，Auto.js 也一直只能通过无限循环去判断当前界面、寻找控件，这实际上对省电优化十分不友好。</p><p>在 Pro 8.0.0-3 版本，引入了监听无障碍事件的 API。</p><h4 id="auto-registerEvents-events"><a href="#auto-registerEvents-events" class="headerlink" title="auto.registerEvents(events)"></a>auto.registerEvents(events)</h4><ul><li><code>events</code> {Array} 要监听的事件数组</li><li>返回 {EventEmitter}</li></ul><h4 id="auto-registerEvent-event-callback"><a href="#auto-registerEvent-event-callback" class="headerlink" title="auto.registerEvent(event, callback)"></a>auto.registerEvent(event, callback)</h4><ul><li><code>event</code> {String} 要监听的事件</li><li><code>callback</code> {Function} 事件回调</li><li>返回 {EventEmitter}</li></ul><p>以上两个函数用于监听一个或多个无障碍事件。所谓无障碍事件，即（其他软件）窗口发送变化、控件发送变化时的事件，包括：</p><ul><li><code>view_clicked</code> 控件被点击</li><li><code>view_long_clicked</code> 控件被长按点击</li><li><code>view_selected</code> 控件被选中</li><li><code>view_focused</code> 控件成为焦点</li><li><code>view_text_changed</code> 控件文本改变</li><li><code>view_scrolled</code> 控件被滑动</li><li><code>window_state_changed</code> 窗口状态变化</li><li><code>window_content_changed</code> 窗口内容变化</li><li><code>window_changed</code> 屏幕上显示窗口的变化（增加，删除，子窗口变化等）</li><li><code>notification_state_changed</code> 通知状态变化</li></ul><p>例如，我们要监听 Auto.js 的打开，可以用以下代码监听：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听窗口变化</span></span><br><span class="line">auto.<span class="title function_">registerEvent</span>(<span class="string">&quot;windows_changed&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 判断是否有新窗口打开</span></span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">windowChanges</span>[<span class="number">0</span>].<span class="title function_">indexOf</span>(<span class="string">&quot;add&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取新窗口的id</span></span><br><span class="line">    <span class="keyword">let</span> wid = e.<span class="property">windowId</span>;</span><br><span class="line">    <span class="comment">// 遍历窗口，获取新窗口</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable language_">window</span> = auto.<span class="property">windows</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">w</span>) =&gt;</span> w.<span class="property">id</span> == wid);</span><br><span class="line">    <span class="comment">// 判断新窗口是Auto.js</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">length</span> &gt;= <span class="number">0</span> &amp;&amp; <span class="variable language_">window</span>[<span class="number">0</span>].<span class="property">title</span> == <span class="string">&quot;Auto.js&quot;</span>) &#123;</span><br><span class="line">      <span class="title function_">toast</span>(<span class="string">&quot;Auto.js被打开了！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="22、监听无障碍事件的-API：控件被点击"><a href="#22、监听无障碍事件的-API：控件被点击" class="headerlink" title="22、监听无障碍事件的 API：控件被点击"></a>22、监听无障碍事件的 API：控件被点击</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听控件被点击：view_clicked、view_long_clicked</span></span><br><span class="line">auto.<span class="title function_">registerEvent</span>(<span class="string">&quot;view_clicked&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">log</span>(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="文件系统-Files"><a href="#文件系统-Files" class="headerlink" title="文件系统 - Files"></a>文件系统 - Files</h2><p>一次性的文件读写可以直接使用<code>files.read()</code>, <code>files.write()</code>, <code>files.append()</code>等方便的函数</p><p>但如果需要频繁读写或随机读写，则使用<code>open()</code>函数打开一个文件对象来操作文件，并在操作完毕后调用<code>close()</code>函数关闭文件。</p><h3 id="files-isFile-path"><a href="#files-isFile-path" class="headerlink" title="files.isFile(path)"></a>files.isFile(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {boolean}</li></ul><p>返回路径 path 是否是文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log(files.isDir(&quot;/sdcard/文件夹/&quot;)); //返回false</span><br><span class="line">log(files.isDir(&quot;/sdcard/文件.txt&quot;)); //返回true</span><br></pre></td></tr></table></figure><h3 id="files-isDir-path"><a href="#files-isDir-path" class="headerlink" title="files.isDir(path)"></a>files.isDir(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {boolean}</li></ul><p>返回路径 path 是否是文件夹。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log(files.isDir(&quot;/sdcard/文件夹/&quot;)); //返回true</span><br><span class="line">log(files.isDir(&quot;/sdcard/文件.txt&quot;)); //返回false</span><br></pre></td></tr></table></figure><h3 id="files-isEmptyDir-path"><a href="#files-isEmptyDir-path" class="headerlink" title="files.isEmptyDir(path)"></a>files.isEmptyDir(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {boolean}</li></ul><p>返回文件夹 path 是否为空文件夹。如果该路径并非文件夹，则直接返回<code>false</code>。</p><h3 id="files-join-parent-child"><a href="#files-join-parent-child" class="headerlink" title="files.join(parent, child)"></a>files.join(parent, child)</h3><ul><li><code>parent</code> {string} 父目录路径</li><li><code>child</code> {string} 子路径</li><li>返回 {string}</li></ul><p>连接两个路径并返回，例如<code>files.join(&quot;/sdcard/&quot;, &quot;1.txt&quot;)</code>返回”/sdcard/1.txt”。</p><h3 id="files-create-path"><a href="#files-create-path" class="headerlink" title="files.create(path)"></a>files.create(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {boolean}</li></ul><p>创建一个文件或文件夹并返回是否创建成功。如果文件已经存在，则直接返回<code>false</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">files.create(&quot;/sdcard/新文件夹/&quot;);</span><br></pre></td></tr></table></figure><h3 id="files-createWithDirs-path"><a href="#files-createWithDirs-path" class="headerlink" title="files.createWithDirs(path)"></a>files.createWithDirs(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {boolean}</li></ul><p>创建一个文件或文件夹并返回是否创建成功。如果文件所在文件夹不存在，则先创建他所在的一系列文件夹。如果文件已经存在，则直接返回<code>false</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">files.createWithDirs(&quot;/sdcard/新文件夹/新文件夹/新文件夹/1.txt&quot;);</span><br></pre></td></tr></table></figure><h3 id="files-exists-path"><a href="#files-exists-path" class="headerlink" title="files.exists(path)"></a>files.exists(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {boolean}</li></ul><p>返回在路径 path 处的文件是否存在。</p><h3 id="files-ensureDir-path"><a href="#files-ensureDir-path" class="headerlink" title="files.ensureDir(path)"></a>files.ensureDir(path)</h3><ul><li><code>path</code> {string} 路径</li></ul><p>确保路径 path 所在的文件夹存在。如果该路径所在文件夹不存在，则创建该文件夹。</p><p>例如对于路径”/sdcard/Download/ABC/1.txt”，如果/Download/文件夹不存在，则会先创建 Download，再创建 ABC 文件夹。</p><h3 id="files-read-path-encoding-“utf-8”"><a href="#files-read-path-encoding-“utf-8”" class="headerlink" title="files.read(path[, encoding = “utf-8”])"></a>files.read(path[, encoding = “utf-8”])</h3><ul><li><code>path</code> {string} 路径</li><li><code>encoding</code> {string} 字符编码，可选，默认为 utf-8</li><li>返回 {string}</li></ul><p>读取文本文件 path 的所有内容并返回。如果文件不存在，则抛出<code>FileNotFoundException</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log(files.read(&quot;/sdcard/1.txt&quot;));</span><br></pre></td></tr></table></figure><h3 id="files-readBytes-path"><a href="#files-readBytes-path" class="headerlink" title="files.readBytes(path)"></a>files.readBytes(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {byte[]}</li></ul><p>读取文件 path 的所有内容并返回一个字节数组。如果文件不存在，则抛出<code>FileNotFoundException</code>。</p><p>注意，该数组是 Java 的数组，不具有 JavaScript 数组的 forEach, slice 等函数。</p><p>一个以 16 进制形式打印文件的例子如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var data = files.readBytes(&quot;/sdcard/1.png&quot;);</span><br><span class="line">var sb = new java.lang.StringBuilder();</span><br><span class="line">for(var i = 0; i &lt; data.length; i++)&#123;</span><br><span class="line">    sb.append(data[i].toString(16));</span><br><span class="line">&#125;</span><br><span class="line">log(sb.toString());</span><br></pre></td></tr></table></figure><h3 id="files-write-path-text-encoding-“utf-8”"><a href="#files-write-path-text-encoding-“utf-8”" class="headerlink" title="files.write(path, text[, encoding = “utf-8”])"></a>files.write(path, text[, encoding = “utf-8”])</h3><ul><li><code>path</code> {string} 路径</li><li><code>text</code> {string} 要写入的文本内容</li><li><code>encoding</code> {string} 字符编码</li></ul><p>把 text 写入到文件 path 中。如果文件存在则覆盖，不存在则创建。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var text = &quot;文件内容&quot;;</span><br><span class="line">//写入文件</span><br><span class="line">files.write(&quot;/sdcard/1.txt&quot;, text);</span><br><span class="line">//用其他应用查看文件</span><br><span class="line">app.viewFile(&quot;/sdcard/1.txt&quot;);</span><br></pre></td></tr></table></figure><h3 id="files-writeBytes-path-bytes"><a href="#files-writeBytes-path-bytes" class="headerlink" title="files.writeBytes(path, bytes)"></a>files.writeBytes(path, bytes)</h3><ul><li><code>path</code> {string} 路径</li><li><code>bytes</code> {byte[]} 字节数组，要写入的二进制数据</li></ul><p>把 bytes 写入到文件 path 中。如果文件存在则覆盖，不存在则创建。</p><h3 id="files-append-path-text-encoding-‘utf-8’"><a href="#files-append-path-text-encoding-‘utf-8’" class="headerlink" title="files.append(path, text[, encoding = ‘utf-8’])"></a>files.append(path, text[, encoding = ‘utf-8’])</h3><ul><li><code>path</code> {string} 路径</li><li><code>text</code> {string} 要写入的文本内容</li><li><code>encoding</code> {string} 字符编码</li></ul><p>把 text 追加到文件 path 的末尾。如果文件不存在则创建。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var text = &quot;追加的文件内容&quot;;</span><br><span class="line">files.append(&quot;/sdcard/1.txt&quot;, text);</span><br><span class="line">files.append(&quot;/sdcard/1.txt&quot;, text);</span><br><span class="line">//用其他应用查看文件</span><br><span class="line">app.viewFile(&quot;/sdcard/1.txt&quot;);</span><br></pre></td></tr></table></figure><h3 id="files-appendBytes-path-text-encoding-‘utf-8’"><a href="#files-appendBytes-path-text-encoding-‘utf-8’" class="headerlink" title="files.appendBytes(path, text[, encoding = ‘utf-8’])"></a>files.appendBytes(path, text[, encoding = ‘utf-8’])</h3><ul><li><code>path</code> {string} 路径</li><li><code>bytes</code> {byte[]} 字节数组，要写入的二进制数据</li></ul><p>把 bytes 追加到文件 path 的末尾。如果文件不存在则创建。</p><h3 id="files-copy-fromPath-toPath"><a href="#files-copy-fromPath-toPath" class="headerlink" title="files.copy(fromPath, toPath)"></a>files.copy(fromPath, toPath)</h3><ul><li><code>fromPath</code> {string} 要复制的原文件路径</li><li><code>toPath</code> {string} 复制到的文件路径</li><li>返回 {boolean}</li></ul><p>复制文件，返回是否复制成功。例如<code>files.copy(&quot;/sdcard/1.txt&quot;, &quot;/sdcard/Download/1.txt&quot;)</code>。</p><h3 id="files-move-fromPath-toPath"><a href="#files-move-fromPath-toPath" class="headerlink" title="files.move(fromPath, toPath)"></a>files.move(fromPath, toPath)</h3><ul><li><code>fromPath</code> {string} 要移动的原文件路径</li><li><code>toPath</code> {string} 移动到的文件路径</li><li>返回 {boolean}</li></ul><p>移动文件，返回是否移动成功。例如<code>files.move(&quot;/sdcard/1.txt&quot;, &quot;/sdcard/Download/1.txt&quot;)</code>会把 1.txt 文件从 sd 卡根目录移动到 Download 文件夹。</p><h3 id="files-rename-path-newName"><a href="#files-rename-path-newName" class="headerlink" title="files.rename(path, newName)"></a>files.rename(path, newName)</h3><ul><li><code>path</code> {string} 要重命名的原文件路径</li><li><code>newName</code> {string} 要重命名的新文件名</li><li>返回 {boolean}</li></ul><p>重命名文件，并返回是否重命名成功。例如<code>files.rename(&quot;/sdcard/1.txt&quot;, &quot;2.txt&quot;)</code>。</p><h3 id="files-renameWithoutExtension-path-newName"><a href="#files-renameWithoutExtension-path-newName" class="headerlink" title="files.renameWithoutExtension(path, newName)"></a>files.renameWithoutExtension(path, newName)</h3><ul><li><code>path</code> {string} 要重命名的原文件路径</li><li><code>newName</code> {string} 要重命名的新文件名</li><li>返回 {boolean}</li></ul><p>重命名文件，不包含拓展名，并返回是否重命名成功。例如<code>files.rename(&quot;/sdcard/1.txt&quot;, &quot;2&quot;)</code>会把”1.txt”重命名为”2.txt”。</p><h3 id="files-getName-path"><a href="#files-getName-path" class="headerlink" title="files.getName(path)"></a>files.getName(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {string}</li></ul><p>返回文件的文件名。例如<code>files.getName(&quot;/sdcard/1.txt&quot;)</code>返回”1.txt”。</p><h3 id="files-getNameWithoutExtension-path"><a href="#files-getNameWithoutExtension-path" class="headerlink" title="files.getNameWithoutExtension(path)"></a>files.getNameWithoutExtension(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {string}</li></ul><p>返回不含拓展名的文件的文件名。例如<code>files.getName(&quot;/sdcard/1.txt&quot;)</code>返回”1”。</p><h3 id="files-getExtension-path"><a href="#files-getExtension-path" class="headerlink" title="files.getExtension(path)"></a>files.getExtension(path)</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {string}</li></ul><p>返回文件的拓展名。例如<code>files.getExtension(&quot;/sdcard/1.txt&quot;)</code>返回”txt”。</p><h3 id="files-remove-path）"><a href="#files-remove-path）" class="headerlink" title="files.remove(path）"></a>files.remove(path）</h3><ul><li><code>path</code> {string} 路径</li><li>返回 {boolean}</li></ul><p>删除文件或<strong>空文件夹</strong>，返回是否删除成功。</p><h3 id="files-removeDir-path"><a href="#files-removeDir-path" class="headerlink" title="files.removeDir(path)"></a>files.removeDir(path)</h3><ul><li><code>path</code> {string} 路径</li><li><code>path</code> {string} 路径</li><li>返回 {boolean}</li></ul><p>删除文件夹，如果文件夹不为空，则删除该文件夹的所有内容再删除该文件夹，返回是否全部删除成功。</p><h3 id="files-getSdcardPath"><a href="#files-getSdcardPath" class="headerlink" title="files.getSdcardPath()"></a>files.getSdcardPath()</h3><ul><li>返回 {string}</li></ul><p>返回 SD 卡路径。所谓 SD 卡，即外部存储器。</p><h3 id="files-cwd"><a href="#files-cwd" class="headerlink" title="files.cwd()"></a>files.cwd()</h3><ul><li>返回 {string}</li></ul><p>返回脚本的”当前工作文件夹路径”。该路径指的是，如果脚本本身为脚本文件，则返回这个脚本文件所在目录；否则返回<code>null</code>获取其他设定路径。</p><p>例如，对于脚本文件”/sdcard/脚本/1.js”运行<code>files.cwd()</code>返回”/sdcard/脚本/“。</p><h3 id="files-path-relativePath"><a href="#files-path-relativePath" class="headerlink" title="files.path(relativePath)"></a>files.path(relativePath)</h3><ul><li><code>relativePath</code> {string} 相对路径</li><li>返回 {string}</li></ul><p>返回相对路径对应的绝对路径。例如<code>files.path(&quot;./1.png&quot;)</code>，如果运行这个语句的脚本位于文件夹”/sdcard/脚本/“中，则返回<code>&quot;/sdcard/脚本/1.png&quot;</code>。</p><h3 id="files-listDir-path-filter"><a href="#files-listDir-path-filter" class="headerlink" title="files.listDir(path[, filter])"></a>files.listDir(path[, filter])</h3><ul><li><code>path</code> {string} 路径</li><li><code>filter</code> {Function} 过滤函数，可选。接收一个<code>string</code>参数（文件名），返回一个<code>boolean</code>值。</li></ul><p>列出文件夹 path 下的满足条件的文件和文件夹的名称的数组。如果不加 filter 参数，则返回所有文件和文件夹。</p><p>列出 sdcard 目录下所有文件和文件夹为:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var arr = files.listDir(&quot;/sdcard/&quot;);</span><br><span class="line">log(arr);</span><br></pre></td></tr></table></figure><p>列出脚本目录下所有 js 脚本文件为:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var dir = &quot;/sdcard/脚本/&quot;;</span><br><span class="line">var jsFiles = files.listDir(dir, function(name)&#123;</span><br><span class="line">    return name.endsWith(&quot;.js&quot;) &amp;&amp; files.isFile(files.join(dir, name));</span><br><span class="line">&#125;);</span><br><span class="line">log(jsFiles);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">是否是文件</span><br><span class="line">是否是文件夹</span><br><span class="line">是否是空的文件夹</span><br><span class="line">合并路径</span><br><span class="line">创建文件夹</span><br><span class="line">创建一系列文件夹</span><br><span class="line">文件是否存在</span><br><span class="line">确保文件夹存在</span><br><span class="line">读取文件</span><br><span class="line">读取文件字节集</span><br><span class="line">写到文件</span><br><span class="line">以字节集写到文件</span><br><span class="line">添加文本到文件末尾</span><br><span class="line">添加字节集到文件末尾</span><br><span class="line">复制</span><br><span class="line">移动</span><br><span class="line">重命名</span><br><span class="line">文件拓展名</span><br><span class="line">删除</span><br><span class="line">路径</span><br><span class="line">文件列表</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Autojs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tampermonkey油猴脚本编写指南</title>
      <link href="/posts/a20760c1.html"/>
      <url>/posts/a20760c1.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>本文首发于<a href="https://blog.chrxw.com/">我的博客</a>和<a href="https://keylol.com/">其乐论坛</a>，未经授权禁止转载</p><p>本文全程使用原生 JavaScript 进行编程，不使用像 jQuery 这样的第三方库</p></blockquote><h2 id="视频链接"><a href="#视频链接" class="headerlink" title="视频链接"></a>视频链接</h2><p><a href="https://www.bilibili.com/video/BV1ar4y1P7Er">零基础油猴脚本编写指南【上】</a> （对应 0x01~0x05）</p><hr><h2 id="0x00-前置知识"><a href="#0x00-前置知识" class="headerlink" title="0x00 前置知识"></a>0x00 前置知识</h2><blockquote><p>本节简单的介绍一下一些名词的概念，了解为主，直接跳过也是可以的</p></blockquote><ol><li><p>HTML、CSS 和 JS</p><p>HTML 即超文本标记语言，它用来描述各种网页元素，类似与一份清单，浏览器读取以后根据它来加载对应的资源</p><p>CSS 即层叠样式表，它只用来描述网页元素的外观，还可以添加少许动画，但是不影响功能</p><p>JS 即 JavaScript，它是一种网页脚本语言，用来让静态的网页能够响应各种动作，<del>还可以挖矿</del></p><p>如果把 HTML 比作木偶，那么 CSS 就是木偶的衣服，JS 就是木偶的提线，用来操控木偶</p></li><li><p>油猴和浏览器</p><p>当你访问链接的时候，浏览器会先下载链接对应的文件（通常是一个 HTML 文件），然后根据 HTML 描述的对象列表，来下载图片、视频等资源，有的 CSS 和 JS 内嵌在 HTML 文件里，有的则是单独的文件，等必要的资源加载完成以后，浏览器才能生成可以交互的网页</p><p>油猴实际上是一个加载器，它把用户脚本安插在最开始获取到的 HTML 文件中，这样浏览器加载网页的时候，也会加载特定的用户脚本，这样我们就能够通过编写用户脚本来修改网页了</p></li><li><p>HTML5 和 DOM</p><p>HTML5 是现行的 HTML 标准，DOM 即文档对象模型，是一用对象表示 HTML 标签的方法，通过 DOM，我们可以简单的修改文档对象的属性，来轻松修改 HTML 标签的内容</p></li></ol><hr><h2 id="0x01-初识开发者工具"><a href="#0x01-初识开发者工具" class="headerlink" title="0x01 初识开发者工具"></a>0x01 初识开发者工具</h2><blockquote><p>工欲善其事必先利其器，本节简单的介绍一下开发者工具的使用。</p><p>本节以我的博客作为演示，地址：<a href="https://blog.chrxw.com/">chrxw.com</a></p></blockquote><blockquote><p>个人比较喜欢 Firefox 的开发者工具，以下介绍均使用 Firefox 进行演示，如果使用 Chrome 的话可能布局会有细微差异，不过功能是类似的。</p><p>Chrome 自带的开发者工具貌似没有汉化，建议使用别的 Chromium 内核的浏览器（比如新版 Edge），功能都差不多。</p></blockquote><ul><li><p>在浏览器中按<code>F12</code>即可打开开发者工具</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/492353909.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/492353909.png" alt="开发者工具"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/492353909.png">开发者工具</a></p></li><li><p>查看器，左侧可以查看页面的 HTML 内容，右侧显示的是选中的 DOM 元素的 CSS</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/87191902.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/87191902.png" alt="查看器"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/87191902.png">查看器</a></p></li><li><p>控制台，可以运行自己编写的 JS 代码。</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1632548203.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1632548203.png" alt="控制台"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1632548203.png">控制台</a></p><p>也可以在设置里打开“分离式控制台”，这样就可以在所有 TAB 里都显示控制台了。</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3446722376.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/3446722376.png" alt="分离式控制台"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3446722376.png">分离式控制台</a></p></li><li><p>调试器，可以用来单步调试 JS</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2819994569.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2819994569.png" alt="调试器"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2819994569.png">调试器</a></p></li><li><p>网络，可以查看浏览器的网络请求</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1376340131.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1376340131.png" alt="网络"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1376340131.png">网络</a></p></li><li><p>储存，在这个 TAB 中可以查看网站在本地保存的内容，最常用的是 Cookie，其次是 LocalStorge（本地储存），还有个由浏览器自动管理的 Session（会话储存），JS 可以访问的只有 Cookie 和 LocalStorge。</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/592149356.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/592149356.png" alt="储存 Cookie"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/592149356.png">储存 Cookie</a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1921060360.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1921060360.png" alt="储存 LocalStorge"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1921060360.png">储存 LocalStorge</a></p></li></ul><hr><h2 id="0x02-初识-DOM"><a href="#0x02-初识-DOM" class="headerlink" title="0x02 初识 DOM"></a>0x02 初识 DOM</h2><blockquote><p>本节通过使用开发者工具，简单的演示一下如何操作 DOM 元素，以我的博客作为演示，地址：<a href="https://blog.chrxw.com/">chrxw.com</a></p></blockquote><ul><li><p>首先打开开发者工具，然后激活选择器，然后点击“标题”，这样在右边的查看器中就会显示我们点击的对象</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1627186572.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1627186572.png" alt="选中“标题”元素"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1627186572.png">选中“标题”元素</a></p></li><li><p>右键高亮的元素，然后点击“在控制台使用”（如果是 Chromium 或者 Chrome，点击“复制”/“Copy”-&gt;“复制 JS 路径”/“Copy JS path”，然后把复制结果粘贴到控制台中）</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/968354769.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/968354769.png" alt="在控制台使用"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/968354769.png">在控制台使用</a></p></li><li><p>Firefox 自动创建了一个<code>temp0</code>变量，按一下回车，可以看到控制台输出了一个 DOM 元素，点一下左边的箭头展开，可以看到这个对象的各种属性。</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/932069996.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/932069996.png" alt="“temp0”对象的属性"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/932069996.png">“temp0”对象的属性</a></p></li><li><p>接下来我们尝试修改一下它的内容</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">temp0.<span class="property">textContent</span> = <span class="string">&quot;hello world&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>按回车执行，然后可以看到，网页的标题已经被修改了</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3990911643.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/3990911643.png" alt="标题变成了“hello world”"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3990911643.png">标题变成了“hello world”</a></p></li><li><p>接着我们修改一下 CSS，让它居中显示</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">temp0.<span class="property">style</span>.<span class="property">textAlign</span> = <span class="string">&quot;center&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3390245185.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/3390245185.png" alt="标题居中显示"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3390245185.png">标题居中显示</a></p></li><li><p>接下来我们创建一个新的 DOM 元素，然后插入到网页中</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">btn.<span class="property">textContent</span> = <span class="string">&quot;按钮&quot;</span>;</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">temp0.<span class="title function_">appendChild</span>(btn);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>点一下新出现的按钮，可以看到消息弹窗</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1274148455.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1274148455.png" alt="代码运行效果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1274148455.png">代码运行效果</a></p><p>代码讲解：</p><blockquote><p>PS： document 也是 DOM 元素，它代表整个网页，其他 DOM 元素都是它的子集。</p></blockquote><ul><li><p>```javascript<br>let btn = document.createElement(“button”);<br>btn.textContent = “按钮”;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  **JavaScript**</span><br><span class="line"></span><br><span class="line">  _复制_</span><br><span class="line"></span><br><span class="line">  这两行代码创建了一个`button`对象，它内部的文本为`按钮`，由浏览器自动生成的 HTML 表达式为`&lt;button&gt;按钮&lt;/button&gt;`</span><br><span class="line"></span><br><span class="line">- ```javascript</span><br><span class="line">  btn.addEventListener(&quot;click&quot;, () =&gt; &#123;</span><br><span class="line">    alert(&quot;hello world&quot;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>这三行代码为<code>btn</code>对象添加了事件监听器，<code>addEventListener</code>的第一个参数是事件监听器的名称，第二个参数是接收到指定事件后调用的函数，<code>()=&gt;&#123; ... &#125;</code>是匿名函数的缩略写法，匿名函数还有另一种等效写法<code>function()&#123; ... &#125;</code>，或者写成普通函数，也是可以的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//匿名函数写法2</span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通函数的写法</span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, foo); <span class="comment">//foo后面不加()</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>添加好事件监听器以后，点一下按钮，就会触发<code>click</code>事件，然后由浏览器调用我们绑定的方法<code>alert(&#39;hello world&#39;);</code>，弹出消息框</p></li><li><p>```javascript<br>temp0.appendChild(btn);</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**JavaScript**</span><br><span class="line"></span><br><span class="line">_复制_</span><br><span class="line"></span><br><span class="line">`A.appendChild(B)`的作用是把 B 元素插入到 A 元素的子元素的末尾，也就是把`btn`对象插到`temp0`中，由浏览器自动帮我们修改了 HTML 文本</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">//修改前</span><br><span class="line">&lt;h1 class=&quot;m-n font-thin text-black l-h&quot;&gt;Chr_小屋&lt;/h1&gt;</span><br><span class="line">//修改后</span><br><span class="line">&lt;h1 class=&quot;m-n font-thin text-black l-h&quot;&gt;</span><br><span class="line">  Chr_小屋 &lt;button&gt;按钮&lt;/button&gt; //这是我们新创建的DOM元素</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p><strong>HTML</strong></p><p><em>复制</em></p></li></ul></li><li><p>通过操作 DOM 元素的属性，就可以很方便的修改网页的显示效果，添加各种功能。</p></li></ul><hr><h2 id="0x03-DOM-进阶之获取-DOM-元素"><a href="#0x03-DOM-进阶之获取-DOM-元素" class="headerlink" title="0x03 DOM 进阶之获取 DOM 元素"></a>0x03 DOM 进阶之获取 DOM 元素</h2><blockquote><p>通过修改 DOM 元素的属性，可以很方便地修改网页，但是首先我们得获取我们想要修改的 DOM 元素</p><p>本节将会介绍如何获通过代码获取现存的 DOM 元素，以我的博客作为演示，地址：<a href="https://blog.chrxw.com/about.html">about.html</a></p></blockquote><h3 id="1-使用-ID-进行获取"><a href="#1-使用-ID-进行获取" class="headerlink" title="1. 使用 ID 进行获取"></a>1. 使用 ID 进行获取</h3><blockquote><p>WEB 开发者设计网页的时候，会给一些经常需要修改的元素添加<code>id</code>属性，原则上每个元素的<code>id</code>都是不同的，所以如果某个元素具有<code>id</code>属性，我们就可以使用<code>getElementById</code>来获取</p><p>需要注意的是，如果元素没有<code>id</code>属性的话这个方法就行不通了</p></blockquote><p>随便打开一篇博文，最下面的评论框是带有<code>id</code>属性的，使用开发者工具我们可以看到，它的<code>id</code>为<code>comment</code></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1796896812.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1796896812.png" alt="评论框的ID"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1796896812.png">评论框的 ID</a></p><p>我们可以用<code>document.getElementById( id名称 )</code>的方式获取 DOM 元素</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> box = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;comment&quot;</span>);</span><br><span class="line">box.<span class="property">value</span> = <span class="string">&quot;通过ID获取DOM&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>代码非常好理解，先调用<code>getElementById</code>方法获取 DOM，然后修改它的<code>value</code>属性，效果就是文本框的内容被修改了</p><blockquote><p>PS： textContent 属性修改的是 HTML 文本，而 value 属性修改的是<strong>文本框</strong>中的内容，不影响 HTML 文本</p></blockquote><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/4015974876.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/4015974876.png" alt="代码运行效果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/4015974876.png">代码运行效果</a></p><h3 id="2-使用-CSS-选择器进行获取"><a href="#2-使用-CSS-选择器进行获取" class="headerlink" title="2. 使用 CSS 选择器进行获取"></a>2. 使用 CSS 选择器进行获取</h3><blockquote><p>在一个网页中，具有<code>id</code>属性的元素不会太多，大多数时候都是没有这个属性的，这时候可以根据元素的<code>class</code>属性，使用<code>querySelector（获取符合条件的第一个元素）</code>或者<code>querySelectorAll(获取符合条件的全部元素数组)</code>进行获取</p><p>本节只介绍常用的方法，更详细的介绍可以参考这个：<a href="https://www.w3school.com.cn/cssref/css_selectors.asp">CSS 选择器参考手册</a></p></blockquote><ul><li><p>根据<code>class</code>进行选择</p><p>标题元素的<code>class</code>为<code>entry-title m-n font-thin text-black l-h</code>，<code>class</code>选择器的语法为<code>.</code>+<code>class名称</code>，如果有多个<code>class</code>名称，则用<code>.</code>分隔</p><p>所以标题元素的选择器写法为<code>.entry-title.m-n.font-thin.text-black.l-h</code></p><blockquote><p>在 CSS 选择器语法中，空格代表子元素的意思，所以不能随意添加空格。</p></blockquote><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3420271956.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/3420271956.png" alt="“entry-title”这个类名是独一无二的"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3420271956.png">“entry-title”这个类名是独一无二的</a></p><p>通过搜索，我们发现<code>entry-title</code>在 HTML 文档只出现了一次，因此选择器也可以简化写作<code>.entry-title</code>，代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//两种写法等效</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.entry-title.m-n.font-thin.text-black.l-h&quot;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.entry-title&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1955883962.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1955883962.png" alt="代码执行效果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1955883962.png">代码执行效果</a></p><p>在实际运用中，没必要给出完整的<code>class</code>，只需要写独一无二的部分即可</p></li><li><p>根据<code>id</code>进行选择（可以用，但还是建议用<code>getElementById</code>）</p><p><code>id</code>选择器的语法为<code>#</code>+<code>id名称</code>，评论框的<code>id</code>是<code>comment</code>，所以选择器写法为<code>#comment</code>，代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//两种写法等效，推荐第一种</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;comment&quot;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#comment&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1946624227.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1946624227.png" alt="代码运行效果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1946624227.png">代码运行效果</a></p></li><li><p>根据元素类型选择</p><p>还可以根据 DOM 元素的类型进行选择，如果网页中只有一个特定种类的元素，那么直接写元素类型即可</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2928204149.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2928204149.png" alt="评论框的元素类型"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2928204149.png">评论框的元素类型</a></p><p>使用开发者工具，我们可以知道，评论框的类型为<code>textarea</code>，而且整个网页只有一个<code>textarea</code>，因此选择器可以直接写成<code>textarea</code>，代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;textarea&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3206850005.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/3206850005.png" alt="代码运行效果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3206850005.png">代码运行效果</a></p></li><li><p>根据相对关系进行选择</p><p>有的时候，想要操作的元素可能没有独一无二的属性，那么就可以根据相对关系进行选择</p><p><code>A&gt;B</code>表示在<code>A</code>的一级子元素中查找<code>B</code></p><p><code>A B</code>表示在<code>A</code>的内部查找<code>B</code>（查找范围不仅包括子元素，还包括孙元素等）</p><p><code>A+B</code>表示与<code>A</code>相邻的<code>B</code>元素（平级关系，非父子关系）</p><blockquote><p>这里的 A 和 B 代表的是选择器，选择器可以嵌套使用。</p></blockquote><p><code>A.B</code>，不表示相对关系，它表示类型是<code>A</code>，<code>class</code>名是<code>B</code>的元素，这个要注意。</p><p>还是用标题元素举例子</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/359056867.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/359056867.png" alt="节点之间的层次关系"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/359056867.png">节点之间的层次关系</a></p><p>先找到容易定位的元素，然后再根据相对关系寻找想要找的元素，方法有很多，下面举几个例子</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下语句都是等效的</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;main&gt;div&gt;div&gt;header&gt;h1&quot;</span>); <span class="comment">//一级子元素</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;main header&gt;h1&quot;</span>); <span class="comment">//所有子元素</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;main h1&quot;</span>); <span class="comment">//这样也可以</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;header&gt;h1&quot;</span>); <span class="comment">//多个方法定位header对象</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#small_widgets&gt;h1&quot;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.bg-light.lter.wrapper-md&gt;h1&quot;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;header.bg-light&gt;h1&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1273064741.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1273064741.png" alt="代码执行效果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1273064741.png">代码执行效果</a></p><blockquote><p>写成这个样子主要是为了举例子，实际使用中选择器越简洁越好</p></blockquote></li><li><p>根据其他属性名称进行选择</p><p><code>[xxx]</code>选择带有<code>xxx</code>属性的元素</p><p><code>[xxx=sss]</code>选择<code>xxx</code>属性等于<code>sss</code>的元素</p><p><code>[xxx~=sss]</code>选择<code>xxx</code>属性包含<code>sss</code>的元素（<code>sss</code>必须是整个单词）</p><p><code>[xxx|=sss]</code>选择<code>xxx</code>属性以<code>sss</code>开头的元素（<code>sss</code>必须是整个单词）</p><p><code>[xxx^=sss]</code>选择<code>xxx</code>属性以<code>sss</code>开头的元素（<code>sss</code>可以是单词的一部分）</p><p><code>[xxx$=sss]</code>选择<code>xxx</code>属性以<code>sss</code>结尾的元素（<code>sss</code>可以是单词的一部分）</p><p><code>[xxx*=sss]</code>选择<code>xxx</code>属性包含<code>sss</code>的元素（<code>sss</code>可以是单词的一部分）</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2003869554.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2003869554.png" alt="“评论”的“for”属性"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2003869554.png">“评论”的“for”属性</a></p><p>通过开发者工具可以看出高亮的 DOM 元素具有<code>for</code>属性，属性值为<code>comment</code>，代码如下，感受一下几种用法的区别</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[for=comment]&quot;</span>); <span class="comment">//完整匹配</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[for|=co]&quot;</span>); <span class="comment">//匹配开头，匹配失败，for属性中没有co这个单词</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[for~=co]&quot;</span>); <span class="comment">//匹配任意位置，匹配失败，for属性中没有co这个单词</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[for^=co]&quot;</span>); <span class="comment">//匹配开头</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[for*=co]&quot;</span>); <span class="comment">//匹配任意位置</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[for*=mm]&quot;</span>); <span class="comment">//匹配任意位置</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[for$=nt]&quot;</span>); <span class="comment">//匹配结尾</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1818463942.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1818463942.png" alt="代码运行结果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1818463942.png">代码运行结果</a></p></li><li><p>组合选择器</p><p>上面介绍过的选择器可以组合使用，比如选择表情按钮中的矢量图片</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2533555611.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2533555611.png" alt="选择器与对象的对应关系"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2533555611.png">选择器与对象的对应关系</a></p><p>代码如下，自己体会一下各个部分是什么意思，以及哪些部分是没有必要的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//两种写法效果一样</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span><br><span class="line">  <span class="string">&quot;textarea.form-control[name=text]+div.OwO&gt;.OwO-logo svg&quot;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.OwO-logo svg&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3343756732.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/3343756732.png" alt="代码运行效果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3343756732.png">代码运行效果</a></p></li></ul><hr><h2 id="0x04-DOM-进阶之修改-DOM-元素"><a href="#0x04-DOM-进阶之修改-DOM-元素" class="headerlink" title="0x04 DOM 进阶之修改 DOM 元素"></a>0x04 DOM 进阶之修改 DOM 元素</h2><blockquote><p>拿到了 DOM 对象，接下来就可以进行各种操 ♂ 作了</p><p>本节将会介绍 DOM 元素的常用方法，以我的博客作为演示，地址：<a href="https://blog.chrxw.com/about.html">about.html</a></p></blockquote><p>以标题元素为例，首先我们先获取 DOM 对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> h1 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(h1);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1638747030.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1638747030.png" alt="标题DOM对象"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1638747030.png">标题 DOM 对象</a></p><p>使用开发者工具可以非常方便的看到 DOM 元素的方法和属性</p><h3 id="枚举子元素"><a href="#枚举子元素" class="headerlink" title="枚举子元素"></a>枚举子元素</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM.children</span><br></pre></td></tr></table></figure><p>返回值为 DOM 元素的所有子元素数组，如果不含有子元素，返回的是空数组。</p><p>可以通过<code>DOM.children[i]</code>的方式获取某一个子元素</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1442769440.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1442769440.png" alt="子元素列表的对应关系"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1442769440.png">子元素列表的对应关系</a></p><h3 id="获取-修改文本内容"><a href="#获取-修改文本内容" class="headerlink" title="获取/修改文本内容"></a>获取/修改文本内容</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM.textContent</span><br></pre></td></tr></table></figure><p>返回值为当前 DOM 元素内的显示字符（没有被 &lt; &gt; 包起来的所有字符），不仅包括自身，还包括所有子元素</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2681429767.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2681429767.png" alt="元素内没有子元素的情况"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2681429767.png">元素内没有子元素的情况</a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/263231933.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/263231933.png" alt="元素内有子元素的情况"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/263231933.png">元素内有子元素的情况</a></p><p><code>DOM.innerText</code>也有类似的效果，区别是它会去掉多余的换行符</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/561485445.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/561485445.png" alt="textContent和innetText的区别"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/561485445.png">textContent 和 innetText 的区别</a></p><p>也可以修改<code>DOM.textContent</code>和``DOM.innerText`</p><p>不过要注意的是，这两个方法会直接替换掉元素内部的内容，如果元素内部有其他子元素的话，子元素会消失。</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2917508146.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2917508146.png" alt="修改textContent后，元素内部原来的子元素被替换成了文本"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2917508146.png">修改 textContent 后，元素内部原来的子元素被替换成了文本</a></p><h3 id="获取-修改元素-CSS"><a href="#获取-修改元素-CSS" class="headerlink" title="获取/修改元素 CSS"></a>获取/修改元素 CSS</h3><blockquote><p>只能修改 DOM 元素的内联 CSS，全局 CSS 得修改 Style 元素才行。</p><p>CSS 相关内容不做过多介绍，贴个简单的教程：<a href="https://www.runoob.com/css/css-tutorial.html">菜鸟 CSS 教程</a></p></blockquote><p><code>DOM.style</code>，获取 DOM 元素的内联 CSS 样式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM.style.[css名称]`，获取DOM元素的特定CSS属性，例如`textAlign</span><br></pre></td></tr></table></figure><p><code>DOM.style.cssText</code>，获取 DOM 元素的内联 CSS 样式，纯文本格式</p><p>同样的，也可以用类似的方法修改 CSS 样式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM.style.[css名称] = &#x27;xxx&#x27;`，修改DOM元素的特定CSS属性为`xxx</span><br></pre></td></tr></table></figure><p><code>DOM.style.cssText = &#39;aaa: xxx;&#39;</code>，直接修改 DOM 元素的内联 CSS 文本，可以一次设置多个 CSS</p><blockquote><p>如果想隐藏某些元素的话，可以把它的 CSS 的<code>display</code>属性设置成<code>none</code>，就会被隐藏起来了</p></blockquote><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2727950089.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2727950089.png" alt="修改元素CSS"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2727950089.png">修改元素 CSS</a></p><h3 id="新增子元素"><a href="#新增子元素" class="headerlink" title="新增子元素"></a>新增子元素</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM.appendChild( [要插入的DOM对象] )</span><br></pre></td></tr></table></figure><p><code>appendChild</code>会将新插入的对象放在所有子元素的末尾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM.insertBefore( [要插入的DOM对象] , [DOM对象，将要插在这个对象之前])</span><br></pre></td></tr></table></figure><p><code>insertBefore</code>可以指定新插入的对象的位置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> h1 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> b1 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">b1.<span class="property">textContent</span> = <span class="string">&quot;按钮1&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> b2 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">b2.<span class="property">textContent</span> = <span class="string">&quot;按钮2&quot;</span>;</span><br><span class="line">h1.<span class="title function_">appendChild</span>(b1);</span><br><span class="line">h1.<span class="title function_">insertBefore</span>(b2, h1.<span class="property">children</span>[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/103122373.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/103122373.png" alt="appendChild和insertBefore的区别"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/103122373.png">appendChild 和 insertBefore 的区别</a></p><h3 id="删除对象"><a href="#删除对象" class="headerlink" title="删除对象"></a>删除对象</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM.remove()</span><br></pre></td></tr></table></figure><p>这是个方法，所以要加<code>()</code>，调用后会在 HTML 文本中删除对象对应的内容</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2153584846.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2153584846.png" alt="删除元素"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2153584846.png">删除元素</a></p><h3 id="添加-删除事件监听器"><a href="#添加-删除事件监听器" class="headerlink" title="添加/删除事件监听器"></a>添加/删除事件监听器</h3><p><code>DOM.addEventListener( [事件名称] , [回调函数])</code>添加事件监听器</p><p><code>DOM.removeEventListener( [事件名称] , [回调函数])</code>移除事件监听器</p><p>也可以用以前的写法（不推荐）：</p><p><code>DOM.on[事件名称] = [回调函数]</code>添加事件监听器</p><p><code>DOM.on[事件名称] = null</code>移除事件监听器</p><p>比如要让<code>h1</code>对象响应<code>click</code>事件，代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> h1 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>);</span><br><span class="line"><span class="comment">//比较推荐这种写法</span></span><br><span class="line">h1.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;响应click事件&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//也可以用旧风格的写法</span></span><br><span class="line">h1.<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;响应click事件&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//一些解释：</span></span><br><span class="line"><span class="comment">//() =&gt; &#123; ... &#125; 定义了一个匿名函数，相当于 function()&#123; ... &#125;</span></span><br><span class="line"><span class="comment">//也可以使用实名函数，比如定义了function foo()&#123; ... &#125;以后，也可以这么绑定：</span></span><br><span class="line"><span class="comment">//h1.addEventListener(&#x27;click&#x27;,foo);</span></span><br><span class="line"><span class="comment">//h1.onclick = foo;</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1046498810.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1046498810.png" alt="绑定方法1"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1046498810.png">绑定方法 1</a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/688308048.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/688308048.png" alt="绑定方法2"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/688308048.png">绑定方法 2</a></p><blockquote><p>删除绑定的方法也是类似的，不再赘述</p></blockquote><h3 id="模拟鼠标点击"><a href="#模拟鼠标点击" class="headerlink" title="模拟鼠标点击"></a>模拟鼠标点击</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM.click()</span><br></pre></td></tr></table></figure><p>相当于鼠标点了一下 DOM 对象，触发它的<code>click</code>事件（如果有的话）</p><hr><h2 id="0x05-第一个油猴脚本"><a href="#0x05-第一个油猴脚本" class="headerlink" title="0x05 第一个油猴脚本"></a>0x05 第一个油猴脚本</h2><blockquote><p>讲了这么久，都是在介绍前端的基础知识，接下来开始正文</p></blockquote><p>首先让我们新建一个用户脚本</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3648276243.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/3648276243.png" alt="新建用户脚本"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3648276243.png">新建用户脚本</a></p><p>按<code>Ctrl</code>+<code>S</code>即可保存</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1948554234.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1948554234.png" alt="新的用户脚本"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1948554234.png">新的用户脚本</a></p><h3 id="元信息"><a href="#元信息" class="headerlink" title="元信息"></a>元信息</h3><blockquote><p>元信息是给油猴插件使用的，用来记录脚本的属性</p></blockquote><p>新建脚本时给出的默认元信息如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         New Userscript               //名称</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/     //命名空间</span></span><br><span class="line"><span class="comment">// 说明：@namespace相同，@name也相同的脚本会被油猴当做是同一个脚本，这两个属性起到区分不同脚本的作用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @version      0.1                          //版本号</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!  //说明</span></span><br><span class="line"><span class="comment">// @author       You                          //作者</span></span><br><span class="line"><span class="comment">// @match        http://*/*                   //在什么网址下启用该脚本</span></span><br><span class="line"><span class="comment">// @grant        none                         //特殊权限（调用GM_开头的函数需要先申请权限）</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>还有部分比较常见的元信息：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @include      /https://example.com/.*/     //和@match差不多，但是支持正则表达式，我更喜欢用这个</span></span><br><span class="line"><span class="comment">// @connect      example.com                  //如果脚本需要访问跨域资源，需要提前申明</span></span><br><span class="line"><span class="comment">// @license      AGPL-3.0                     //脚本的授权许可信息</span></span><br><span class="line"><span class="comment">// @icon         https://blog.chrxw.com/favicon.ico //脚本的图标（显示在脚本列表里）</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><h3 id="代码区域"><a href="#代码区域" class="headerlink" title="代码区域"></a>代码区域</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Your code here...</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>首先定义了一个匿名函数<code>function() &#123; ... &#125;</code>，也可以写成我常用的格式，都是等效的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Your code here...</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>用<code>()</code>把匿名函数包起来，再在后面加一个<code>()</code>，表示直接执行这个匿名函数</p><blockquote><p>其实完全可以把代码写到匿名函数的外部，都可以执行，只是定义域不同而已</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;;`是伪代码，它告诉解释器，开启`严格模式</span><br></pre></td></tr></table></figure><blockquote><p>开启严格模式以后，会进行更严格的语法检查，建议开启，有利于养成良好的编码习惯</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非严格模式，允许访问未定义变量</span></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  y = <span class="number">3.14</span>; <span class="comment">// 不报错</span></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// 严格模式，允许访问已定义变量</span></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>; <span class="comment">// 启用严格模式</span></span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">3.14</span>; <span class="comment">// 不报错（y已定义）</span></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">// 严格模式，不允许访问未定义变量</span></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>; <span class="comment">// 启用严格模式</span></span><br><span class="line">  y = <span class="number">3.14</span>; <span class="comment">// 报错（y未定义）</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1722968163.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1722968163.png" alt="运行出错，原因是使用了未定义的变量 y"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1722968163.png">运行出错，原因是使用了未定义的变量 y</a></p><h3 id="实现功能"><a href="#实现功能" class="headerlink" title="实现功能"></a>实现功能</h3><blockquote><p>接下来我们为脚本编写一些功能，以我的博客作为演示，地址：<a href="https://blog.chrxw.com/about.html">about.html</a></p></blockquote><ul><li><p>首先我们需要修改<strong>元信息</strong>，让脚步只在特定的网页生效</p><p>然后添加作者名称和脚本名称（除了@match 都可以随便写）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         第一个油猴脚本</span></span><br><span class="line"><span class="comment">// @namespace    http://blog.chrxw.com/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  hello world</span></span><br><span class="line"><span class="comment">// @author       Chr_</span></span><br><span class="line"><span class="comment">// @match        https://blog.chrxw.com/about.html</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p></li><li><p>我们先不编写脚本，我们先使用开发者工具测试一下代码</p><p>首先我们找一个对象下手（如图）</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2402910262.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2402910262.png" alt="对象属性"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2402910262.png">对象属性</a></p><p>它没有<code>id</code>属性，但是它的<code>class</code>名称独一无二，所以我们可以直接用<code>document.querySelector(&#39;.item-thumb&#39;)</code>获取到 DOM 元素</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.item-thumb&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p></li><li><p>修改元素的背景图</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="property">style</span>.<span class="property">backgroundImage</span> = <span class="string">&quot;url(/usr/customize/logo.png)&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/575351090.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/575351090.png" alt="修改背景图"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/575351090.png">修改背景图</a></p></li><li><p>添加点击事件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  a.<span class="property">style</span>.<span class="property">background</span> = <span class="string">&quot;#f0f&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>点一下以后背景变成了品红色</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1056920893.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1056920893.png" alt="添加点击事件"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1056920893.png">添加点击事件</a></p></li><li><p>最后我们编写油猴脚本，让这一切自动完成</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         第一个油猴脚本</span></span><br><span class="line"><span class="comment">// @namespace    http://blog.chrxw.com/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  hello world</span></span><br><span class="line"><span class="comment">// @author       Chr_</span></span><br><span class="line"><span class="comment">// @match        https://blog.chrxw.com/about.html</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.item-thumb&quot;</span>);</span><br><span class="line">  a.<span class="property">style</span>.<span class="property">backgroundImage</span> = <span class="string">&quot;url(/usr/customize/logo.png)&quot;</span>;</span><br><span class="line">  a.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    a.<span class="property">style</span>.<span class="property">background</span> = <span class="string">&quot;#f0f&quot;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// Your code here...</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1790751152.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1790751152.png" alt="脚本运行效果1"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1790751152.png">脚本运行效果 1</a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1274556195.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1274556195.png" alt="脚本运行效果2"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1274556195.png">脚本运行效果 2</a></p><p>保存脚本以后，刷新页面，可以看到元素的背景图片已经改掉了，说明脚本运行成功了。</p></li></ul><hr><h2 id="0x06-脚本实战，Auto-Sub3"><a href="#0x06-脚本实战，Auto-Sub3" class="headerlink" title="0x06 脚本实战，Auto_Sub3"></a>0x06 脚本实战，Auto_Sub3</h2><blockquote><p>脚本获取链接：<a href="https://greasyfork.org/scripts/420878-auto-sub3">Auto_Sub3</a></p></blockquote><h3 id="脚本功能"><a href="#脚本功能" class="headerlink" title="脚本功能"></a>脚本功能</h3><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/471739013.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/471739013.png" alt="脚本功能"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/471739013.png">脚本功能</a></p><p>安装脚本以后，首页可以打开一个面板，主要功能是一键-3</p><h3 id="元信息-1"><a href="#元信息-1" class="headerlink" title="元信息"></a>元信息</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         Auto_Sub3</span></span><br><span class="line"><span class="comment">// @namespace    https://blog.chrxw.com</span></span><br><span class="line"><span class="comment">// @version      2.1</span></span><br><span class="line"><span class="comment">// @description  一键快乐-3</span></span><br><span class="line"><span class="comment">// @author       Chr_</span></span><br><span class="line"><span class="comment">// @include      https://keylol.com/*</span></span><br><span class="line"><span class="comment">// @license      AGPL-3.0</span></span><br><span class="line"><span class="comment">// @icon         https://blog.chrxw.com/favicon.ico</span></span><br><span class="line"><span class="comment">// @grant        GM_setValue</span></span><br><span class="line"><span class="comment">// @grant        GM_getValue</span></span><br><span class="line"><span class="comment">// @grant        GM_xmlhttpRequest</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>元信息提供了这个脚本的基本信息，我们还可以知道，它申请了<code>GM_setValue</code>,<code>GM_getValue</code>和<code>GM_xmlhttpRequest</code>三个特殊权限</p><h3 id="代码总览"><a href="#代码总览" class="headerlink" title="代码总览"></a>代码总览</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上次-3时间</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">VLast</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 今天还能不能-3</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">VCan3</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// 自动展开</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">VShow</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 自动-3</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">VAuto</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 音效载入</span></span><br><span class="line"><span class="keyword">let</span> sound = <span class="keyword">new</span> <span class="title class_">Audio</span>(<span class="string">&quot;https://blog.chrxw.com/usr/keylol/gas.mp3&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// 每次加载以后从这里运行</span></span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="title function_">loadCFG</span>();</span><br><span class="line">    <span class="title function_">addBtns</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">VShow</span>) &#123;</span><br><span class="line">        <span class="title function_">switchPanel</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">VCan3</span> &amp;&amp; <span class="title class_">VAuto</span>) &#123;</span><br><span class="line">        <span class="title function_">autoRoll</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加GUI</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addBtns</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 显示小轮盘</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showLiteRoll</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 自动打开面板</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fBtnShow</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 自动-3</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fBtnAuto</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 显示布尔</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bool2txt</span>(<span class="params">bool</span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 隐藏面板</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">switchPanel</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 读取设置</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadCFG</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 保存设置</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">saveCFG</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 检查能否-3</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkZP</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 禁止-3</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disableS3</span>(<span class="params"></span>) &#123; ... &#125;</span><br><span class="line"><span class="comment">// 自动-3</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">autoRoll</span>(<span class="params"></span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>先不用太纠结代码，建议先用调试模式看一下代码流程</p><h3 id="脚本调试模式"><a href="#脚本调试模式" class="headerlink" title="脚本调试模式"></a>脚本调试模式</h3><p>在设置里可以打开调试模式，开启以后在加载完脚本以后会自动暂停，可以用来动态调试脚本</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2845590638.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2845590638.png" alt="开启调试模式"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2845590638.png">开启调试模式</a></p><p>打开调试模式以后，先打开开发者工具，然后刷新页面，可以看到暂停在<code>debugger</code>语句上了</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1881573087.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1881573087.png" alt="调试中断"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1881573087.png">调试中断</a></p><p>给我们感兴趣的函数添加断点，然后点“继续运行（F8）”</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3358722047.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/3358722047.png" alt="添加断点"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/3358722047.png">添加断点</a></p><p>可以自己尝试跟踪一下每个函数的运行过程，不再赘述</p><h3 id="代码详解"><a href="#代码详解" class="headerlink" title="代码详解"></a>代码详解</h3><h4 id="脚本入口"><a href="#脚本入口" class="headerlink" title="脚本入口"></a>脚本入口</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上次-3时间</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">VLast</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 今天还能不能-3</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">VCan3</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// 自动展开</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">VShow</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 自动-3</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">VAuto</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 音效载入</span></span><br><span class="line"><span class="keyword">let</span> sound = <span class="keyword">new</span> <span class="title class_">Audio</span>(<span class="string">&quot;https://blog.chrxw.com/usr/keylol/gas.mp3&quot;</span>);</span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">  <span class="title function_">loadCFG</span>();</span><br><span class="line">  <span class="title function_">addBtns</span>();</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">VShow</span>) &#123;</span><br><span class="line">    <span class="title function_">switchPanel</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">VCan3</span> &amp;&amp; <span class="title class_">VAuto</span>) &#123;</span><br><span class="line">    <span class="title function_">autoRoll</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>首先定义了 5 个全局变量，然后运行了匿名函数，在这个匿名函数里完成了脚本的初始化工作</p><p>在匿名函数内部调用了这么几个函数：<code>loadCFG</code>，<code>addBtns</code>，<code>switchPanel</code>，<code>autoRoll</code></p><h4 id="loadCFG-saveCFG-读写配置"><a href="#loadCFG-saveCFG-读写配置" class="headerlink" title="loadCFG/saveCFG - 读写配置"></a>loadCFG/saveCFG - 读写配置</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取设置</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadCFG</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> t = <span class="literal">null</span>;</span><br><span class="line">  t = <span class="title function_">GM_getValue</span>(<span class="string">&quot;VLast&quot;</span>);</span><br><span class="line">  t = <span class="title class_">Number</span>(t);</span><br><span class="line">  <span class="keyword">if</span> (t != t) &#123;</span><br><span class="line">    t = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">VLast</span> = t;</span><br><span class="line">  t = <span class="title function_">GM_getValue</span>(<span class="string">&quot;VCan3&quot;</span>);</span><br><span class="line">  <span class="title class_">VCan3</span> = <span class="title class_">Boolean</span>(t);</span><br><span class="line">  t = <span class="title function_">GM_getValue</span>(<span class="string">&quot;VShow&quot;</span>);</span><br><span class="line">  <span class="title class_">VShow</span> = <span class="title class_">Boolean</span>(t);</span><br><span class="line">  t = <span class="title function_">GM_getValue</span>(<span class="string">&quot;VAuto&quot;</span>);</span><br><span class="line">  <span class="title class_">VAuto</span> = <span class="title class_">Boolean</span>(t);</span><br><span class="line">  <span class="comment">// 日期变更,重置VCan3</span></span><br><span class="line">  <span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="keyword">let</span> day = d.<span class="title function_">getDate</span>();</span><br><span class="line">  <span class="keyword">let</span> hour = d.<span class="title function_">getHours</span>();</span><br><span class="line">  <span class="keyword">if</span> (day != <span class="title class_">VLast</span> &amp;&amp; hour &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="title class_">VCan3</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title class_">VLast</span> = day;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">saveCFG</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 保存设置</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">saveCFG</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">GM_setValue</span>(<span class="string">&quot;VLast&quot;</span>, <span class="title class_">VLast</span>);</span><br><span class="line">  <span class="title function_">GM_setValue</span>(<span class="string">&quot;VCan3&quot;</span>, <span class="title class_">VCan3</span>);</span><br><span class="line">  <span class="title function_">GM_setValue</span>(<span class="string">&quot;VShow&quot;</span>, <span class="title class_">VShow</span>);</span><br><span class="line">  <span class="title function_">GM_setValue</span>(<span class="string">&quot;VAuto&quot;</span>, <span class="title class_">VAuto</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>脚本保存数据的方法有很多种，可以利用原生的<code>Cookie</code>，也可以利用 HTML5 标准中的<code>LocalStorge</code>，但是这两个地方只能保存文本，我们还需要自行完成类型转换，非常不方便，所以我用的是油猴自带的储存空间</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要在元信息里提前申明，才可以使用</span></span><br><span class="line"><span class="comment">// @grant        GM_setValue</span></span><br><span class="line"><span class="comment">// @grant        GM_getValue</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p><code>GM_setValue( 键名 , 键值)</code>，保存某个值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GM_getValue( 键名 )`，如果键名不存在，返回`null</span><br></pre></td></tr></table></figure><p>可以在脚本编辑器的<code>储存</code>TAB 看到当前脚本的储存空间</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2443215129.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2443215129.png" alt="储存的内容"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2443215129.png">储存的内容</a></p><p><code>saveCFG</code>非常简单，就是把 4 个全局变量保存起来</p><p><code>loadCFG</code>也很简单，就是从储存空间读取 4 个变量，然后获取现在的时间和日期，判断日期有没有变更，如果日期变了，并且当前小时数大于<code>8</code>，就把<code>Vcan3</code>赋值成<code>true</code>，然后把<code>VLast</code>改成今天的日期，最后调用<code>saveCFG</code>保存 4 个全局变量</p><h4 id="addBtns-添加-GUI"><a href="#addBtns-添加-GUI" class="headerlink" title="addBtns - 添加 GUI"></a>addBtns - 添加 GUI</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加GUI</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addBtns</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">genButton</span>(<span class="params">text, foo, id</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> b = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>); <span class="comment">//创建类型为button的DOM对象</span></span><br><span class="line">    b.<span class="property">textContent</span> = text; <span class="comment">//修改内部文本为text</span></span><br><span class="line">    b.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;margin: 3px 5px;&quot;</span>; <span class="comment">//添加样式（margin可以让元素间隔开一定距离）</span></span><br><span class="line">    b.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, foo); <span class="comment">//绑定click的事件的监听器</span></span><br><span class="line">    <span class="keyword">if</span> (id) &#123;</span><br><span class="line">      b.<span class="property">id</span> = id;</span><br><span class="line">    &#125; <span class="comment">//如果传入了id，就修改DOM对象的id</span></span><br><span class="line">    <span class="keyword">return</span> b; <span class="comment">//返回修改好的DOM对象</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">genDiv</span>(<span class="params">cls</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> d = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>); <span class="comment">//创建类型为div的DOM对象</span></span><br><span class="line">    <span class="keyword">if</span> (cls) &#123;</span><br><span class="line">      d.<span class="property">className</span> = cls;</span><br><span class="line">    &#125; <span class="comment">//如果传入了cls，就修改DOM对象的class</span></span><br><span class="line">    <span class="keyword">return</span> d; <span class="comment">//返回修改好的DOM对象</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">genPanel</span>(<span class="params">name, visiable</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> p = <span class="title function_">genDiv</span>(name); <span class="comment">//创建类型为div，class为name的DOM对象</span></span><br><span class="line">    p.<span class="property">id</span> = name; <span class="comment">//修改DOM对象的id为name</span></span><br><span class="line">    p.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;width: 100%;height: 100%;&quot;</span>; <span class="comment">//修改DOM对象的样式（占满父容器）</span></span><br><span class="line">    <span class="keyword">if</span> (!visiable) &#123;</span><br><span class="line">      p.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    &#125; <span class="comment">//修改DOM对象的样式（不可见）</span></span><br><span class="line">    <span class="keyword">return</span> p; <span class="comment">//返回修改好的DOM对象</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//使用CSS选择器获取对象</span></span><br><span class="line">  <span class="keyword">let</span> btnSwitch = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.index_left_title&gt;div&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (btnSwitch == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  btnSwitch.<span class="property">id</span> = <span class="string">&quot;btnSwitch1&quot;</span>;</span><br><span class="line">  btnSwitch.<span class="property">title</span> = <span class="string">&quot;点这里开启/隐藏控制面板&quot;</span>;</span><br><span class="line">  btnSwitch.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;width: auto;padding: 0 5px;cursor: pointer;&quot;</span>;</span><br><span class="line">  btnSwitch.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, switchPanel);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> panelArea = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.index_navi_left&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> panelOri = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.index_left_detail&quot;</span>);</span><br><span class="line">  panelOri.<span class="property">id</span> = <span class="string">&quot;panelOri&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> panel54 = <span class="title function_">genPanel</span>(<span class="string">&quot;panel54&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> aLP = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">  aLP.<span class="property">href</span> = <span class="string">&quot;https://keylol.com/t571093-1-1&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> img54 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">  img54.<span class="property">src</span> = <span class="string">&quot;https://gitee.com/chr_a1/gm_scripts/raw/master/index.png&quot;</span>;</span><br><span class="line">  img54.<span class="property">alt</span> = <span class="string">&quot;总之这里是54的名言&quot;</span>;</span><br><span class="line">  img54.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;float: right;margin-top: -28px;height: 100%;&quot;</span>;</span><br><span class="line">  aLP.<span class="title function_">appendChild</span>(img54);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> btnArea = <span class="title function_">genDiv</span>(<span class="string">&quot;btnArea&quot;</span>);</span><br><span class="line">  btnArea.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;width: 210px;text-align: center;margin-top: -10px;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> btnS3 = <span class="title function_">genButton</span>(<span class="string">&quot;【一键-3】&quot;</span>, autoRoll, <span class="string">&quot;btnS3&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">VCan3</span>) &#123;</span><br><span class="line">    btnS3.<span class="property">style</span>.<span class="property">textDecoration</span> = <span class="string">&quot;line-through&quot;</span>;</span><br><span class="line">    btnS3.<span class="property">textContent</span> = <span class="string">&quot;今天已经不能-3了&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> btnShow = <span class="title function_">genButton</span>(</span><br><span class="line">    <span class="title function_">bool2txt</span>(<span class="title class_">VShow</span>) + <span class="string">&quot;自动打开面板&quot;</span>,</span><br><span class="line">    fBtnShow,</span><br><span class="line">    <span class="string">&quot;btnShow&quot;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">let</span> btnAuto = <span class="title function_">genButton</span>(<span class="title function_">bool2txt</span>(<span class="title class_">VAuto</span>) + <span class="string">&quot;自动每日-3&quot;</span>, fBtnAuto, <span class="string">&quot;btnAuto&quot;</span>);</span><br><span class="line"></span><br><span class="line">  btnArea.<span class="title function_">appendChild</span>(btnS3);</span><br><span class="line">  btnArea.<span class="title function_">appendChild</span>(btnShow);</span><br><span class="line">  btnArea.<span class="title function_">appendChild</span>(btnAuto);</span><br><span class="line"></span><br><span class="line">  panel54.<span class="title function_">appendChild</span>(aLP);</span><br><span class="line">  panel54.<span class="title function_">appendChild</span>(btnArea);</span><br><span class="line">  panelArea.<span class="title function_">insertBefore</span>(panel54, panelArea.<span class="property">children</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>看着很长，实际上很简单，首先定义了 3 和内部函数<code>genButton</code>，<code>genDiv</code>，<code>genPanel</code>，用来生成我们需要的 DOM 元素</p><p>然后尝试用选择器获取 DOM 对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> btnSwitch = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.index_left_title&gt;div&quot;</span>); <span class="comment">//使用CSS选择器获取DOM对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (btnSwitch == <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="comment">//如果页面中不存在这个对象，就直接返回，结束运行</span></span><br><span class="line"></span><br><span class="line">btnSwitch.<span class="property">id</span> = <span class="string">&quot;btnSwitch1&quot;</span>; <span class="comment">//添加id属性</span></span><br><span class="line">btnSwitch.<span class="property">title</span> = <span class="string">&quot;点这里开启/隐藏控制面板&quot;</span>; <span class="comment">//添加title属性（鼠标悬停的时候显示的文本）</span></span><br><span class="line">btnSwitch.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;width: auto;padding: 0 5px;cursor: pointer;&quot;</span>; <span class="comment">//添加CSS样式</span></span><br><span class="line">btnSwitch.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, switchPanel); <span class="comment">//绑定click事件的回调函数为switchPanel</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>可以利用开发者工具看一下是哪个对象</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2141947194.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2141947194.png" alt="查看对象"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2141947194.png">查看对象</a></p><p>剩下的部分也很好理解，创建 3 个<code>button</code>对象，1 个<code>img</code>对象，依次添加到名为<code>panel54</code>的<code>div</code>对象里，最后再把<code>panel54</code>添加到<code>panelArea</code>中</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> panelArea = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.index_navi_left&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> panelOri = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.index_left_detail&quot;</span>);</span><br><span class="line">panelOri.<span class="property">id</span> = <span class="string">&quot;panelOri&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> panel54 = <span class="title function_">genPanel</span>(<span class="string">&quot;panel54&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> aLP = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">aLP.<span class="property">href</span> = <span class="string">&quot;https://keylol.com/t571093-1-1&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> img54 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">img54.<span class="property">src</span> = <span class="string">&quot;https://gitee.com/chr_a1/gm_scripts/raw/master/index.png&quot;</span>;</span><br><span class="line">img54.<span class="property">alt</span> = <span class="string">&quot;总之这里是54的名言&quot;</span>;</span><br><span class="line">img54.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;float: right;margin-top: -28px;height: 100%;&quot;</span>;</span><br><span class="line">aLP.<span class="title function_">appendChild</span>(img54);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> btnArea = <span class="title function_">genDiv</span>(<span class="string">&quot;btnArea&quot;</span>);</span><br><span class="line">btnArea.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&quot;width: 210px;text-align: center;margin-top: -10px;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> btnS3 = <span class="title function_">genButton</span>(<span class="string">&quot;【一键-3】&quot;</span>, autoRoll, <span class="string">&quot;btnS3&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title class_">VCan3</span>) &#123;</span><br><span class="line">  btnS3.<span class="property">style</span>.<span class="property">textDecoration</span> = <span class="string">&quot;line-through&quot;</span>;</span><br><span class="line">  btnS3.<span class="property">textContent</span> = <span class="string">&quot;今天已经不能-3了&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> btnShow = <span class="title function_">genButton</span>(<span class="title function_">bool2txt</span>(<span class="title class_">VShow</span>) + <span class="string">&quot;自动打开面板&quot;</span>, fBtnShow, <span class="string">&quot;btnShow&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> btnAuto = <span class="title function_">genButton</span>(<span class="title function_">bool2txt</span>(<span class="title class_">VAuto</span>) + <span class="string">&quot;自动每日-3&quot;</span>, fBtnAuto, <span class="string">&quot;btnAuto&quot;</span>);</span><br><span class="line"></span><br><span class="line">btnArea.<span class="title function_">appendChild</span>(btnS3);</span><br><span class="line">btnArea.<span class="title function_">appendChild</span>(btnShow);</span><br><span class="line">btnArea.<span class="title function_">appendChild</span>(btnAuto);</span><br><span class="line"></span><br><span class="line">panel54.<span class="title function_">appendChild</span>(aLP);</span><br><span class="line">panel54.<span class="title function_">appendChild</span>(btnArea);</span><br><span class="line">panelArea.<span class="title function_">insertBefore</span>(panel54, panelArea.<span class="property">children</span>[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>通过<code>switchPanel</code>，可以切换显示原来的元素和脚本的面板</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐藏面板</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">switchPanel</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> panel1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;panel54&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> panel2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;panelOri&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (panel1.<span class="property">style</span>.<span class="property">display</span> == <span class="string">&quot;none&quot;</span>) &#123;</span><br><span class="line">    btnSwitch1.<span class="property">textContent</span> = <span class="string">&quot;今天你【-3】了吗 - By Chr_&quot;</span>;</span><br><span class="line">    panel1.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">    panel2.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    btnSwitch1.<span class="property">textContent</span> = <span class="string">&quot;关注重点&quot;</span>;</span><br><span class="line">    panel1.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    panel2.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>运行效果：</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1108571100.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1108571100.png" alt="关闭的状态"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1108571100.png">关闭的状态</a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/646499800.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/646499800.png" alt="开启的状态"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/646499800.png">开启的状态</a></p><h4 id="autoRoll-自动-3"><a href="#autoRoll-自动-3" class="headerlink" title="autoRoll - 自动-3"></a>autoRoll - 自动-3</h4><p>最后我们看一下核心功能，自动-3</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动-3</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">autoRoll</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    sound.<span class="title function_">play</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> v = <span class="number">0</span>;</span><br><span class="line">  <span class="title function_">gethash</span>();</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">gethash</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">GM_xmlhttpRequest</span>(&#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;https://keylol.com/plugin.php?id=steamcn_lottery:view&amp;lottery_id=43&quot;</span>,</span><br><span class="line">      <span class="attr">onload</span>: <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (response.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> m = response.<span class="property">responseText</span>.<span class="title function_">match</span>(</span><br><span class="line">            <span class="regexp">/plugin\.php\?id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=(.+)&amp;roll/</span></span><br><span class="line">          );</span><br><span class="line">          <span class="keyword">let</span> hash = m ? m[<span class="number">1</span>] : <span class="literal">null</span>;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(hash);</span><br><span class="line">          <span class="keyword">if</span> (hash != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="title function_">roll</span>(hash);</span><br><span class="line">            <span class="title function_">roll</span>(hash);</span><br><span class="line">            <span class="title function_">roll</span>(hash);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">disableS3</span>();</span><br><span class="line">            <span class="title function_">saveCFG</span>();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;出错&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">roll</span>(<span class="params">hash</span>) &#123;</span><br><span class="line">    <span class="title function_">GM_xmlhttpRequest</span>(&#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>:</span><br><span class="line">        <span class="string">&quot;https://keylol.com/plugin.php?id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=&quot;</span> +</span><br><span class="line">        hash +</span><br><span class="line">        <span class="string">&quot;&amp;roll&quot;</span>,</span><br><span class="line">      <span class="attr">onload</span>: <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (response.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">responseText</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;出错&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (++v == <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title function_">disableS3</span>();</span><br><span class="line">          <span class="title function_">saveCFG</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>乍一看非常复杂，实际上也很好理解</p><ul><li><p>```javascript<br>try {<br>  sound.play();<br>} catch (e) {<br>  console.error(e);<br>}<br>let v = 0;<br>gethash();</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  **JavaScript**</span><br><span class="line"></span><br><span class="line">  _复制_</span><br><span class="line"></span><br><span class="line">  首先调用`sound.play()`，播放蒸汽泄漏的音效，`sound`是全局变量，会在网页载入的时候自动加载音频资源，如果遇到错误就忽略错误（比如网络问题加载音频失败的话就会报错）</span><br><span class="line"></span><br><span class="line">  然后调用了`gethash`方法</span><br><span class="line"></span><br><span class="line">- ```javascript</span><br><span class="line">  function gethash() &#123;</span><br><span class="line">    GM_xmlhttpRequest(&#123;</span><br><span class="line">      method: &quot;GET&quot;,</span><br><span class="line">      url: &quot;https://keylol.com/plugin.php?id=steamcn_lottery:view&amp;lottery_id=43&quot;,</span><br><span class="line">      onload: function (response) &#123;</span><br><span class="line">        if (response.status == 200) &#123;</span><br><span class="line">          let m = response.responseText.match(</span><br><span class="line">            /plugin\.php\?id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=(.+)&amp;roll/</span><br><span class="line">          );</span><br><span class="line">          let hash = m ? m[1] : null;</span><br><span class="line">          console.log(hash);</span><br><span class="line">          if (hash != null) &#123;</span><br><span class="line">            roll(hash);</span><br><span class="line">            roll(hash);</span><br><span class="line">            roll(hash);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            disableS3();</span><br><span class="line">            saveCFG();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          console.error(&quot;出错&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><ul><li><p>这个函数使用了<code>GM_xmlhttpRequest</code>，这个东西是一个网络请求器，深入了解可以参考<a href="https://www.tampermonkey.net/documentation.php?ext=dhdg#GM_xmlhttpRequest">官方文档（英语）</a>，<code>GM_xmlhttpRequest</code>类似于<code>xmlHttpRequest</code>，两者用法几乎一样，只是<code>GM_xmlhttpRequest</code>不存在<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">跨域</a>的问题</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要先在元信息里申明，才可以使用</span></span><br><span class="line"><span class="comment">// @grant        GM_xmlhttpRequest</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>简单的用法如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">GM_xmlhttpRequest</span>(&#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//请求方法，可以是 GET POST HEAD 等</span></span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//请求路径，简单的说就是url</span></span><br><span class="line">  <span class="attr">onload</span>: <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//请求被响应时执行，response是接受到的响应的对象</span></span><br><span class="line">    <span class="comment">//response.status，获取响应代码（200代表请求成功,4xx和5xx代表请求出错）</span></span><br><span class="line">    <span class="comment">//response.responseText，获取响应文本，本例中获取到的是HTML文本</span></span><br><span class="line">    <span class="comment">//response.responseXML，获取XML格式的响应文本</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p></li><li><p>看到<code>onload</code>的回调函数部分</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">onload</span>: <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (response.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> m = response.<span class="property">responseText</span>.<span class="title function_">match</span>(</span><br><span class="line">      <span class="regexp">/plugin\.php\?id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=(.+)&amp;roll/</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">let</span> hash = m ? m[<span class="number">1</span>] : <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(hash);</span><br><span class="line">    <span class="keyword">if</span> (hash != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">roll</span>(hash);</span><br><span class="line">      <span class="title function_">roll</span>(hash);</span><br><span class="line">      <span class="title function_">roll</span>(hash);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">disableS3</span>();</span><br><span class="line">      <span class="title function_">saveCFG</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;出错&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>首先判断状态码是不是 200（代表请求成功），请求成功才会处理响应的内容</p><p>可以在浏览器中打开<a href="https://keylol.com/plugin.php?id=steamcn_lottery:view&lottery_id=43">链接</a>，用开发者工具模拟一下处理过程</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2994115059.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2994115059.png" alt="网络请求的响应内容"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2994115059.png">网络请求的响应内容</a></p><p>我们把响应的内容当做纯文本处理，使用正则表达式提取想要的内容</p><blockquote><p>正则表达式深入学习可以参考这个：<a href="https://www.runoob.com/regexp/regexp-syntax.html">正则表达式 - 语法</a></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  a.<span class="title function_">match</span>(</span><br><span class="line">    <span class="regexp">/plugin\.php\?id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=(.+)&amp;roll/</span></span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>简单的讲一下上面的正则表达式是什么意思</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/plugin\.<span class="property">php</span>\?id=<span class="attr">steamcn_lottery</span>:view&amp;lottery_id=<span class="number">43</span>&amp;hash=(.+)&amp;roll/;</span><br><span class="line"><span class="comment">// 两边的 / 就是告诉解释器里面是正则表达式，没别的意思</span></span><br><span class="line"><span class="comment">// 按照不同元素拆分，如下：</span></span><br><span class="line"><span class="comment">// plugin   - 匹配“plugin”这个字符串</span></span><br><span class="line"><span class="comment">// \.       - 匹配“.”，“.”原来有别的意思，在前面加“\”转义以后就只有字面意思了</span></span><br><span class="line"><span class="comment">// id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=   - 匹配一整串字符串</span></span><br><span class="line"><span class="comment">// (.+)     - “()”是子匹配的意思，“.+”意思是匹配至少一个字符</span></span><br><span class="line"><span class="comment">//          - “(.+)”的意思是不仅要匹配至少一个字符，而且匹配到的文本需要返回</span></span><br><span class="line"><span class="comment">// &amp;roll    - 匹配“&amp;roll”这个字符串</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>简单点说就是先找到<code>plugin.php?id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=[XXXXXXX]&amp;roll</code>这一串字符串，然后提取中间的<code>XXXXXXX</code></p><p>执行效果如下，可以看到返回了一个数组，第一个元素是匹配到的字符串，第二个元素是子匹配项，我们只需要子匹配项，也就是<code>8b51a2d3</code>（这个值不同用户是不一样的，所以需要动态获取）</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/574796692.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/574796692.png" alt="查看网络请求"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/574796692.png">查看网络请求</a></p><p>然后就是赋值操作，用到了三目运算符号</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> hash = m ? m[<span class="number">1</span>] : <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// D = A ? B : C</span></span><br><span class="line"><span class="comment">// 等价于：</span></span><br><span class="line"><span class="keyword">if</span> (A) &#123;</span><br><span class="line">  D = B;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  D = C;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当A的逻辑意义为true时，返回值为B</span></span><br><span class="line"><span class="comment">// 当A的逻辑意义为false时，返回值为C</span></span><br><span class="line"><span class="comment">// 类似这样</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="literal">true</span> ? <span class="number">1</span> : <span class="number">2</span>; <span class="comment">// a = 1</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="literal">false</span> ? <span class="number">1</span> : <span class="number">2</span>; <span class="comment">// a = 2</span></span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>如果正则表达式没有匹配到合适的字符串，返回的内容是<code>null</code>，逻辑意义等于<code>false</code>，这时候<code>hash</code>的值就取<code>null</code></p><p>如果正则表达式匹配到了合适的字符串，返回的内容是数组，逻辑意义等于<code>true</code>，这时候<code>hash</code>的值就取数组的第 2 个元素</p><p>然后根据<code>hash</code>决定是不是要继续运行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (hash != <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="title function_">roll</span>(hash);</span><br><span class="line">  <span class="title function_">roll</span>(hash);</span><br><span class="line">  <span class="title function_">roll</span>(hash);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_">disableS3</span>();</span><br><span class="line">  <span class="title function_">saveCFG</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p></li></ul></li><li><p>最后是<code>roll</code>函数，核心也是一个网络请求器</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">roll</span>(<span class="params">hash</span>) &#123;</span><br><span class="line">  <span class="title function_">GM_xmlhttpRequest</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:</span><br><span class="line">      <span class="string">&quot;https://keylol.com/plugin.php?id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=&quot;</span> +</span><br><span class="line">      hash +</span><br><span class="line">      <span class="string">&quot;&amp;roll&quot;</span>,</span><br><span class="line">    <span class="attr">onload</span>: <span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">responseText</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;出错&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (++v == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="title function_">disableS3</span>();</span><br><span class="line">        <span class="title function_">saveCFG</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>JavaScript</strong></p><p><em>复制</em></p><p>实际上就是访问<code>https://keylol.com/plugin.php?id=steamcn_lottery:view&amp;lottery_id=43&amp;hash=[XXXXXXX]&amp;roll</code>这个网站，然后把响应结果打印出来</p><p>可以根据上一步得到的<code>hash</code>在浏览器中试一下</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1280820846.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/1280820846.png" alt="参与轮盘"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/1280820846.png">参与轮盘</a></p><p>调用以后，会自增<code>v</code>，如果<code>v = 3</code>，就调用<code>disableS3</code>和<code>saveCFG</code>，修改了按钮的名称，然后保存全局变量</p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2573466154.png"><img src="https://blog.chrxw.com/usr/uploads/2021/02/2573466154.png" alt="执行效果"></a></p><p><a href="https://blog.chrxw.com/usr/uploads/2021/02/2573466154.png">执行效果</a></p></li></ul><hr><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><blockquote><p>本文链接：<a href="https://blog.chrxw.com/archives/2021/02/08/1449.html">https://blog.chrxw.com/archives/2021/02/08/1449.html</a></p><p>转载请保留本文链接，谢谢</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tampermonkey </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript快速上手</title>
      <link href="/posts/be7e4946.html"/>
      <url>/posts/be7e4946.html</url>
      
        <content type="html"><![CDATA[<h1 id="一、初识-TypeScript"><a href="#一、初识-TypeScript" class="headerlink" title="一、初识 TypeScript"></a>一、初识 TypeScript</h1><h2 id="1-1-初识-TypeScript"><a href="#1-1-初识-TypeScript" class="headerlink" title="1.1. 初识 TypeScript"></a>1.1. 初识 TypeScript</h2><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28ca61cc160c417c8497a00defdca5f0~tplv-k3u1fbpfcp-watermark.image" alt="TS与JS.png"></p><h3 id="TypeScript-的介绍"><a href="#TypeScript-的介绍" class="headerlink" title="TypeScript 的介绍"></a>TypeScript 的介绍</h3><p>TypeScript 是一种由微软开发的开源、跨平台的编程语言。它是 JavaScript 的超集，最终会被编译为 JavaScript 代码。<br>2012 年 10 月，微软发布了首个公开版本的 TypeScript，2013 年 6 月 19 日，在经历了一个预览版之后微软正式发布了正式版 TypeScript<br>TypeScript 的作者是安德斯·海尔斯伯格，C#的首席架构师。它是开源和跨平台的编程语言。<br>TypeScript 扩展了 JavaScript 的语法，所以任何现有的 JavaScript 程序可以运行在 TypeScript 环境中。<br>TypeScript 是为大型应用的开发而设计，并且可以编译为 JavaScript。<br><strong>TypeScript 是 JavaScript 的一个超集</strong>，主要提供了<strong>类型系统</strong>和<strong>对 ES6+ 的支持</strong>，它由 Microsoft 开发，代码<a href="https://github.com/Microsoft/TypeScript">开源于 GitHub (opens new window)</a>上</p><h3 id="TypeScript-的特点"><a href="#TypeScript-的特点" class="headerlink" title="TypeScript 的特点"></a>TypeScript 的特点</h3><p>TypeScript 主要有 3 大特点：</p><ul><li><p><strong>始于 JavaScript，归于 JavaScript</strong></p><p>TypeScript 可以编译出纯净、 简洁的 JavaScript 代码，并且可以运行在任何浏览器上、Node.js 环境中和任何支持 ECMAScript 3（或更高版本）的 JavaScript 引擎中。</p></li><li><p><strong>强大的类型系统</strong></p><p>类型系统允许 JavaScript 开发者在开发 JavaScript 应用程序时使用高效的开发工具和常用操作比如静态检查和代码重构。</p></li><li><p><strong>先进的 JavaScript</strong></p><p>TypeScript 提供最新的和不断发展的 JavaScript 特性，包括那些来自 2015 年的 ECMAScript 和未来的提案中的特性，比如异步功能和 Decorators，以帮助建立健壮的组件。</p></li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>TypeScript 在社区的流行度越来越高，它非常适用于一些大型项目，也非常适用于一些基础库，极大地帮助我们提升了开发效率和体验。</p><h2 id="1-2-安装-TypeScript"><a href="#1-2-安装-TypeScript" class="headerlink" title="1.2. 安装 TypeScript"></a>1.2. 安装 TypeScript</h2><p>命令行运行如下命令，全局安装 TypeScript：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g typescript</span><br></pre></td></tr></table></figure><p>安装完成后，在控制台运行如下命令，检查安装是否成功(3.x)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc -V</span><br></pre></td></tr></table></figure><h2 id="1-3-第一个-TypeScript-程序"><a href="#1-3-第一个-TypeScript-程序" class="headerlink" title="1.3. 第一个 TypeScript 程序"></a>1.3. 第一个 TypeScript 程序</h2><h3 id="编写-TS-程序"><a href="#编写-TS-程序" class="headerlink" title="编写 TS 程序"></a>编写 TS 程序</h3><p>src/helloworld.ts</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greeter</span>(<span class="params">person</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="string">&quot;Yee&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">greeter</span>(user));</span><br></pre></td></tr></table></figure><h3 id="手动编译代码"><a href="#手动编译代码" class="headerlink" title="手动编译代码"></a>手动编译代码</h3><p>我们使用了 <code>.ts</code> 扩展名，但是这段代码仅仅是 JavaScript 而已。</p><p>在命令行上，运行 TypeScript 编译器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc helloworld.ts</span><br></pre></td></tr></table></figure><p>输出结果为一个 <code>helloworld.js</code> 文件，它包含了和输入文件中相同的 JavsScript 代码。</p><p>在命令行上，通过 Node.js 运行这段代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node helloworld.js</span><br></pre></td></tr></table></figure><p>控制台输出：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, Yee</span><br></pre></td></tr></table></figure><h3 id="vscode-自动编译"><a href="#vscode-自动编译" class="headerlink" title="vscode 自动编译"></a>vscode 自动编译</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1). 生成配置文件tsconfig.json</span><br><span class="line">    tsc --init</span><br><span class="line">2). 修改tsconfig.json配置</span><br><span class="line">    &quot;outDir&quot;: &quot;./js&quot;,</span><br><span class="line">    &quot;strict&quot;: false,</span><br><span class="line">3). 启动监视任务:</span><br><span class="line">    终端 -&gt; 运行任务 -&gt; 监视tsconfig.json</span><br></pre></td></tr></table></figure><h3 id="类型注解"><a href="#类型注解" class="headerlink" title="类型注解"></a>类型注解</h3><p>接下来让我们看看 TypeScript 工具带来的高级功能。 给 <code>person</code> 函数的参数添加 <code>: string</code> 类型注解，如下：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greeter</span>(<span class="params">person: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="string">&quot;Yee&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">greeter</span>(user));</span><br></pre></td></tr></table></figure><p>TypeScript 里的类型注解是一种轻量级的为函数或变量添加约束的方式。 在这个例子里，我们希望 <code>greeter</code> 函数接收一个字符串参数。 然后尝试把 <code>greeter</code> 的调用改成传入一个数组：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greeter</span>(<span class="params">person: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">greeter</span>(user));</span><br></pre></td></tr></table></figure><p>重新编译，你会看到产生了一个错误：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error TS2345: Argument of type &#x27;number[]&#x27; is not assignable to parameter of type &#x27;string&#x27;.</span><br></pre></td></tr></table></figure><p>类似地，尝试删除 <code>greeter</code> 调用的所有参数。 TypeScript 会告诉你使用了非期望个数的参数调用了这个函数。 在这两种情况中，TypeScript 提供了静态的代码分析，它可以分析代码结构和提供的类型注解。</p><p>要注意的是尽管有错误，<code>greeter.js</code> 文件还是被创建了。 就算你的代码里有错误，你仍然可以使用 TypeScript。但在这种情况下，TypeScript 会警告你代码可能不会按预期执行。</p><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>让我们继续扩展这个示例应用。这里我们使用接口来描述一个拥有 <code>firstName</code> 和 <code>lastName</code> 字段的对象。 在 <code>TypeScript</code> 里，只在两个类型内部的结构兼容，那么这两个类型就是兼容的。 这就允许我们在实现接口时候只要保证包含了接口要求的结构就可以，而不必明确地使用 <code>implements</code> 语句。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">lastName</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">greeter</span>(<span class="params">person: Person</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + person.<span class="property">firstName</span> + <span class="string">&quot; &quot;</span> + person.<span class="property">lastName</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="string">&quot;Yee&quot;</span>,</span><br><span class="line">  <span class="attr">lastName</span>: <span class="string">&quot;Huang&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">greeter</span>(user));</span><br></pre></td></tr></table></figure><h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><p>最后，让我们使用类来改写这个例子。 TypeScript 支持 JavaScript 的新特性，比如支持基于类的面向对象编程。</p><p>让我们创建一个 <code>User</code> 类，它带有一个构造函数和一些公共字段。因为类的字段包含了接口所需要的字段，所以他们能很好的兼容。</p><p>还要注意的是，我在类的声明上会注明所有的成员变量，这样比较一目了然。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">fullName</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">lastName</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">firstName: <span class="built_in">string</span>, lastName: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">firstName</span> = firstName;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lastName</span> = lastName;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fullName</span> = firstName + <span class="string">&quot; &quot;</span> + lastName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">lastName</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">greeter</span>(<span class="params">person: Person</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + person.<span class="property">firstName</span> + <span class="string">&quot; &quot;</span> + person.<span class="property">lastName</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Yee&quot;</span>, <span class="string">&quot;Huang&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">greeter</span>(user));</span><br></pre></td></tr></table></figure><p>重新运行 <code>tsc greeter.ts</code>，你会看到 TypeScript 里的类只是一个语法糖，本质上还是 <code>JavaScript</code> 函数的实现。</p><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>到这里，你已经对 TypeScript 有了一个大致的印象，那么下一章让我们来一起学习 TypeScript 的一些常用语法吧。</p><h2 id="1-4-使用-webpack-打包-TS"><a href="#1-4-使用-webpack-打包-TS" class="headerlink" title="1.4. 使用 webpack 打包 TS"></a>1.4. 使用 webpack 打包 TS</h2><h3 id="下载依赖"><a href="#下载依赖" class="headerlink" title="下载依赖"></a>下载依赖</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D typescript</span><br><span class="line">yarn add -D webpack webpack-cli</span><br><span class="line">yarn add -D webpack-dev-server</span><br><span class="line">yarn add -D html-webpack-plugin clean-webpack-plugin</span><br><span class="line">yarn add -D ts-loader</span><br><span class="line">yarn add -D cross-env</span><br></pre></td></tr></table></figure><h3 id="入口-JS-src-main-ts"><a href="#入口-JS-src-main-ts" class="headerlink" title="入口 JS: src/main.ts"></a>入口 JS: src/main.ts</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import &#x27;./01_helloworld&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;Hello Webpack TS!&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="index-页面-public-index-html"><a href="#index-页面-public-index-html" class="headerlink" title="index 页面: public/index.html"></a>index 页面: public/index.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack &amp; TS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="build-webpack-config-js"><a href="#build-webpack-config-js" class="headerlink" title="build/webpack.config.js"></a>build/webpack.config.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProd = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>; <span class="comment">// 是否生产环境</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;..&quot;</span>, dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: isProd ? <span class="string">&quot;production&quot;</span> : <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&quot;./src/main.ts&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].[contenthash:8].js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">        <span class="attr">include</span>: [<span class="title function_">resolve</span>(<span class="string">&quot;src&quot;</span>)],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(&#123;&#125;),</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.tsx&quot;</span>, <span class="string">&quot;.js&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">devtool</span>: isProd ? <span class="string">&quot;cheap-module-source-map&quot;</span> : <span class="string">&quot;cheap-module-eval-source-map&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 主机名</span></span><br><span class="line">    <span class="attr">stats</span>: <span class="string">&quot;errors-only&quot;</span>, <span class="comment">// 打包日志输出输出错误信息</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">8081</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="配置打包命令"><a href="#配置打包命令" class="headerlink" title="配置打包命令"></a>配置打包命令</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;cross-env NODE_ENV=development webpack-dev-server --config build/webpack.config.js&quot;,</span><br><span class="line">&quot;build&quot;: &quot;cross-env NODE_ENV=production webpack --config build/webpack.config.js&quot;</span><br></pre></td></tr></table></figure><h3 id="运行与打包"><a href="#运行与打包" class="headerlink" title="运行与打包"></a>运行与打包</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn dev</span><br><span class="line">yarn build</span><br></pre></td></tr></table></figure><h1 id="二、TypeScript-常用语法"><a href="#二、TypeScript-常用语法" class="headerlink" title="二、TypeScript 常用语法"></a>二、TypeScript 常用语法</h1><h2 id="2-1-基础类型"><a href="#2-1-基础类型" class="headerlink" title="2.1. 基础类型"></a>2.1. 基础类型</h2><p>TypeScript 支持与 JavaScript 几乎相同的数据类型，此外还提供了实用的枚举类型方便我们使用。</p><h3 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h3><p>最基本的数据类型就是简单的 true/false 值，在 JavaScript 和 TypeScript 里叫做 <code>boolean</code>（其它语言中也一样）。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">isDone</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line">isDone = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// isDone = 2 // error</span></span><br></pre></td></tr></table></figure><h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><p>和 JavaScript 一样，TypeScript 里的所有数字都是浮点数。 这些浮点数的类型是 number。 除了支持十进制和十六进制字面量，TypeScript 还支持 ECMAScript 2015 中引入的二进制和八进制字面量。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a1</span>: <span class="built_in">number</span> = <span class="number">10</span>; <span class="comment">// 十进制</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a2</span>: <span class="built_in">number</span> = <span class="number">0b1010</span>; <span class="comment">// 二进制</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a3</span>: <span class="built_in">number</span> = <span class="number">0o12</span>; <span class="comment">// 八进制</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a4</span>: <span class="built_in">number</span> = <span class="number">0xa</span>; <span class="comment">// 十六进制</span></span><br></pre></td></tr></table></figure><h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>JavaScript 程序的另一项基本操作是处理网页或服务器端的文本数据。 像其它语言里一样，我们使用 <code>string</code> 表示文本数据类型。 和 JavaScript 一样，可以使用双引号（<code>&quot;</code>）或单引号（<code>&#39;</code>）表示字符串。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&quot;tom&quot;</span>;</span><br><span class="line">name = <span class="string">&quot;jack&quot;</span>;</span><br><span class="line"><span class="comment">// name = 12 // error</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">age</span>: <span class="built_in">number</span> = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">const</span> info = <span class="string">`My name is <span class="subst">$&#123;name&#125;</span>, I am <span class="subst">$&#123;age&#125;</span> years old!`</span>;</span><br></pre></td></tr></table></figure><h3 id="undefined-和-null"><a href="#undefined-和-null" class="headerlink" title="undefined 和 null"></a>undefined 和 null</h3><p>TypeScript 里，<code>undefined</code> 和 <code>null</code> 两者各自有自己的类型分别叫做 <code>undefined</code> 和 <code>null</code>。 它们的本身的类型用处不是很大：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">u</span>: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="literal">null</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>默认情况下 <code>null</code> 和 <code>undefined</code> 是所有类型的子类型。 就是说你可以把 <code>null</code> 和 <code>undefined</code> 赋值给 <code>number</code> 类型的变量。</p><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>TypeScript 像 JavaScript 一样可以操作数组元素。 有两种方式可以定义数组。 第一种，可以在<code>元素类型后面接上[]</code>，表示由此类型元素组成的一个数组：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">list1</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure><p>第二种方式是使用数组泛型，<code>Array&lt;元素类型&gt;</code>：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">list2</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure><h3 id="元组-Tuple"><a href="#元组-Tuple" class="headerlink" title="元组 Tuple"></a>元组 Tuple</h3><p>元组类型允许表示一个已知元素数量和类型的数组，<code>各元素的类型不必相同</code>。 比如，你可以定义一对值分别为 <code>string</code> 和 <code>number</code> 类型的元组。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">t1</span>: [<span class="built_in">string</span>, <span class="built_in">number</span>];</span><br><span class="line">t1 = [<span class="string">&quot;hello&quot;</span>, <span class="number">10</span>]; <span class="comment">// OK</span></span><br><span class="line">t1 = [<span class="number">10</span>, <span class="string">&quot;hello&quot;</span>]; <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>当访问一个已知索引的元素，会得到正确的类型：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(t1[<span class="number">0</span>].<span class="title function_">substring</span>(<span class="number">1</span>)); <span class="comment">// OK</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(t1[<span class="number">1</span>].<span class="title function_">substring</span>(<span class="number">1</span>)); <span class="comment">// Error, &#x27;number&#x27; 不存在 &#x27;substring&#x27; 方法</span></span><br></pre></td></tr></table></figure><h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><p><code>enum</code> 类型是对 JavaScript 标准数据类型的一个补充。 使用枚举类型可以<code>为一组数值赋予友好的名字</code>。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  <span class="title class_">Red</span>,</span><br><span class="line">  <span class="title class_">Green</span>,</span><br><span class="line">  <span class="title class_">Blue</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举数值默认从0开始依次递增</span></span><br><span class="line"><span class="comment">// 根据特定的名称得到对应的枚举数值</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myColor</span>: <span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">Green</span>; <span class="comment">// 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myColor, <span class="title class_">Color</span>.<span class="property">Red</span>, <span class="title class_">Color</span>.<span class="property">Blue</span>);</span><br></pre></td></tr></table></figure><p>默认情况下，从 <code>0</code> 开始为元素编号。 你也可以手动的指定成员的数值。 例如，我们将上面的例子改成从 <code>1</code> 开始编号：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  <span class="title class_">Red</span> = <span class="number">1</span>,</span><br><span class="line">  <span class="title class_">Green</span>,</span><br><span class="line">  <span class="title class_">Blue</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: <span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">Green</span>;</span><br></pre></td></tr></table></figure><p>或者，全部都采用手动赋值：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  <span class="title class_">Red</span> = <span class="number">1</span>,</span><br><span class="line">  <span class="title class_">Green</span> = <span class="number">2</span>,</span><br><span class="line">  <span class="title class_">Blue</span> = <span class="number">4</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: <span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">Green</span>;</span><br></pre></td></tr></table></figure><p>枚举类型提供的一个便利是你可以由枚举的值得到它的名字。 例如，我们知道数值为 2，但是不确定它映射到 Color 里的哪个名字，我们可以查找相应的名字：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  <span class="title class_">Red</span> = <span class="number">1</span>,</span><br><span class="line">  <span class="title class_">Green</span>,</span><br><span class="line">  <span class="title class_">Blue</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">colorName</span>: <span class="built_in">string</span> = <span class="title class_">Color</span>[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(colorName); <span class="comment">// &#x27;Green&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="any"><a href="#any" class="headerlink" title="any"></a>any</h3><p>有时候，我们会想要为那些在编程阶段还不清楚类型的变量指定一个类型。 这些值可能来自于动态的内容，比如来自用户输入或第三方代码库。 这种情况下，我们不希望类型检查器对这些值进行检查而是直接让它们通过编译阶段的检查。 那么我们可以使用 <code>any</code> 类型来标记这些变量：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">notSure</span>: <span class="built_in">any</span> = <span class="number">4</span>;</span><br><span class="line">notSure = <span class="string">&quot;maybe a string&quot;</span>;</span><br><span class="line">notSure = <span class="literal">false</span>; <span class="comment">// 也可以是个 boolean</span></span><br></pre></td></tr></table></figure><p>在对现有代码进行改写的时候，<code>any</code> 类型是十分有用的，它允许你在编译时可选择地包含或移除类型检查。并且当你只知道一部分数据的类型时，<code>any</code> 类型也是有用的。 比如，你有一个数组，它包含了不同的类型的数据：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">list</span>: <span class="built_in">any</span>[] = [<span class="number">1</span>, <span class="literal">true</span>, <span class="string">&quot;free&quot;</span>];</span><br><span class="line"></span><br><span class="line">list[<span class="number">1</span>] = <span class="number">100</span>;</span><br></pre></td></tr></table></figure><h3 id="void"><a href="#void" class="headerlink" title="void"></a>void</h3><p>某种程度上来说，<code>void</code> 类型像是与 <code>any</code> 类型相反，它<code>表示没有任何类型</code>。 当一个函数没有返回值时，你通常会见到其返回值类型是 <code>void</code>：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 表示没有任何类型, 一般用来说明函数的返回值不能是undefined和null之外的值 */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn()&quot;</span>);</span><br><span class="line">  <span class="comment">// return undefined</span></span><br><span class="line">  <span class="comment">// return null</span></span><br><span class="line">  <span class="comment">// return 1 // error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>声明一个 <code>void</code> 类型的变量没有什么大用，因为你只能为它赋予 <code>undefined</code> 和 <code>null</code>：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">unusable</span>: <span class="built_in">void</span> = <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><h3 id="object"><a href="#object" class="headerlink" title="object"></a>object</h3><p><code>object</code> 表示非原始类型，也就是除 <code>number</code>，<code>string</code>，<code>boolean</code>之外的类型。</p><p>使用 <code>object</code> 类型，就可以更好的表示像 <code>Object.create</code> 这样的 <code>API</code>。例如：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params">obj: <span class="built_in">object</span></span>): <span class="built_in">object</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn2()&quot;</span>, obj);</span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  <span class="comment">// return undefined</span></span><br><span class="line">  <span class="comment">// return null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fn2</span>(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>)));</span><br><span class="line"><span class="comment">// console.log(fn2(&#x27;abc&#x27;) // error</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fn2</span>(<span class="title class_">String</span>));</span><br></pre></td></tr></table></figure><h3 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h3><p>联合类型（Union Types）表示取值可以为多种类型中的一种<br>需求 1: 定义一个一个函数得到一个数字或字符串值的字符串形式值</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toString2</span>(<span class="params">x: <span class="built_in">number</span> | <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x.<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需求 2: 定义一个一个函数得到一个数字或字符串值的长度</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params">x: <span class="built_in">number</span> | <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="comment">// return x.length // error</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (x.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">    <span class="keyword">return</span> x.<span class="property">length</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x.<span class="title function_">toString</span>().<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h3><p>通过类型断言这种方式可以告诉编译器，“相信我，我知道自己在干什么”。 类型断言好比其它语言里的类型转换，但是不进行特殊的数据检查和解构。 它没有运行时的影响，只是在编译阶段起作用。 TypeScript 会假设你，程序员，已经进行了必须的检查。</p><p>类型断言有两种形式。 其一是“尖括号”语法, 另一个为 <code>as</code> 语法</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">类型断言(Type Assertion): 可以用来手动指定一个值的类型</span></span><br><span class="line"><span class="comment">语法:</span></span><br><span class="line"><span class="comment">    方式一: &lt;类型&gt;值</span></span><br><span class="line"><span class="comment">    方式二: 值 as 类型  tsx中只能用这种方式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 需求: 定义一个函数得到一个字符串或者数值数据的长度 */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params">x: <span class="built_in">number</span> | <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> ((&lt;<span class="built_in">string</span>&gt;x).<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (x <span class="keyword">as</span> <span class="built_in">string</span>).<span class="property">length</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x.<span class="title function_">toString</span>().<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getLength</span>(<span class="string">&quot;abcd&quot;</span>), <span class="title function_">getLength</span>(<span class="number">1234</span>));</span><br></pre></td></tr></table></figure><h3 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h3><p>类型推断: TS 会在没有明确的指定类型的时候推测出一个类型<br>有下面 2 种情况: 1. 定义变量时赋值了, 推断为对应的类型. 2. 定义变量时没有赋值, 推断为 any 类型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 定义变量时赋值了, 推断为对应的类型 */</span></span><br><span class="line"><span class="keyword">let</span> b9 = <span class="number">123</span>; <span class="comment">// number</span></span><br><span class="line"><span class="comment">// b9 = &#x27;abc&#x27; // error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义变量时没有赋值, 推断为any类型 */</span></span><br><span class="line"><span class="keyword">let</span> b10; <span class="comment">// any类型</span></span><br><span class="line">b10 = <span class="number">123</span>;</span><br><span class="line">b10 = <span class="string">&quot;abc&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="2-2-接口"><a href="#2-2-接口" class="headerlink" title="2.2. 接口"></a>2.2. 接口</h2><p>TypeScript 的核心原则之一是对值所具有的结构进行类型检查。我们使用接口（Interfaces）来定义对象的类型。<code>接口是对象的状态(属性)和行为(方法)的抽象(描述)</code></p><h3 id="接口初探"><a href="#接口初探" class="headerlink" title="接口初探"></a>接口初探</h3><p>需求: 创建人的对象, 需要对人的属性进行一定的约束</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id是number类型, 必须有, 只读的</span><br><span class="line">name是string类型, 必须有</span><br><span class="line">age是number类型, 必须有</span><br><span class="line">sex是string类型, 可以没有</span><br></pre></td></tr></table></figure><p>下面通过一个简单示例来观察接口是如何工作的：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">在 TypeScript 中，我们使用接口（Interfaces）来定义对象的类型</span></span><br><span class="line"><span class="comment">接口: 是对象的状态(属性)和行为(方法)的抽象(描述)</span></span><br><span class="line"><span class="comment">接口类型的对象</span></span><br><span class="line"><span class="comment">    多了或者少了属性是不允许的</span></span><br><span class="line"><span class="comment">    可选属性: ?</span></span><br><span class="line"><span class="comment">    只读属性: readonly</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">需求: 创建人的对象, 需要对人的属性进行一定的约束</span></span><br><span class="line"><span class="comment">  id是number类型, 必须有, 只读的</span></span><br><span class="line"><span class="comment">  name是string类型, 必须有</span></span><br><span class="line"><span class="comment">  age是number类型, 必须有</span></span><br><span class="line"><span class="comment">  sex是string类型, 可以没有</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义人的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">sex</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">person1</span>: <span class="title class_">IPerson</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>类型检查器会查看对象内部的属性是否与 IPerson 接口描述一致, 如果不一致就会提示类型错误。</p><h3 id="可选属性"><a href="#可选属性" class="headerlink" title="可选属性"></a>可选属性</h3><p>接口里的属性不全都是必需的。 有些是只在某些条件下存在，或者根本不存在。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  sex?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>带有可选属性的接口与普通的接口定义差不多，只是在可选属性名字定义的后面加一个 <code>?</code> 符号。</p><p>可选属性的好处之一是可以对可能存在的属性进行预定义，好处之二是可以捕获引用了不存在的属性时的错误。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">person2</span>: <span class="title class_">IPerson</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="comment">// sex: &#x27;男&#x27; // 可以没有</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="只读属性"><a href="#只读属性" class="headerlink" title="只读属性"></a>只读属性</h3><p>一些对象属性只能在对象刚刚创建的时候修改其值。 你可以在属性名前用 <code>readonly</code> 来指定只读属性:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IPerson</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  sex?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一旦赋值后再也不能被改变了。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">person2</span>: <span class="title class_">IPerson</span> = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="comment">// sex: &#x27;男&#x27; // 可以没有</span></span><br><span class="line">  <span class="comment">// xxx: 12 // error 没有在接口中定义, 不能有</span></span><br><span class="line">&#125;;</span><br><span class="line">person2.<span class="property">id</span> = <span class="number">2</span>; <span class="comment">// error</span></span><br></pre></td></tr></table></figure><ul><li><strong>readonly vs const</strong></li></ul><p>最简单判断该用 <code>readonly</code> 还是 <code>const</code> 的方法是看要把它做为变量使用还是做为一个属性。 做为变量使用的话用 <code>const</code>，若做为属性则使用 <code>readonly</code>。</p><h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><p>接口能够描述 JavaScript 中对象拥有的各种各样的外形。 除了描述带有属性的普通对象外，接口也可以描述函数类型。</p><p>为了使用接口表示函数类型，我们需要给接口定义一个调用签名。它就像是一个只有参数列表和返回值类型的函数定义。参数列表里的每个参数都需要名字和类型。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">接口可以描述函数类型(参数的类型与返回的类型)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">SearchFunc</span> &#123;</span><br><span class="line">  (<span class="attr">source</span>: <span class="built_in">string</span>, <span class="attr">subString</span>: <span class="built_in">string</span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样定义后，我们可以像使用其它接口一样使用这个函数类型的接口。 下例展示了如何创建一个函数类型的变量，并将一个同类型的函数赋值给这个变量。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">mySearch</span>: <span class="title class_">SearchFunc</span> = <span class="keyword">function</span> (<span class="params">source: <span class="built_in">string</span>, sub: <span class="built_in">string</span></span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> source.<span class="title function_">search</span>(sub) &gt; -<span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">mySearch</span>(<span class="string">&quot;abcd&quot;</span>, <span class="string">&quot;bc&quot;</span>));</span><br></pre></td></tr></table></figure><h3 id="类类型"><a href="#类类型" class="headerlink" title="类类型"></a>类类型</h3><p><strong>类实现接口</strong></p><p>与 C# 或 Java 里接口的基本作用一样，TypeScript 也能够用它来明确的强制一个类去符合某种契约。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">类类型: 实现接口</span></span><br><span class="line"><span class="comment">1. 一个类可以实现多个接口</span></span><br><span class="line"><span class="comment">2. 一个接口可以继承多个接口</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(): <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Light</span> &#123;</span><br><span class="line">  <span class="title function_">lightOn</span>(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">lightOff</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Car alert&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="一个类可以实现多个接口"><a href="#一个类可以实现多个接口" class="headerlink" title="一个类可以实现多个接口"></a>一个类可以实现多个接口</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car2</span> <span class="keyword">implements</span> <span class="title class_">Alarm</span>, <span class="title class_">Light</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Car alert&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">lightOn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Car light on&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">lightOff</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Car light off&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="接口继承接口"><a href="#接口继承接口" class="headerlink" title="接口继承接口"></a>接口继承接口</h3><p>和类一样，接口也可以相互继承。 这让我们能够从一个接口里复制成员到另一个接口里，可以更灵活地将接口分割到可重用的模块里。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">LightableAlarm</span> <span class="keyword">extends</span> <span class="title class_">Alarm</span>, <span class="title class_">Light</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-类"><a href="#2-3-类" class="headerlink" title="2.3. 类"></a>2.3. 类</h2><p>对于传统的 JavaScript 程序我们会使用<code>函数</code>和<code>基于原型的继承</code>来创建可重用的组件，但对于熟悉使用面向对象方式的程序员使用这些语法就有些棘手，因为他们用的是<code>基于类的继承</code>并且对象是由类构建出来的。 从 ECMAScript 2015，也就是 ES6 开始， JavaScript 程序员将能够使用基于类的面向对象的方式。 使用 TypeScript，我们允许开发者现在就使用这些特性，并且编译后的 JavaScript 可以在所有主流浏览器和平台上运行，而不需要等到下个 JavaScript 版本。</p><h3 id="基本示例"><a href="#基本示例" class="headerlink" title="基本示例"></a>基本示例</h3><p>下面看一个使用类的例子：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">类的基本定义与使用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Greeter</span> &#123;</span><br><span class="line">  <span class="comment">// 声明属性</span></span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 构造方法</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">message: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">message</span> = message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一般方法</span></span><br><span class="line">  <span class="title function_">greet</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + <span class="variable language_">this</span>.<span class="property">message</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建类的实例</span></span><br><span class="line"><span class="keyword">const</span> greeter = <span class="keyword">new</span> <span class="title class_">Greeter</span>(<span class="string">&quot;world&quot;</span>);</span><br><span class="line"><span class="comment">// 调用实例的方法</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(greeter.<span class="title function_">greet</span>());</span><br></pre></td></tr></table></figure><p>如果你使用过 C# 或 Java，你会对这种语法非常熟悉。 我们声明一个 <code>Greeter</code> 类。这个类有 3 个成员：一个叫做 <code>message</code> 的属性，一个构造函数和一个 <code>greet</code> 方法。</p><p>你会注意到，我们在引用任何一个类成员的时候都用了 <code>this</code>。 它表示我们访问的是类的成员。</p><p>后面一行，我们使用 <code>new</code> 构造了 <code>Greeter</code> 类的一个实例。它会调用之前定义的构造函数，创建一个 <code>Greeter</code> 类型的新对象，并执行构造函数初始化它。</p><p>最后一行通过 <code>greeter</code> 对象调用其 <code>greet</code> 方法</p><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>在 TypeScript 里，我们可以使用常用的面向对象模式。 基于类的程序设计中一种最基本的模式是允许使用继承来扩展现有的类。</p><p>看下面的例子：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">类的继承</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">run</span>(<span class="params">distance: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Animal run <span class="subst">$&#123;distance&#125;</span>m`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">cry</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;wang! wang!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">dog.<span class="title function_">cry</span>();</span><br><span class="line">dog.<span class="title function_">run</span>(<span class="number">100</span>); <span class="comment">// 可以调用从父中继承得到的方法</span></span><br></pre></td></tr></table></figure><p>这个例子展示了最基本的继承：类从基类中继承了属性和方法。 这里，<code>Dog</code> 是一个 派生类，它派生自 <code>Animal</code> 基类，通过 <code>extends</code> 关键字。 派生类通常被称作<em>子类</em>，基类通常被称作<em>超类</em>。</p><p>因为 <code>Dog</code> 继承了 <code>Animal</code> 的功能，因此我们可以创建一个 <code>Dog</code> 的实例，它能够 <code>cry()</code> 和 <code>run()</code>。</p><p>下面我们来看个更加复杂的例子。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(<span class="params">distance: <span class="built_in">number</span> = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> run <span class="subst">$&#123;distance&#125;</span>m`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 调用父类型构造方法</span></span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重写父类型的方法</span></span><br><span class="line">  <span class="title function_">run</span>(<span class="params">distance: <span class="built_in">number</span> = <span class="number">5</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sliding...&quot;</span>);</span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">run</span>(distance);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Horse</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 调用父类型构造方法</span></span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重写父类型的方法</span></span><br><span class="line">  <span class="title function_">run</span>(<span class="params">distance: <span class="built_in">number</span> = <span class="number">50</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dashing...&quot;</span>);</span><br><span class="line">    <span class="comment">// 调用父类型的一般方法</span></span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">run</span>(distance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">xxx</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;xxx()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> snake = <span class="keyword">new</span> <span class="title class_">Snake</span>(<span class="string">&quot;sn&quot;</span>);</span><br><span class="line">snake.<span class="title function_">run</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> horse = <span class="keyword">new</span> <span class="title class_">Horse</span>(<span class="string">&quot;ho&quot;</span>);</span><br><span class="line">horse.<span class="title function_">run</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父类型引用指向子类型的实例 ==&gt; 多态</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">tom</span>: <span class="title class_">Animal</span> = <span class="keyword">new</span> <span class="title class_">Horse</span>(<span class="string">&quot;ho22&quot;</span>);</span><br><span class="line">tom.<span class="title function_">run</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 如果子类型没有扩展的方法, 可以让子类型引用指向父类型的实例 */</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">tom3</span>: <span class="title class_">Snake</span> = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;tom3&quot;</span>);</span><br><span class="line">tom3.<span class="title function_">run</span>();</span><br><span class="line"><span class="comment">/* 如果子类型有扩展的方法, 不能让子类型引用指向父类型的实例 */</span></span><br><span class="line"><span class="comment">// const tom2: Horse = new Animal(&#x27;tom2&#x27;)</span></span><br><span class="line"><span class="comment">// tom2.run()</span></span><br></pre></td></tr></table></figure><p>这个例子展示了一些上面没有提到的特性。 这一次，我们使用 <code>extends</code> 关键字创建了 Animal 的两个子类：<code>Horse</code> 和 <code>Snake</code>。</p><p>与前一个例子的不同点是，派生类包含了一个构造函数，它 必须调用 <code>super()</code>，它会执行基类的构造函数。 而且，在构造函数里访问 <code>this</code> 的属性之前，我们 一定要调用 <code>super()</code>。 这个是 TypeScript 强制执行的一条重要规则。</p><p>这个例子演示了如何在子类里可以重写父类的方法。<code>Snake</code>类和 <code>Horse</code> 类都创建了 <code>run</code> 方法，它们重写了从 <code>Animal</code> 继承来的 <code>run</code> 方法，使得 <code>run</code> 方法根据不同的类而具有不同的功能。注意，即使 <code>tom</code> 被声明为 <code>Animal</code> 类型，但因为它的值是 <code>Horse</code>，调用 <code>tom.run(34)</code> 时，它会调用 <code>Horse</code> 里重写的方法。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sliding...</span><br><span class="line">sn run 5m</span><br><span class="line">dashing...</span><br><span class="line">ho run 50m</span><br></pre></td></tr></table></figure><h3 id="公共，私有与受保护的修饰符"><a href="#公共，私有与受保护的修饰符" class="headerlink" title="公共，私有与受保护的修饰符"></a>公共，私有与受保护的修饰符</h3><p><strong>默认为 public</strong><br>在上面的例子里，我们可以自由的访问程序里定义的成员。 如果你对其它语言中的类比较了解，就会注意到我们在之前的代码里并没有使用 <code>public</code> 来做修饰；例如，C# 要求必须明确地使用 <code>public</code> 指定成员是可见的。 在 TypeScript 里，成员都默认为 <code>public</code>。</p><p>你也可以明确的将一个成员标记成 <code>public</code>。 我们可以用下面的方式来重写上面的 <code>Animal</code> 类：</p><p><strong>理解 private</strong><br>当成员被标记成 <code>private</code> 时，它就不能在声明它的类的外部访问。</p><p><strong>理解 protected</strong><br><code>protected</code> 修饰符与 <code>private</code> 修饰符的行为很相似，但有一点不同，<code>protected</code>成员在派生类中仍然可以访问。例如：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">访问修饰符: 用来描述类内部的属性/方法的可访问性</span></span><br><span class="line"><span class="comment">  public: 默认值, 公开的外部也可以访问</span></span><br><span class="line"><span class="comment">  private: 只能类内部可以访问</span></span><br><span class="line"><span class="comment">  protected: 类内部和子类可以访问</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">run</span>(<span class="params">distance: <span class="built_in">number</span> = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> run <span class="subst">$&#123;distance&#125;</span>m`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">age</span>: <span class="built_in">number</span> = <span class="number">18</span>;</span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">sex</span>: <span class="built_in">string</span> = <span class="string">&quot;男&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(<span class="params">distance: <span class="built_in">number</span> = <span class="number">5</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Person jumping...&quot;</span>);</span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">run</span>(distance);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="title function_">run</span>(<span class="params">distance: <span class="built_in">number</span> = <span class="number">6</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Student jumping...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">sex</span>); <span class="comment">// 子类能看到父类中受保护的成员</span></span><br><span class="line">    <span class="comment">// console.log(this.age) //  子类看不到父类中私有的成员</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">run</span>(distance);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;abc&quot;</span>).<span class="property">name</span>); <span class="comment">// 公开的可见</span></span><br><span class="line"><span class="comment">// console.log(new Person(&#x27;abc&#x27;).sex) // 受保护的不可见</span></span><br><span class="line"><span class="comment">// console.log(new Person(&#x27;abc&#x27;).age) //  私有的不可见</span></span><br></pre></td></tr></table></figure><h3 id="readonly-修饰符"><a href="#readonly-修饰符" class="headerlink" title="readonly 修饰符"></a>readonly 修饰符</h3><p>你可以使用 <code>readonly</code> 关键字将属性设置为只读的。 只读属性必须在声明时或构造函数里被初始化。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> john = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John&quot;</span>);</span><br><span class="line"><span class="comment">// john.name = &#x27;peter&#x27; // error</span></span><br></pre></td></tr></table></figure><p><strong>参数属性</strong></p><p>在上面的例子中，我们必须在 <code>Person</code> 类里定义一个只读成员 <code>name</code> 和一个参数为 <code>name</code> 的构造函数，并且立刻将 <code>name</code> 的值赋给 <code>this.name</code>，这种情况经常会遇到。 参数属性可以方便地让我们在一个地方定义并初始化一个成员。 下面的例子是对之前 <code>Person</code> 类的修改版，使用了参数属性：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person2</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">readonly</span> name: <span class="built_in">string</span></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person2</span>(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>);</span><br></pre></td></tr></table></figure><p>注意看我们是如何舍弃参数 <code>name</code>，仅在构造函数里使用 <code>readonly name: string</code> 参数来创建和初始化 <code>name</code> 成员。 我们把声明和赋值合并至一处。</p><p>参数属性通过给构造函数参数前面添加一个访问限定符来声明。使用 <code>private</code> 限定一个参数属性会声明并初始化一个私有成员；对于 <code>public</code> 和 <code>protected</code> 来说也是一样。</p><h3 id="存取器"><a href="#存取器" class="headerlink" title="存取器"></a>存取器</h3><p><code>TypeScript</code> 支持通过 <code>getters/setters</code> 来截取对对象成员的访问。 它能帮助你有效的控制对对象成员的访问。</p><p>下面来看如何把一个简单的类改写成使用 <code>get</code> 和 <code>set</code>。 首先，我们从一个没有使用存取器的例子开始。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="built_in">string</span> = <span class="string">&quot;A&quot;</span>;</span><br><span class="line">  <span class="attr">lastName</span>: <span class="built_in">string</span> = <span class="string">&quot;B&quot;</span>;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">fullName</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&quot;-&quot;</span> + <span class="variable language_">this</span>.<span class="property">lastName</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">fullName</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> names = value.<span class="title function_">split</span>(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">firstName</span> = names[<span class="number">0</span>];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lastName</span> = names[<span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">fullName</span>);</span><br><span class="line"></span><br><span class="line">p.<span class="property">firstName</span> = <span class="string">&quot;C&quot;</span>;</span><br><span class="line">p.<span class="property">lastName</span> = <span class="string">&quot;D&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">fullName</span>);</span><br><span class="line"></span><br><span class="line">p.<span class="property">fullName</span> = <span class="string">&quot;E-F&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">firstName</span>, p.<span class="property">lastName</span>);</span><br></pre></td></tr></table></figure><h3 id="静态属性"><a href="#静态属性" class="headerlink" title="静态属性"></a>静态属性</h3><p>到目前为止，我们只讨论了类的实例成员，那些仅当类被实例化的时候才会被初始化的属性。 我们也可以创建类的静态成员，这些属性存在于类本身上面而不是类的实例上。 在这个例子里，我们使用 <code>static</code> 定义 <code>origin</code>，因为它是所有网格都会用到的属性。 每个实例想要访问这个属性的时候，都要在 <code>origin</code> 前面加上类名。 如同在实例属性上使用 <code>this.xxx</code> 来访问属性一样，这里我们使用 <code>Grid.xxx</code> 来访问静态属性。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">静态属性, 是类对象的属性</span></span><br><span class="line"><span class="comment">非静态属性, 是类的实例对象的属性</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name1</span>: <span class="built_in">string</span> = <span class="string">&quot;A&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="attr">name2</span>: <span class="built_in">string</span> = <span class="string">&quot;B&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property">name2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Person</span>().<span class="property">name1</span>);</span><br></pre></td></tr></table></figure><h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><p>抽象类做为其它派生类的基类使用。 它们不能被实例化。不同于接口，抽象类可以包含成员的实现细节。 <code>abstract</code> 关键字是用于定义抽象类和在抽象类内部定义抽象方法。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">抽象类</span></span><br><span class="line"><span class="comment">  不能创建实例对象, 只有实现类才能创建实例</span></span><br><span class="line"><span class="comment">  可以包含未实现的抽象方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">cry</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;run()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">cry</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot; Dog cry()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">dog.<span class="title function_">cry</span>();</span><br><span class="line">dog.<span class="title function_">run</span>();</span><br></pre></td></tr></table></figure><h2 id="2-4-函数"><a href="#2-4-函数" class="headerlink" title="2.4. 函数"></a>2.4. 函数</h2><p>函数是 JavaScript 应用程序的基础，它帮助你实现抽象层，模拟类，信息隐藏和模块。在 TypeScript 里，虽然已经支持类，命名空间和模块，但函数仍然是主要的定义行为的地方。TypeScript 为 JavaScript 函数添加了额外的功能，让我们可以更容易地使用。</p><h3 id="基本示例-1"><a href="#基本示例-1" class="headerlink" title="基本示例"></a>基本示例</h3><p>和 JavaScript 一样，TypeScript 函数可以创建有名字的函数和匿名函数。你可以随意选择适合应用程序的方式，不论是定义一系列 API 函数还是只使用一次的函数。</p><p>通过下面的例子可以迅速回想起这两种 JavaScript 中的函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命名函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匿名函数</span></span><br><span class="line"><span class="keyword">let</span> myAdd = <span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="函数类型-1"><a href="#函数类型-1" class="headerlink" title="函数类型"></a>函数类型</h3><p><strong>为函数定义类型</strong></p><p>让我们为上面那个函数添加类型：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myAdd = <span class="keyword">function</span> (<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>我们可以给每个参数添加类型之后再为函数本身添加返回值类型。TypeScript 能够根据返回语句自动推断出返回值类型。</p><p><strong>书写完整函数类型</strong></p><p>现在我们已经为函数指定了类型，下面让我们写出函数的完整类型。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">myAdd2</span>: <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  x: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  y: <span class="built_in">number</span></span></span><br><span class="line"><span class="params"></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="可选参数和默认参数"><a href="#可选参数和默认参数" class="headerlink" title="可选参数和默认参数"></a>可选参数和默认参数</h3><p>TypeScript 里的每个函数参数都是必须的。 这不是指不能传递 <code>null</code> 或 <code>undefined</code> 作为参数，而是说编译器检查用户是否为每个参数都传入了值。编译器还会假设只有这些参数会被传递进函数。 简短地说，传递给一个函数的参数个数必须与函数期望的参数个数一致。</p><p>JavaScript 里，每个参数都是可选的，可传可不传。 没传参的时候，它的值就是 <code>undefined</code>。 在 TypeScript 里我们可以在参数名旁使用 <code>?</code> 实现可选参数的功能。 比如，我们想让 <code>lastName</code> 是可选的：</p><p>在 TypeScript 里，我们也可以为参数提供一个默认值当用户没有传递这个参数或传递的值是 <code>undefined</code> 时。 它们叫做有默认初始化值的参数。 让我们修改上例，把<code>firstName</code> 的默认值设置为 <code>&quot;A&quot;</code>。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">buildName</span>(<span class="params">firstName: <span class="built_in">string</span> = <span class="string">&quot;A&quot;</span>, lastName?: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (lastName) &#123;</span><br><span class="line">    <span class="keyword">return</span> firstName + <span class="string">&quot;-&quot;</span> + lastName;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> firstName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">buildName</span>(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">buildName</span>(<span class="string">&quot;C&quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">buildName</span>());</span><br></pre></td></tr></table></figure><p><strong>剩余参数</strong></p><p>必要参数，默认参数和可选参数有个共同点：它们表示某一个参数。 有时，你想同时操作多个参数，或者你并不知道会有多少参数传递进来。 在 JavaScript 里，你可以使用 <code>arguments</code> 来访问所有传入的参数。</p><p>在 TypeScript 里，你可以把所有参数收集到一个变量里：<br>剩余参数会被当做个数不限的可选参数。 可以一个都没有，同样也可以有任意个。 编译器创建参数数组，名字是你在省略号（ <code>...</code>）后面给定的名字，你可以在函数体内使用这个数组。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params">x: <span class="built_in">string</span>, ...args: <span class="built_in">string</span>[]</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x, args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">info</span>(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="函数重载"><a href="#函数重载" class="headerlink" title="函数重载"></a>函数重载</h3><p>函数重载: 函数名相同, 而形参不同的多个函数<br>在 JS 中, 由于弱类型的特点和形参与实参可以不匹配, 是没有函数重载这一说的 但在 TS 中, 与其它面向对象的语言(如 Java)就存在此语法</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">函数重载: 函数名相同, 而形参不同的多个函数</span></span><br><span class="line"><span class="comment">需求: 我们有一个add函数，它可以接收2个string类型的参数进行拼接，也可以接收2个number类型的参数进行相加 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重载函数声明</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">string</span>, y: <span class="built_in">string</span></span>): <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义函数实现</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">string</span> | <span class="built_in">number</span>, y: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="built_in">string</span> | <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="comment">// 在实现上我们要注意严格判断两个参数的类型是否相等，而不能简单的写一个 x + y</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&quot;string&quot;</span> &amp;&amp; <span class="keyword">typeof</span> y === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&quot;number&quot;</span> &amp;&amp; <span class="keyword">typeof</span> y === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>));</span><br><span class="line"><span class="comment">// console.log(add(1, &#x27;a&#x27;)) // error</span></span><br></pre></td></tr></table></figure><h2 id="2-5-泛型"><a href="#2-5-泛型" class="headerlink" title="2.5. 泛型"></a>2.5. 泛型</h2><p>指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定具体类型的一种特性。</p><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>下面创建一个函数, 实现功能: 根据指定的数量 <code>count</code> 和数据 <code>value</code> , 创建一个包含 <code>count</code> 个 <code>value</code> 的数组 不用泛型的话，这个函数可能是下面这样：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createArray</span>(<span class="params">value: <span class="built_in">any</span>, count: <span class="built_in">number</span></span>): <span class="built_in">any</span>[] &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">arr</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; count; index++) &#123;</span><br><span class="line">    arr.<span class="title function_">push</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr1 = <span class="title function_">createArray</span>(<span class="number">11</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> arr2 = <span class="title function_">createArray</span>(<span class="string">&quot;aa&quot;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr1[<span class="number">0</span>].<span class="title function_">toFixed</span>(), arr2[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>));</span><br></pre></td></tr></table></figure><h3 id="使用函数泛型"><a href="#使用函数泛型" class="headerlink" title="使用函数泛型"></a>使用函数泛型</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> createArray2&lt;T&gt;(<span class="attr">value</span>: T, <span class="attr">count</span>: <span class="built_in">number</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">arr</span>: <span class="title class_">Array</span>&lt;T&gt; = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; count; index++) &#123;</span><br><span class="line">    arr.<span class="title function_">push</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr3 = createArray2&lt;<span class="built_in">number</span>&gt;(<span class="number">11</span>, <span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr3[<span class="number">0</span>].<span class="title function_">toFixed</span>());</span><br><span class="line"><span class="comment">// console.log(arr3[0].split(&#x27;&#x27;)) // error</span></span><br><span class="line"><span class="keyword">const</span> arr4 = createArray2&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;aa&quot;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr4[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>));</span><br><span class="line"><span class="comment">// console.log(arr4[0].toFixed()) // error</span></span><br></pre></td></tr></table></figure><h3 id="多个泛型参数的函数"><a href="#多个泛型参数的函数" class="headerlink" title="多个泛型参数的函数"></a>多个泛型参数的函数</h3><p>一个函数可以定义多个泛型参数</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> swap&lt;K, V&gt;(<span class="attr">a</span>: K, <span class="attr">b</span>: V): [K, V] &#123;</span><br><span class="line">  <span class="keyword">return</span> [a, b];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> result = swap&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt;(<span class="string">&quot;abc&quot;</span>, <span class="number">123</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result[<span class="number">0</span>].<span class="property">length</span>, result[<span class="number">1</span>].<span class="title function_">toFixed</span>());</span><br></pre></td></tr></table></figure><h3 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h3><p>在定义接口时, 为接口中的属性或方法定义泛型类型<br>在使用接口时, 再指定具体的泛型类型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IbaseCRUD</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T[];</span><br><span class="line">  <span class="attr">add</span>: <span class="function">(<span class="params">t: T</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  <span class="attr">getById</span>: <span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  id?: <span class="built_in">number</span>; <span class="comment">//id主键自增</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>; <span class="comment">//姓名</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>; <span class="comment">//年龄</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCRUD</span> <span class="keyword">implements</span> <span class="title class_">IbaseCRUD</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="title class_">User</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">add</span>(<span class="attr">user</span>: <span class="title class_">User</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    user = &#123; ...user, <span class="attr">id</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="title function_">push</span>(user);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;保存user&quot;</span>, user.<span class="property">id</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getById</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">data</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userCRUD = <span class="keyword">new</span> <span class="title class_">UserCRUD</span>();</span><br><span class="line">userCRUD.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;tom&quot;</span>, <span class="number">12</span>));</span><br><span class="line">userCRUD.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;tom2&quot;</span>, <span class="number">13</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(userCRUD.<span class="property">data</span>);</span><br></pre></td></tr></table></figure><h3 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h3><p>在定义类时, 为类中的属性或方法定义泛型类型 在创建类的实例时, 再指定特定的泛型类型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GenericNumber</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">zeroValue</span>: T;</span><br><span class="line">  <span class="attr">add</span>: <span class="function">(<span class="params">x: T, y: T</span>) =&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myGenericNumber = <span class="keyword">new</span> <span class="title class_">GenericNumber</span>&lt;<span class="built_in">number</span>&gt;();</span><br><span class="line">myGenericNumber.<span class="property">zeroValue</span> = <span class="number">0</span>;</span><br><span class="line">myGenericNumber.<span class="property">add</span> = <span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myGenericString = <span class="keyword">new</span> <span class="title class_">GenericNumber</span>&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">myGenericString.<span class="property">zeroValue</span> = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">myGenericString.<span class="property">add</span> = <span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myGenericString.<span class="title function_">add</span>(myGenericString.<span class="property">zeroValue</span>, <span class="string">&quot;test&quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myGenericNumber.<span class="title function_">add</span>(myGenericNumber.<span class="property">zeroValue</span>, <span class="number">12</span>));</span><br></pre></td></tr></table></figure><h3 id="泛型约束"><a href="#泛型约束" class="headerlink" title="泛型约束"></a>泛型约束</h3><p>如果我们直接对一个泛型参数取 <code>length</code> 属性, 会报错, 因为这个泛型根本就不知道它有这个属性</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有泛型约束</span></span><br><span class="line"><span class="keyword">function</span> fn&lt;T&gt;(<span class="attr">x</span>: T): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(x.length)  // error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们可以使用泛型约束来实现</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Lengthwise</span> &#123;</span><br><span class="line">  <span class="attr">length</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定泛型约束</span></span><br><span class="line"><span class="keyword">function</span> fn2&lt;T <span class="keyword">extends</span> <span class="title class_">Lengthwise</span>&gt;(<span class="attr">x</span>: T): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x.<span class="property">length</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们需要传入符合约束类型的值，必须包含必须 <code>length</code> 属性：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fn2</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="comment">// fn2(123) // error  number没有length属性</span></span><br></pre></td></tr></table></figure><h2 id="2-6-其它"><a href="#2-6-其它" class="headerlink" title="2.6. 其它"></a>2.6. 其它</h2><h3 id="声明文件"><a href="#声明文件" class="headerlink" title="声明文件"></a>声明文件</h3><p>当使用第三方库时，我们需要引用它的声明文件，才能获得对应的代码补全、接口提示等功能</p><p>什么是声明语句</p><p>假如我们想使用第三方库 jQuery，一种常见的方式是在 html 中通过 <code>&lt;script&gt;</code> 标签引入 <code>jQuery</code>，然后就可以使用全局变量 <code>$</code> 或 <code>jQuery</code> 了。</p><p>但是在 ts 中，编译器并不知道 $ 或 jQuery 是什么东西</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">当使用第三方库时，我们需要引用它的声明文件，才能获得对应的代码补全、接口提示等功能。</span></span><br><span class="line"><span class="comment">声明语句: 如果需要ts对新的语法进行检查, 需要要加载了对应的类型说明代码</span></span><br><span class="line"><span class="comment">  declare var jQuery: (selector: string) =&gt; any;</span></span><br><span class="line"><span class="comment">声明文件: 把声明语句放到一个单独的文件（jQuery.d.ts）中, ts会自动解析到项目中所有声明文件</span></span><br><span class="line"><span class="comment">下载声明文件: npm install @types/jquery --save-dev</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">jQuery</span>(<span class="string">&quot;#foo&quot;</span>);</span><br><span class="line"><span class="comment">// ERROR: Cannot find name &#x27;jQuery&#x27;.</span></span><br></pre></td></tr></table></figure><p>这时，我们需要使用 declare var 来定义它的类型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">var</span> <span class="attr">jQuery</span>: <span class="function">(<span class="params">selector: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">jQuery</span>(<span class="string">&quot;#foo&quot;</span>);</span><br></pre></td></tr></table></figure><p>declare var 并没有真的定义一个变量，只是定义了全局变量 jQuery 的类型，仅仅会用于编译时的检查，在编译结果中会被删除。它编译结果是：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">jQuery</span>(<span class="string">&quot;#foo&quot;</span>);</span><br></pre></td></tr></table></figure><p>一般声明文件都会单独写成一个 <code>xxx.d.ts</code> 文件</p><p>创建 <code>01_jQuery.d.ts</code>, 将声明语句定义其中, TS 编译器会扫描并加载项目中所有的 TS 声明文件</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">var</span> <span class="attr">jQuery</span>: <span class="function">(<span class="params">selector: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">any</span>;</span><br></pre></td></tr></table></figure><p>很多的第三方库都定义了对应的声明文件库, 库文件名一般为 <code>@types/xxx</code>, 可以在 <code>https://www.npmjs.com/package/package</code> 进行搜索</p><p>有的第三库在下载时就会自动下载对应的声明文件库(比如: webpack),有的可能需要单独下载(比如 jQuery/react)</p><h3 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h3><p>JavaScript 中有很多内置对象，它们可以直接在 TypeScript 中当做定义好了的类型。</p><p>内置对象是指根据标准在全局作用域（Global）上存在的对象。这里的标准是指 ECMAScript 和其他环境（比如 DOM）的标准。</p><ol><li>ECMAScript 的内置对象</li></ol><blockquote><p>Boolean<br>Number<br>String<br>Date<br>RegExp<br>Error</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1. ECMAScript 的内置对象 */</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="title class_">Boolean</span> = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="title class_">Number</span> = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">s</span>: <span class="title class_">String</span> = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">d</span>: <span class="title class_">Date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">let</span> <span class="attr">r</span>: <span class="title class_">RegExp</span> = <span class="regexp">/^1/</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">e</span>: <span class="title class_">Error</span> = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error message&quot;</span>);</span><br><span class="line">b = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// let bb: boolean = new Boolean(2)  // error</span></span><br></pre></td></tr></table></figure><ol><li>BOM 和 DOM 的内置对象</li></ol><blockquote><p>Window<br>Document<br>HTMLElement<br>DocumentFragment<br>Event<br>NodeList</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">div</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="attr">divs</span>: <span class="title class_">NodeList</span> = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">event: MouseEvent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">dir</span>(event.<span class="property">target</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="attr">fragment</span>: <span class="title class_">DocumentFragment</span> = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> node.js </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
